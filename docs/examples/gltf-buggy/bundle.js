!function(){"use strict";function e(e,o,a,u){return new(a=a||Promise)(function(r,t){function s(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(s,n)}i((u=u.apply(e,o||[])).next())})}function d(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const r=t.global||t.self||t.window||{},s="object"!=typeof process||"[object process]"!==String(process)||process.browser;var n="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);n&&parseFloat(n[1]);const o="3.0.11";function c(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const i=t.global||t.self||t.window||{},a="object"!=typeof process||"[object process]"!==String(process)||process.browser,u="function"==typeof importScripts,h="undefined"!=typeof window&&void 0!==window.orientation;n="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}n&&parseFloat(n[1]);class f{constructor(e,t){l(this,"name",void 0),l(this,"workerThread",void 0),l(this,"isRunning",void 0),l(this,"result",void 0),l(this,"_resolve",void 0),l(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){c(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){c(this.isRunning),this.isRunning=!1,this._reject(e)}}const p=new Map;function m(e){c(e.source&&!e.url||!e.source&&e.url);let t=p.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;e=`\
try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`;return g(e)}(e.url),p.set(e.url,t)),e.source&&(t=g(e.source),p.set(e.source,t))),c(t),t}function g(e){e=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(e)}function y(e){return e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const b=()=>{};class v{static isSupported(){return"undefined"!=typeof Worker}constructor(e){l(this,"name",void 0),l(this,"source",void 0),l(this,"url",void 0),l(this,"terminated",!1),l(this,"worker",void 0),l(this,"onMessage",void 0),l(this,"onError",void 0),l(this,"_loadableURL","");var{name:t,source:r,url:e}=e;c(r||e),this.name=t,this.source=r,this.url=e,this.onMessage=b,this.onError=e=>{},this.worker=this._createBrowserWorker()}destroy(){this.onMessage=b,this.onError=b,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||function e(t,r=!0,s){const n=s||new Set;if(t)if(y(t))n.add(t);else if(y(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)&&r&&"object"==typeof t)for(const i in t)e(t[i],r,n);return void 0===s?Array.from(n):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=m({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}}class w{constructor(e){l(this,"name","unnamed"),l(this,"source",void 0),l(this,"url",void 0),l(this,"maxConcurrency",1),l(this,"maxMobileConcurrency",1),l(this,"onDebug",()=>{}),l(this,"reuseWorkers",!0),l(this,"props",{}),l(this,"jobQueue",[]),l(this,"idleQueue",[]),l(this,"count",0),l(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(t,r=(e,t,r)=>e.done(r),s=(e,t)=>e.error(t)){var e=new Promise(e=>(this.jobQueue.push({name:t,onMessage:r,onError:s,onStart:e}),this));return this._startQueuedJob(),e}async _startQueuedJob(){if(this.jobQueue.length){const e=this._getAvailableWorker();if(e){const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new f(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(0<this.idleQueue.length)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new v({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return h?this.maxMobileConcurrency:this.maxConcurrency}}const x={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class _{static isSupported(){return v.isSupported()}static getWorkerFarm(e={}){return _._workerFarm=_._workerFarm||new _({}),_._workerFarm.setProps(e),_._workerFarm}constructor(e){l(this,"props",void 0),l(this,"workerPools",new Map),this.props={...x},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){var{name:t,source:r,url:e}=e;let s=this.workerPools.get(t);return s||(s=new w({name:t,source:r,url:e}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}l(_,"_workerFarm",void 0);const E="latest";const T="3.0.11",A={};async function M(e,t=null,r={}){return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;var s=r.modules||{};if(s[e])return s[e];if(!a)return`modules/${t}/dist/libs/${e}`;if(r.CDN)return c(r.CDN.startsWith("http")),`${r.CDN}/${t}@${T}/dist/libs/${e}`;if(u)return`../src/libs/${e}`;return`modules/${t}/src/libs/${e}`}(e,t,r)),A[e]=A[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return t.arrayBuffer()}if(!a)return;if(u)return importScripts(e);const t=await fetch(e),r=await t.text();return function(t,e){if(!a)return;if(u)return eval.call(i,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}(r,e)}(e),A[e]}async function I(e,t,r,s,n){var i=e.id,e=function(t,r={}){var e=r[t.id]||{},s=`${t.id}-worker.js`;let n=e.workerUrl;if("test"===r._workerType&&(n=`modules/${t.module}/dist/${s}`),!n){let e=t.version;"latest"===e&&(e=E);r=e?`@${e}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${r}/dist/${s}`}return c(n),n}(e,r);const o=_.getWorkerFarm(r),a=o.getWorkerPool({name:i,url:e});r=JSON.parse(JSON.stringify(r));const u=await a.startJob("process-on-worker",async function(e,t,r,s){switch(r){case"done":t.done(s);break;case"error":t.error(s.error);break;case"process":var{id:n,input:i,options:o}=s;try{var a=await e(i,o);t.postMessage("done",{id:n,result:a})}catch(e){a=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:n,error:a})}}}.bind(null,n));return u.postMessage("process",{input:t,options:r}),(await u.result).result}function S(e,t,r){if(e.byteLength<=t+r)return"";const s=new DataView(e);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(s.getUint8(t+e));return n}function B(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${r=t,t=5,"string"==typeof r?r.slice(0,t):ArrayBuffer.isView(r)?S(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?S(r,0,t):""}"`)}var r}function U(e){if(void 0,e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function j(e,t,r){t=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(t).buffer}function L(e,t){return d(0<=e),d(0<t),e+(t-1)&~(t-1)}async function O(e){const t=[];for await(const r of e)t.push(r);return function(...e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e);e=t.reduce((e,t)=>e+t.byteLength,0);const r=new Uint8Array(e);let s=0;for(const n of t)r.set(n,s),s+=n.byteLength;return r.buffer}(...t)}let D="";const R={};const F=e=>"function"==typeof e,P=e=>null!==e&&"object"==typeof e,C=e=>P(e)&&e.constructor==={}.constructor,k=e=>e&&"function"==typeof e[Symbol.iterator],N=e=>e&&"function"==typeof e[Symbol.asyncIterator],$=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,V=e=>"undefined"!=typeof Blob&&e instanceof Blob,z=e=>e&&"object"==typeof e&&e.isBuffer,H=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||P(e)&&F(e.tee)&&F(e.cancel)&&F(e.getReader))(e)||(e=>P(e)&&F(e.read)&&F(e.pipe)&&"boolean"==typeof e.readable)(e),G=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,W=/^([-\w.]+\/[-\w.+]+)/;function q(e){e=G.exec(e);return e?e[1]:""}const Y=/\?.*/;function X(e){if($(e)){var t=Q(e.url||""),r=e.headers.get("content-type")||"";return{url:t,type:(s=r,((r=W.exec(s))?r[1]:s)||q(t))}}var s;return V(e)?{url:Q(e.name||""),type:e.type||""}:"string"==typeof e?{url:Q(e),type:q(e)}:{url:"",type:""}}function Q(e){return e.replace(Y,"")}async function K(e){if($(e))return e;const t={};var r=(s=e,$(s)?s.headers["content-length"]||-1:V(s)?s.size:"string"==typeof s?s.length:s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.byteLength:-1);0<=r&&(t["content-length"]=String(r));var{url:s,type:r}=X(e);r&&(t["content-type"]=r);r=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return new Promise(r=>{const e=new FileReader;e.onload=e=>{var t;return r(null==e||null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(t)})}if(e instanceof ArrayBuffer)return`data:base64,${function(e){let t="";var r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5))}`;return null}(e);r&&(t["x-first-bytes"]=r),"string"==typeof e&&(e=(new TextEncoder).encode(e));e=new Response(e,{headers:t});return Object.defineProperty(e,"url",{value:s}),e}async function J(e){if(!e.ok){e=await async function(t){let r=`Failed to fetch resource ${t.url} (${t.status}): `;try{const s=t.headers.get("Content-Type");let e=t.statusText;s.includes("application/json")&&(e+=` ${await t.text()}`),r+=e,r=60<r.length?`${r.slice(60)}...`:r}catch(e){}return r}(e);throw new Error(e)}}async function Z(t,r){if("string"!=typeof t)return K(t);{t=function(e){for(const r in R){var t;e.startsWith(r)&&(t=R[r],e=e.replace(r,t))}return e=!e.startsWith("http://")&&!e.startsWith("https://")?`${D}${e}`:e}(t);let e=r;return null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(e=r.fetch),fetch(t,e)}}t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process};const ee=t.window||t.self||t.global,te=t.process||{},re="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",se=!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;var t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;const r=e||t;return!!(r&&0<=r.indexOf("Electron"))}();class ne{constructor(e,t,r="sessionStorage"){this.storage=function(e){try{const r=window[e];var t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch(e){return null}}(r),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){return Object.assign(this.config,e),this.storage&&(e=JSON.stringify(this.config),this.storage.setItem(this.id,e)),this}_loadConfiguration(){let e={};var t;return this.storage&&(t=this.storage.getItem(this.id),e=t?JSON.parse(t):{}),Object.assign(this.config,e),this}}const ie={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function oe(e){return"string"==typeof e?ie[e.toUpperCase()]||ie.WHITE:e}function ae(e,t){if(!e)throw new Error(t||"Assertion failed")}function ue(){let e;var t;return e=se&&ee.performance?ee.performance.now():te.hrtime?1e3*(t=te.hrtime())[0]+t[1]/1e6:Date.now(),e}const ce={debug:se&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},de={enabled:!0,level:0};function he(){}const le={},fe={once:!0};class pe{constructor({id:e}={id:""}){this.id=e,this.VERSION=re,this._startTs=ue(),this._deltaTs=ue(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new ne("__probe-".concat(this.id,"__"),de),this.userData={},this.timeStamp("".concat(this.id," started")),function(e,t=["constructor"]){var r=Object.getPrototypeOf(e);for(const s of Object.getOwnPropertyNames(r))"function"==typeof e[s]&&(t.find(e=>s===e)||(e[s]=e[s].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ue()-this._startTs).toPrecision(10))}getDelta(){return Number((ue()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){ae(e,t)}warn(e){return this._getLogFunction(0,e,ce.warn,arguments,fe)}error(e){return this._getLogFunction(0,e,ce.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,ce.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ce.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ce.debug||ce.info,arguments,fe)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||he,r&&[r],{tag:function(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}(t)}):he}image({logLevel:e,priority:t,image:r,message:s="",scale:n=1}){return this._shouldLog(e||t)?(se?function({image:e,message:i="",scale:o=1}){if("string"==typeof e){const a=new Image;return a.onload=()=>{var e,t,r,s,n;e=a,t=i,r=o,s=600,n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29"),e.width>s&&(r=Math.min(r,s/e.width)),s=e.width*r,r=e.height*r,["font-size:1px;","padding:".concat(Math.floor(r/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(r,"px;"),"background:url(".concat(n,");"),"background-size:".concat(s,"px ").concat(r,"px;"),"color:transparent;"].join(""),"".concat(t," %c+")},a.src=e,he}const t=e.nodeName||"";if("img"===t.toLowerCase())return he;if("canvas"!==t.toLowerCase())return he;{const r=new Image;return r.onload=()=>{},r.src=e.toDataURL(),he}}:function({image:e,scale:t=1}){let r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return()=>r(e,{fit:"box",width:"".concat(Math.round(80*t),"%")}).then(e=>{});return he})({image:r,message:s,scale:n}):he}settings(){}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time||console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd||console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||he)}group(e,t,r={collapsed:!1}){var{collapsed:t}=r=ge({logLevel:e,message:t,opts:r});return r.method=(t?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||he)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=me(e)}_getLogFunction(e,t,r,s=[],n){if(this._shouldLog(e)){n=ge({logLevel:e,message:t,args:s,opts:n}),ae(r=r||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=ue();s=n.tag||n.message;if(n.once){if(le[s])return he;le[s]=ue()}return t=function(e,t,r){{var s;"string"==typeof t&&(s=r.time?function(e,t=8){return t=Math.max(t-e.length,0),"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"",t=function(e,t,r){return se||"string"!=typeof e||(t&&(t=oe(t),e="[".concat(t,"m").concat(e,"[39m")),r&&(t=oe(r),e="[".concat(r+10,"m").concat(e,"[49m"))),e}(t=(r.time?"".concat(e,": ").concat(s,"  "):"".concat(e,": ")).concat(t),r.color,r.background))}return t}(this.id,n.message,n),r.bind(console,t,...n.args)}return he}}function me(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return ae(Number.isFinite(t)&&0<=t),t}function ge(e){var{logLevel:t,message:r}=e;e.logLevel=me(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==r;);switch(e.args=s,typeof t){case"string":case"function":void 0!==r&&s.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var n=typeof e.message;return ae("string"==n||"object"==n),Object.assign(e,e.opts)}pe.VERSION=re;const ye=new pe({id:"loaders.gl"});class be{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const ve={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){l(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},we={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xe(){r.loaders=r.loaders||{};const{loaders:e}=r;return e._state=e._state||{},e._state}const _e=()=>{const e=xe();return e.globalOptions=e.globalOptions||{...ve},e.globalOptions};function Ee(e,t,r,s){return r=r||[],function(e,t){Ae(e,null,ve,we,t);for(const i of t){var r=e&&e[i.id]||{},s=i.options&&i.options[i.id]||{},n=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Ae(r,i.id,s,n,t)}}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const s=e.options||{},n={...s};(function(e,t){!t||"baseUri"in e||(e.baseUri=t)})(n,r),null===n.log&&(n.log=new be);return Me(n,_e()),Me(n,t),n}(t,e,s)}function Te(e,t){var r=_e();const s=e||r;return"function"==typeof s.fetch?s.fetch:P(s.fetch)?e=>Z(e,s):null!=t&&t.fetch?null==t?void 0:t.fetch:Z}function Ae(e,t,r,s,n){var i=t||"Top level",o=t?`${t}.`:"";for(const d in e){var a=!t&&P(e[d]),u="baseUri"===d&&!t,c="workerUrl"===d&&t;d in r||u||c||(d in s?ye.warn(`${i} loader option \'${o}${d}\' no longer supported, use \'${s[d]}\'`)():a||(a=function(e,t){const r=e.toLowerCase();let s="";for(const n of t)for(const i in n.options){if(e===i)return`Did you mean \'${n.id}.${i}\'?`;const o=i.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(s=s||`Did you mean \'${n.id}.${i}\'?`)}return s}(d,n),ye.warn(`${i} loader option \'${o}${d}\' not recognized. ${a}`)()))}}function Me(e,t){for(const s in t){var r;s in t&&(r=t[s],C(r)&&C(e[s])?e[s]={...e[s],...t[s]}:e[s]=t[s])}}function Ie(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===e||void 0===e?void 0:e.extensions))}function Se(e){var t;return d(e,"null loader"),d(Ie(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(null!==e&&void 0!==e&&e.parseTextSync||null!==e&&void 0!==e&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Be=()=>{const e=xe();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const Ue=/\.([^.]+)$/;function je(e,t=[],r,s){if(!Le(e))return null;if(t&&!Array.isArray(t))return Se(t);let n=[];t&&(n=n.concat(t)),null!=r&&r.ignoreRegisteredLoaders||n.push(...Be()),function(e){for(const t of e)Se(t)}(n);s=function(e,t,r,s){var{url:n,type:i}=X(e),s=n||(null==s?void 0:s.url);let o=null;null!=r&&r.mimeType&&(o=De(t,null==r?void 0:r.mimeType));return o=o||function(e,t){t=t&&Ue.exec(t),t=t&&t[1];return t?function(e,t){t=t.toLowerCase();for(const r of e)for(const s of r.extensions)if(s.toLowerCase()===t)return r;return null}(e,t):null}(t,s),o=o||De(t,i),o=o||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(function(t,e){if(e.testText)return e.testText(t);const r=Array.isArray(e.tests)?e.tests:[e.tests];return r.some(e=>t.startsWith(e))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(Re(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer)if(Re(t,0,r))return r;return null}(t,e),o=o||De(t,null==r?void 0:r.fallbackMimeType),o}(e,n,r,s);if(!(s||null!=r&&r.nothrow))throw new Error(Oe(e));return s}function Le(e){return!(e instanceof Response&&204===e.status)}function Oe(e){var{url:t,type:r}=X(e);let s="No valid loader found";return e&&(s+=` data: "${function(e,t=5){{if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Fe(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return Fe(e,0,t)}return""}(e)}", contentType: "${r}"`),t&&(s+=` url: ${t}`),s}function De(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t===`application/x.${r.id}`)return r}return null}function Re(t,r,s){const e=Array.isArray(s.tests)?s.tests:[s.tests];return e.some(e=>function(e,t,r,s){if(s instanceof ArrayBuffer)return function(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;var s=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<s.length;++e)if(s[e]!==n[e])return!1;return!0}(s,e,s.byteLength);switch(typeof s){case"function":return s(e,r);case"string":var n=Fe(e,t,s.length);return s===n;default:return!1}}(t,r,s,e))}function Fe(e,t,r){if(e.byteLength<t+r)return"";const s=new DataView(e);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(s.getUint8(t+e));return n}const Pe=262144;const Ce=262144;const ke=1048576;function Ne(e,t){return s?async function*(e,t){const r=e.getReader();let s;try{for(;;){var n=s||r.read();null!=t&&t._streamReadAhead&&(s=r.read());var{done:i,value:o}=await n;if(i)return;yield U(o)}}catch(e){r.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield U(t)}(e)}function $e(e,t){if("string"==typeof e)return function*(e,t){var r=(null==t?void 0:t.chunkSize)||Pe;let s=0;const n=new TextEncoder;for(;s<e.length;){var i=Math.min(e.length-s,r),o=e.slice(s,s+i);s+=i,yield n.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){var{chunkSize:r=Ce}=t;let s=0;for(;s<e.byteLength;){var n=Math.min(e.byteLength-s,r),i=new ArrayBuffer(n),o=new Uint8Array(e,s,n);const a=new Uint8Array(i);a.set(o),s+=n,yield i}}(e,t);if(V(e))return async function*(e,t){var r=(null==t?void 0:t.chunkSize)||ke;let s=0;for(;s<e.size;){var n=s+r,i=await e.slice(s,n).arrayBuffer();s=n,yield i}}(e,t);if(H(e))return Ne(e,t);if($(e))return Ne(e.body,t);throw new Error("makeIterator")}const Ve="Cannot convert supplied data type";async function ze(e,t,r){var s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s)return function(t,r){if(r.text&&"string"==typeof t)return t;if((t=z(t)?t.buffer:t)instanceof ArrayBuffer){var e=t;if(!r.text||r.binary)return e;{const s=new TextDecoder("utf8");return s.decode(e)}}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){const n=new TextDecoder("utf8");return n.decode(t)}let e=t.buffer;r=t.byteLength||t.length;return 0===t.byteOffset&&r===e.byteLength||(e=e.slice(t.byteOffset,t.byteOffset+r)),e}throw new Error(Ve)}(e,t);if(V(e)&&(e=await K(e)),$(e)){const n=e;return await J(n),t.binary?await n.arrayBuffer():await n.text()}if(H(e)&&(e=$e(e,r)),k(e)||N(e))return O(e);throw new Error(Ve)}async function He(e,t,r,s){c(!s||"object"==typeof s),!t||Array.isArray(t)||Ie(t)||(r=t,t=s=void 0),r=r||{};var{url:n}=X(e=await e),i=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;return e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders&&(t=Array.isArray(t.loaders)?t.loaders:[t.loaders],r=r?[...r,...t]:t),r&&r.length?r:null}(t,s),t=await async function(e,t=[],r,s){if(!Le(e))return null;let n=je(e,t,{...r,nothrow:!0},s);if(n)return n;if(V(e)&&(e=await e.slice(0,10).arrayBuffer(),n=je(e,t,r,s)),!(n||null!=r&&r.nothrow))throw new Error(Oe(e));return n}(e,i,r);return t?async function(e,t,r,s){if(function(e,t=o){c(e,"no worker provided"),e=e.version}(e),t=await ze(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,s,e);if(function(e,t){return _.isSupported()&&(e.worker&&null!=t&&t.worker)}(e,r))return I(e,t,r,0,He);if(e.parseText&&"string"==typeof t)return e.parseText(t,r,s,e);if(e.parse)return e.parse(t,r,s,e);throw c(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(t,e,r=Ee(r,t,i,n),s=function(e,t,r=null){if(r)return r;const s={fetch:Te(t,e),...e};return Array.isArray(s.loaders)||(s.loaders=null),s}({url:n,parse:He,loaders:i},r,s)):null}function Ge(e,t){if(!e)throw new Error(t)}n={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const We=n.global||n.self||n.window;t="object"!=typeof process||"[object process]"!==String(process)||process.browser,n="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);n&&parseFloat(n[1]);var{_parseImageNode:n}=We;const qe="undefined"!=typeof Image,Ye="undefined"!=typeof ImageBitmap;n=Boolean(n);const Xe=!!t||n;function Qe(e){e=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!e)throw new Error("Not an image");return e}const Ke=/^data:image\/svg\+xml/,Je=/\.svg((\?|#).*)?$/;function Ze(e){return e&&(Ke.test(e)||Je.test(e))}function et(e,t){if(Ze(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function tt(e,t,r){e=function(t,e){if(Ze(e)){const r=new TextDecoder;let e=r.decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return et(t,e)}(e,r);const s=self.URL||self.webkitURL;r="string"!=typeof e&&s.createObjectURL(e);try{return await async function(r,e){const s=new Image;if(s.src=r,e.image&&e.image.decode&&s.decode)return await s.decode(),s;return new Promise((e,t)=>{try{s.onload=()=>e(s),s.onerror=e=>t(new Error(`Could not load image ${r}: ${e}`))}catch(e){t(e)}})}(r||e,t)}finally{r&&s.revokeObjectURL(r)}}const rt={};let st=!0;async function nt(e,t,r){let s;s=Ze(r)?await tt(e,t,r):et(e,r);t=t&&t.imagebitmap;return async function(e,t=null){!function(e){for(const t in e||rt)return!1;return!0}(t)&&st||(t=null);if(t)try{return createImageBitmap(e,t)}catch(e){st=!1}return createImageBitmap(e)}(s,t)}const it=!1,ot=!0;function at(e){e=ut(e);return function(e){const t=ut(e),r=24<=t.byteLength&&2303741511===t.getUint32(0,it);return r?{mimeType:"image/png",width:t.getUint32(16,it),height:t.getUint32(20,it)}:null}(e)||function(e){const t=ut(e),r=3<=t.byteLength&&65496===t.getUint16(0,it)&&255===t.getUint8(2);if(!r)return null;const{tableMarkers:s,sofMarkers:n}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let i=2;for(;i+9<t.byteLength;){var o=t.getUint16(i,it);if(n.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,it),width:t.getUint16(i+7,it)};if(!s.has(o))return null;i+=2,i+=t.getUint16(i,it)}return null}(e)||function(e){const t=ut(e),r=10<=t.byteLength&&1195984440===t.getUint32(0,it);return r?{mimeType:"image/gif",width:t.getUint16(6,ot),height:t.getUint16(8,ot)}:null}(e)||function(e){const t=ut(e),r=14<=t.byteLength&&16973===t.getUint16(0,it)&&t.getUint32(2,ot)===t.byteLength;return r?{mimeType:"image/bmp",width:t.getUint32(18,ot),height:t.getUint32(22,ot)}:null}(e)}function ut(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const ct={id:"image",module:"images",name:"Images",version:"3.0.11",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){var s=((t=t||{}).image||{}).type||"auto",{url:n}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(Ye)return"imagebitmap";if(qe)return"image";if(Xe)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Ye||qe||Xe;case"imagebitmap":return Ye;case"image":return qe;case"data":return Xe;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(s)){case"imagebitmap":i=await nt(e,t,n);break;case"image":i=await tt(e,t,n);break;case"data":i=await function(e,t){var{mimeType:r}=at(e)||{};const{_parseImageNode:s}=We;return Ge(s),s(e,r,t)}(e,t);break;default:Ge(!1)}return"data"===s&&(i=function(e){switch(Qe(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(at(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};function dt(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function ht(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return r.substr(0,r.lastIndexOf("/")+1)+e}t={name:"Draco",id:"draco",module:"draco",version:"3.0.11",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class lt{constructor(e,t){l(this,"fields",void 0),l(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(e)),function(e){const t={};for(const r of e)t[r.name],t[r.name]=!0}(e),this.fields=e,this.metadata=t||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...e){const t=Object.create(null);for(const r of e)t[r]=!0;e=this.fields.filter(e=>t[e.name]);return new lt(e,this.metadata)}selectAt(...e){e=e.map(e=>this.fields[e]).filter(Boolean);return new lt(e,this.metadata)}assign(e){let t,r=this.metadata;var s;e instanceof lt?(s=e,t=s.fields,r=ft(ft(new Map,this.metadata),s.metadata)):t=e;const n=Object.create(null);for(const i of this.fields)n[i.name]=i;for(const o of t)n[o.name]=o;e=Object.values(n);return new lt(e,r)}}function ft(e,t){return new Map([...e||new Map,...t||new Map])}class pt{constructor(e,t,r=!1,s=new Map){l(this,"name",void 0),l(this,"type",void 0),l(this,"nullable",void 0),l(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=s}get typeId(){return this.type&&this.type.typeId}clone(){return new pt(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}}let mt;(n=mt=mt||{})[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth";class gt{static isNull(e){return e&&e.typeId===mt.Null}static isInt(e){return e&&e.typeId===mt.Int}static isFloat(e){return e&&e.typeId===mt.Float}static isBinary(e){return e&&e.typeId===mt.Binary}static isUtf8(e){return e&&e.typeId===mt.Utf8}static isBool(e){return e&&e.typeId===mt.Bool}static isDecimal(e){return e&&e.typeId===mt.Decimal}static isDate(e){return e&&e.typeId===mt.Date}static isTime(e){return e&&e.typeId===mt.Time}static isTimestamp(e){return e&&e.typeId===mt.Timestamp}static isInterval(e){return e&&e.typeId===mt.Interval}static isList(e){return e&&e.typeId===mt.List}static isStruct(e){return e&&e.typeId===mt.Struct}static isUnion(e){return e&&e.typeId===mt.Union}static isFixedSizeBinary(e){return e&&e.typeId===mt.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===mt.FixedSizeList}static isMap(e){return e&&e.typeId===mt.Map}static isDictionary(e){return e&&e.typeId===mt.Dictionary}get typeId(){return mt.NONE}compareTo(e){return this===e}}class yt extends gt{constructor(e,t){super(),l(this,"isSigned",void 0),l(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return mt.Int}get[Symbol.toStringTag](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}class bt extends yt{constructor(){super(!0,8)}}class vt extends yt{constructor(){super(!0,16)}}class wt extends yt{constructor(){super(!0,32)}}class xt extends yt{constructor(){super(!1,8)}}class _t extends yt{constructor(){super(!1,16)}}class Et extends yt{constructor(){super(!1,32)}}const Tt={HALF:16,SINGLE:32,DOUBLE:64};class At extends gt{constructor(e){super(),l(this,"precision",void 0),this.precision=e}get typeId(){return mt.Float}get[Symbol.toStringTag](){return"Float"}toString(){return`Float${this.precision}`}}class Mt extends At{constructor(){super(Tt.SINGLE)}}class It extends At{constructor(){super(Tt.DOUBLE)}}class St extends gt{constructor(e,t){super(),l(this,"listSize",void 0),l(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return mt.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Symbol.toStringTag](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}function Bt(e,t,r){var s=jt(t.metadata);const n=[];var i=function(e){const t={};for(const s in e){var r=e[s];t[r.name||"undefined"]=r}return t}(t.attributes);for(const a in e){var o=e[a],o=Ut(a,o,i[a]);n.push(o)}return r&&(r=Ut("indices",r),n.push(r)),new lt(n,s)}function Ut(e,t,r){var s=r?jt(r.metadata):void 0,r=function(e){switch(e.constructor){case Int8Array:return new bt;case Uint8Array:return new xt;case Int16Array:return new vt;case Uint16Array:return new _t;case Int32Array:return new wt;case Uint32Array:return new Et;case Float32Array:return new Mt;case Float64Array:return new It;default:throw new Error("array type not supported")}}(t.value);return new pt(e,new St(t.size,new pt("value",r)),!1,s)}function jt(e){const t=new Map;for(const r in e)t.set(`${r}.string`,JSON.stringify(e[r]));return t}const Lt={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ot={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Dt{constructor(e){l(this,"draco",void 0),l(this,"decoder",void 0),l(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);t=this.decoder.GetEncodedGeometryType(s);const n=new(t===this.draco.TRIANGULAR_MESH?this.draco.Mesh:this.draco.PointCloud);try{let e;switch(t){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(s,n);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(s,n);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!n.ptr){var i=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(i)}var o=this._getDracoLoaderData(n,t,r),a=this._getMeshData(n,o,r),u=function(e){let t=1/0,r=1/0,s=1/0,n=-1/0,i=-1/0,o=-1/0;var a=e.POSITION?e.POSITION.value:[],u=a&&a.length;for(let e=0;e<u;e+=3){var c=a[e],d=a[e+1],h=a[e+2];t=c<t?c:t,r=d<r?d:r,s=h<s?h:s,n=c>n?c:n,i=d>i?d:i,o=h>o?h:o}return[[t,r,s],[n,i,o]]}(a.attributes),c=Bt(a.attributes,o,a.indices);return{loader:"draco",loaderData:o,header:{vertexCount:n.num_points(),boundingBox:u},...a,schema:c}}finally{this.draco.destroy(s),n&&this.draco.destroy(n)}}_getDracoLoaderData(e,t,r){var s=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:r}}_getDracoAttributes(t,r){const s={};for(let e=0;e<t.num_attributes();e++){const i=this.decoder.GetAttribute(t,e);var n=this._getAttributeMetadata(t,e);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:e,metadata:n};n=this._getQuantizationTransform(i,r);n&&(s[i.unique_id()].quantization_transform=n);n=this._getOctahedronTransform(i,r);n&&(s[i.unique_id()].octahedron_transform=n)}return s}_getMeshData(e,t,r){var s=this._getMeshAttributes(t,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,t,r){const s={};for(const a of Object.values(e.attributes)){var n=this._deduceAttributeName(a,r);a.name=n;var{value:i,size:o}=this._getAttributeValues(t,a);s[n]={value:i,size:o,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}return s}_getTriangleListIndices(e){var t=3*e.num_faces(),r=4*t,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,t).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(t){const r=t.size(),s=new Int32Array(r);for(let e=0;e<r;e++)s[e]=t.GetValue(e);return s}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=Ot[t.data_type];var s=t.num_components,n=e.num_points()*s,i=n*r.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,r);let a;var u=this.draco._malloc(i);try{var c=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,c,o,i,u),a=new r(this.draco.HEAPF32.buffer,u,n).slice()}finally{this.draco._free(u)}return{value:a,size:s}}_deduceAttributeName(e,t){var r,s,n=e.unique_id;for([r,s]of Object.entries(t.extraAttributes||{}))if(s===n)return r;var i=e.attribute_type;for(const o in Lt)if(this.draco[o]===i)return Lt[o];t=t.attributeNameEntry||"name";return e.metadata[t]?e.metadata[t].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){e=this.decoder.GetMetadata(e);return this._getDracoMetadata(e)}_getAttributeMetadata(e,t){t=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(t)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={};var s=this.metadataQuerier.NumEntries(t);for(let e=0;e<s;e++){var n=this.metadataQuerier.GetEntryName(t,e);r[n]=this._getDracoMetadataField(t,n)}return r}_getDracoMetadataField(e,t){var r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);var s=function(t){const r=t.size(),s=new Int32Array(r);for(let e=0;e<r;e++)s[e]=t.GetValue(e);return s}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){var{quantizedAttributes:t=[],octahedronAttributes:e=[]}=e;for(const r of[...t,...e])this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(e=>s.min_value(e))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}const Rt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.js",Ft="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_wasm_wrapper.js",Pt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.wasm";let Ct;async function kt(e){const t=e.modules||{};return Ct=t.draco3d?Ct||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Ct||async function(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await M(Rt,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await M(Ft,"draco",e),await M(Pt,"draco",e)])}return t=t||globalThis.DracoDecoderModule,function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise(t=>{e({...r,onModuleLoaded:e=>t({draco:e})})})}(t,r)}(e),Ct}const Nt={...t,parse:async function(e,t){const{draco:r}=await kt(t),s=new Dt(r);try{return s.parseSync(e,null==t?void 0:t.draco)}finally{s.destroy()}}};const $t=["SCALAR","VEC2","VEC3","VEC4"];t=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]];const Vt=new Map(t),zt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ht={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Gt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Wt(e){return $t[e-1]||$t[0]}function qt(e){e=Vt.get(e.constructor);if(!e)throw new Error("Illegal typed array");return e}function Yt(e,t){var r=Gt[e.componentType],s=zt[e.type],n=Ht[e.componentType],i=e.count*s,n=e.count*s*n;return dt(0<=n&&n<=t.byteLength),{ArrayType:r,length:i,byteLength:n}}const Xt={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Qt{constructor(e){l(this,"gltf",void 0),l(this,"sourceBuffers",void 0),l(this,"byteLength",void 0),this.gltf=e||{json:{...Xt},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(t){var e=this.getUsedExtensions().find(e=>e===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;var r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){var t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];dt(r);t=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,t,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data;const{ArrayType:s,length:n}=Yt(e,t);e=t.byteOffset+e.byteOffset;return new s(r,e,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,e=t.byteOffset||0;return new Uint8Array(r,e,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const s=e.extensions||{};s[t]=r}removeObjectExtension(e,t){const r=e.extensions||{};e=r[t];return delete r[t],e}addExtension(e,t={}){return dt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return dt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){var{nodeIndices:e}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(e){var{meshIndex:t,matrix:e}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return e&&(r.matrix=e),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){var{attributes:t,indices:r,material:s,mode:e=4}=e;const n={primitives:[{attributes:this._addAttributes(t),mode:e}]};return r&&(r=this._addIndices(r),n.primitives[0].indices=r),Number.isFinite(s)&&(n.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(e){e={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(e,t){var r=at(e),r=t||(null==r?void 0:r.mimeType),r={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){var t=e.byteLength;dt(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);e={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=L(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(e),this.json.bufferViews.length-1}addAccessor(e,t){t={bufferView:e,type:Wt(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(t),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){var r=this.addBufferView(e);let s={min:t.min,max:t.max};s.min&&s.max||(s=this._getAccessorMinMax(e,t.size));e={size:t.size,componentType:qt(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(e,t))}addTexture(e){var{imageIndex:e}=e,e={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(e),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];var r=this.byteLength,s=new ArrayBuffer(r),n=new Uint8Array(s);let i=0;for(const o of this.sourceBuffers||[])i=function(e,t,r){let s;var n,i;return s=e instanceof ArrayBuffer?new Uint8Array(e):(n=e.byteOffset,i=e.byteLength,new Uint8Array(e.buffer||e.arrayBuffer,n,i)),t.set(s,r),r+L(s.byteLength,4)}(o,n,i);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(e,t){let r=!0;for(;r;){var s=e.indexOf(t);-1<s?e.splice(s,1):r=!1}}_addAttributes(e={}){const t={};for(const n in e){var r=e[n],s=this._getGltfAttributeName(n),r=this.addBinaryBuffer(r.value,r);t[s]=r}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(r,s){const n={min:null,max:null};if(r.length<s)return n;n.min=[],n.max=[];for(const e of r.subarray(0,s))n.min.push(e),n.max.push(e);for(let t=s;t<r.length;t+=s)for(let e=0;e<s;e++)n.min[0+e]=Math.min(n.min[0+e],r[t+e]),n.max[0+e]=Math.max(n.max[0+e],r[t+e]);return n}}const Kt="KHR_binary_glTF",Jt="KHR_draco_mesh_compression",Zt="KHR_lights_punctual",er="KHR_materials_unlit",tr="KHR_techniques_webgl";function rr(e){var{buffer:t,size:r,count:e}=function(e){let t=e,r=1,s=0;e&&e.value&&(t=e.value,r=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,r=!1){if(!e)return null;if(Array.isArray(e))return new t(e);return!r||e instanceof t?e:new t(e)}(t,Float32Array)),s=t.length/r);return{buffer:t,size:r,count:s}}(e);return{value:t,size:r,byteOffset:0,count:e,type:Wt(r),componentType:qt(t)}}const sr={KHR_draco_mesh_compression:Object.freeze({__proto__:null,decode:async function(e,t,r){var s;if(null!=t&&null!==(s=t.gltf)&&void 0!==s&&s.decompressMeshes){const n=new Qt(e),i=[];for(const o of function*(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}(n))n.getObjectExtension(o,Jt)&&i.push(async function(e,t,r,s){var n=e.getObjectExtension(t,Jt);if(n){n=e.getTypedArrayForBufferView(n.bufferView),n=j(n.buffer,n.byteOffset);const{parse:u}=s,c={...r};delete c["3d-tiles"];var i,o,a,n=await u(n,Nt,c,s),s=function(e){const t={};for(const s in e){var r=e[s];"indices"!==s&&(r=rr(r),t[s]=r)}return t}(n.attributes);for([i,o]of Object.entries(s))i in t.attributes&&(a=t.attributes[i],null!=(a=e.getAccessor(a))&&a.min&&null!=a&&a.max&&(o.min=a.min,o.max=a.max));t.attributes=s,n.indices&&(t.indices=rr(n.indices)),function(e){if(!e.attributes&&0<Object.keys(e.attributes).length)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}}(n,o,t,r));await Promise.all(i),n.removeExtension(Jt)}},encode:function(e,t=0){const r=new Qt(e);for(const s of r.json.meshes||[])!function(e,t=4,r,s){var n;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var i=r.DracoWriter.encodeSync({attributes:e}),e=null==s||null===(n=s.parseSync)||void 0===n?void 0:n.call(s,{attributes:e}),e=r._addFauxAttributes(e.attributes),i=r.addBufferView(i),e={primitives:[{attributes:e,mode:t,extensions:{[Jt]:{bufferView:i,attributes:e}}}]}}(s),r.addRequiredExtension(Jt)}}),KHR_materials_unlit:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:e}=t;t.removeExtension(er);for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,er)},encode:function(e){const t=new Qt(e);var{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,er,{}),t.addExtension(er))}}),KHR_lights_punctual:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;(e=t.getExtension(Zt))&&(t.json.lights=e.lights,t.removeExtension(Zt));for(const n of r.nodes||[]){var s=t.getObjectExtension(n,Zt);s&&(n.light=s.light),t.removeObjectExtension(n,Zt)}},encode:async function(e){const t=new Qt(e),{json:r}=t;if(r.lights){const n=t.addExtension(Zt);dt(!n.lights),n.lights=r.lights,delete r.lights}if(t.json.lights){for(const i of t.json.lights){var s=i.node;t.addObjectExtension(s,Zt,i)}delete t.json.lights}}}),KHR_techniques_webgl:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;if(e=t.getExtension(tr)){var s=function(e,t){const{programs:r=[],shaders:s=[],techniques:n=[]}=e,i=new TextDecoder;return s.forEach(e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=i.decode(t.getTypedArrayForBufferView(e.bufferView))}),r.forEach(e=>{e.fragmentShader=s[e.fragmentShader],e.vertexShader=s[e.vertexShader]}),n.forEach(e=>{e.program=r[e.program]}),n}(e,t);for(const i of r.materials||[]){var n=t.getObjectExtension(i,tr);n&&(i.technique=Object.assign({},n,s[n.technique]),i.technique.values=function(t,r){const s=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(e=>{!t.uniforms[e].value||e in s||(s[e]=t.uniforms[e].value)}),Object.keys(s).forEach(e=>{"object"==typeof s[e]&&void 0!==s[e].index&&(s[e].texture=r.getTexture(s[e].index))}),s}(i.technique,t)),t.removeObjectExtension(i,tr)}t.removeExtension(tr)}},encode:async function(e,t){}})};const nr={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ir={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class or{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(e,t){this.json=e.json;var r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e){const t=new Qt(e),{json:r}=t;for(const n of r.images||[]){var s=t.removeObjectExtension(n,Kt);s&&Object.assign(n,s)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(Kt)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in nr)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){var r=e[t];if(r&&!Array.isArray(r)){e[t]=[];for(const n in r){const i=r[n];i.id=i.id||n;var s=e[t].length;e[t].push(i),this.idToIndexMap[t][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in nr)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const s of e.meshes)this._convertMeshIds(s);for(const n of e.nodes)this._convertNodeIds(n);for(const i of e.scenes)this._convertSceneIds(i)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:s,material:n}=t;for(const i in r)r[i]=this._convertIdToIndex(r[i],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),n&&(t.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(e=>this._convertIdToIndex(e,"node"))),e.meshes&&(e.meshes=e.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(e,t){e[t]||(e[t]=[]);for(const s of e[t])for(const n in s){var r=s[n],r=this._convertIdToIndex(r,n);s[n]=r}}_convertIdToIndex(e,t){var r=ir[t];if(r in this.idToIndexMap){r=this.idToIndexMap[r][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=r.values&&r.values.tex;var t=e.textures.findIndex(e=>e.id===s);-1!==t&&(r.pbrMetallicRoughness.baseColorTexture={index:t})}}}const ar={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ur={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};t={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986};const cr={magFilter:t.TEXTURE_MAG_FILTER,minFilter:t.TEXTURE_MIN_FILTER,wrapS:t.TEXTURE_WRAP_S,wrapT:t.TEXTURE_WRAP_T},dr={[t.TEXTURE_MAG_FILTER]:t.LINEAR,[t.TEXTURE_MIN_FILTER]:t.NEAREST_MIPMAP_LINEAR,[t.TEXTURE_WRAP_S]:t.REPEAT,[t.TEXTURE_WRAP_]:t.REPEAT};class hr{postProcess(e,t={}){var{json:r,buffers:s=[],images:n=[],baseUri:e=""}=e;return dt(r),this.baseUri=e,this.json=r,this.buffers=s,this.images=n,this._resolveTree(this.json,t),this.json}_resolveTree(e,t=0){e.bufferViews&&(e.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(e.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(e.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(e.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(e.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(e.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(e.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(e.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t))),e.skins&&(e.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(e.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return"object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map(e=>this.getNode(e)),e}_resolveNode(e,t){return e.id=e.id||`node-${t}`,e.children&&(e.children=e.children.map(e=>this.getNode(e))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce((e,t)=>{t=this.getMesh(t);return e.id=t.id,e.primitives=e.primitives.concat(t.primitives),e},{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||`skin-${t}`,e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||`mesh-${t}`,e.primitives&&(e.primitives=e.primitives.map(e=>{var t=(e={...e}).attributes;e.attributes={};for(const r in t)e.attributes[r]=this.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e})),e}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(t=e.componentType,ur[t]),e.components=(t=e.type,ar[t]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:s,byteLength:n}=Yt(e,e.bufferView);t=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset,t=r.arrayBuffer.slice(t,t+n);e.value=new s(t)}return e}_resolveTexture(e,t){return e.id=e.id||`texture-${t}`,e.sampler="sampler"in e?this.getSampler(e.sampler):dr,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const s in e){var r=this._enumSamplerParameter(s);void 0!==r&&(e.parameters[r]=e[s])}return e}_enumSamplerParameter(e){return cr[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));t=this.images[t];return t&&(e.image=t),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;var r=e.buffer;e.buffer=this.buffers[r];t=this.buffers[r].arrayBuffer;let s=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(s+=e.byteOffset),e.data=new Uint8Array(t,s,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e.perspective,e.orthographic,e}}const lr=1735152710,fr=12,pr=8,mr=1313821514,gr=5130562,yr=0,br=1,vr=0,wr=!0;function xr(e,t,r=0){const s=new DataView(t);var n,i,o,a,t=(u=s,c=r+0,`\
${String.fromCharCode(u.getUint8(c+0))}\
${String.fromCharCode(u.getUint8(c+1))}\
${String.fromCharCode(u.getUint8(c+2))}\
${String.fromCharCode(u.getUint8(c+3))}`),u=s.getUint32(r+4,wr),c=s.getUint32(r+8,wr);switch(Object.assign(e,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:t,version:u,json:{},binChunks:[]}),r+=fr,e.version){case 1:return function(e,t,r){d(e.header.byteLength>fr+pr);var s=t.getUint32(r+0,wr),n=t.getUint32(r+4,wr);return r+=pr,d(n===vr),_r(e,t,r,s),r+=s,r+=Er(e,t,r,e.header.byteLength)}(e,s,r);case 2:return n=e,i=s,o=r,a={},d(n.header.byteLength>fr+pr),function(e,t,r,s){for(;r+8<=e.header.byteLength;){var n=t.getUint32(r+0,wr),i=t.getUint32(r+4,wr);switch(r+=pr,i){case mr:_r(e,t,r,n);break;case gr:Er(e,t,r,n);break;case yr:s.strict||_r(e,t,r,n);break;case br:s.strict||Er(e,t,r,n)}r+=L(n,4)}}(n,i,o,a),o+n.header.byteLength;default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}function _r(e,t,r,s){r=new Uint8Array(t.buffer,r,s);const n=new TextDecoder("utf8");r=n.decode(r);return e.json=JSON.parse(r),L(s,4)}function Er(e,t,r,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:s,arrayBuffer:t.buffer}),L(s,4)}async function Tr(e,t,r=0,s,n){var i,o,a,u;!function(e,t,r,s){s.uri&&(e.baseUri=s.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,r={}){const s=new DataView(e);var{magic:r=lr}=r;return(t=s.getUint32(t,!1))===r||t===lr}(t,r,s)){const o=new TextDecoder;t=o.decode(t)}"string"==typeof t?e.json=B(t):t instanceof ArrayBuffer?(r=xr(n={},t,r,s.glb),dt("glTF"===n.type,`Invalid GLB magic string ${n.type}`),e._glb=n,e.json=n.json):dt(!1,"GLTF: must be ArrayBuffer or string");var n=e.json.buffers||[];e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk&&({binChunks:i}=e._glb,e.buffers[0]={arrayBuffer:i[0].arrayBuffer,byteOffset:i[0].byteOffset,byteLength:i[0].byteLength});var i=e.json.images||[];e.images=new Array(i.length).fill({})}(e,t,r,s),r=e,a={normalize:null==s||null===(a=s.gltf)||void 0===a?void 0:a.normalize},(new or).normalize(r,a);const c=[];if(null!=s&&null!==(i=s.gltf)&&void 0!==i&&i.loadBuffers&&e.json.buffers&&await async function(t,r,s){for(let e=0;e<t.json.buffers.length;++e){const a=t.json.buffers[e];var n,i,o;a.uri&&({fetch:o}=s,dt(o),o=ht(a.uri,r),o=await(null==s||null===(n=s.fetch)||void 0===n?void 0:n.call(s,o)),o=await(null==o||null===(i=o.arrayBuffer)||void 0===i?void 0:i.call(o)),t.buffers[e]={arrayBuffer:o,byteOffset:0,byteLength:o.byteLength},delete a.uri)}}(e,s,n),null!=s&&null!==(o=s.gltf)&&void 0!==o&&o.loadImages){const d=async function(t,r,s){const n=t.json.images||[],i=[];for(let e=0;e<n.length;++e)i.push(async function(e,t,r,s,n){const{fetch:i,parse:o}=n;let a;if(t.uri){s=ht(t.uri,s);const u=await i(s);a=await u.arrayBuffer()}Number.isFinite(t.bufferView)&&(t=function(e,t,r){return dt(e=e.bufferViews[r]),dt(r=t[e.buffer]),t=(e.byteOffset||0)+r.byteOffset,new Uint8Array(r.arrayBuffer,t,e.byteLength)}(e.json,e.buffers,t.bufferView),a=j(t.buffer,t.byteOffset,t.byteLength));dt(a,"glTF image has no data");n=await o(a,ct,{},n);e.images[r]=n}(t,n[e],e,r,s));return Promise.all(i)}(e,s,n);c.push(d)}const d=async function(e,t={},r){for(const i in sr){var s,n=(null==t||null===(s=t.gltf)||void 0===s?void 0:s.excludeExtensions)||{};if(!(i in n&&!n[i])){const o=sr[i];await o.decode(e,t,r)}}}(e,s,n);return c.push(d),await Promise.all(c),null!=s&&null!==(u=s.gltf)&&void 0!==u&&u.postProcess?(u=e,s=s,(new hr).postProcess(u,s)):e}const Ar={name:"glTF",id:"gltf",module:"gltf",version:"3.0.11",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},r){(t={...Ar.options,...t}).gltf={...Ar.options.gltf,...t.gltf};var{byteOffset:s=0}=t;return Tr({},e,s,t,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};var Mr="undefined"!=typeof Float32Array?Float32Array:Array;function Ir(){var e=new Mr(16);return Mr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Sr(e,t,r){var s,n,i,o,a,u,c,d,h,l,f,p=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*p+t[4]*m+t[8]*g+t[12],e[13]=t[1]*p+t[5]*m+t[9]*g+t[13],e[14]=t[2]*p+t[6]*m+t[10]*g+t[14],e[15]=t[3]*p+t[7]*m+t[11]*g+t[15]):(s=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],d=t[7],h=t[8],l=t[9],f=t[10],r=t[11],e[0]=s,e[1]=n,e[2]=i,e[3]=o,e[4]=a,e[5]=u,e[6]=c,e[7]=d,e[8]=h,e[9]=l,e[10]=f,e[11]=r,e[12]=s*p+a*m+h*g+t[12],e[13]=n*p+u*m+l*g+t[13],e[14]=i*p+c*m+f*g+t[14],e[15]=o*p+d*m+r*g+t[15]),e}function Br(e,t,r){var s=r[0],n=r[1],r=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ur(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],o=r+r,a=s+s,u=n+n,c=r*o,d=s*o,t=s*a,r=n*o,s=n*a,n=n*u,o=i*o,a=i*a,u=i*u;return e[0]=1-t-n,e[1]=d+u,e[2]=r-a,e[3]=0,e[4]=d-u,e[5]=1-c-n,e[6]=s+o,e[7]=0,e[8]=r+a,e[9]=s-o,e[10]=1-c-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var jr=function(e,t,r){var s=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],d=t[7],h=t[8],l=t[9],f=t[10],p=t[11],m=t[12],g=t[13],y=t[14],b=t[15],v=r[0],w=r[1],x=r[2],t=r[3];return e[0]=v*s+w*a+x*h+t*m,e[1]=v*n+w*u+x*l+t*g,e[2]=v*i+w*c+x*f+t*y,e[3]=v*o+w*d+x*p+t*b,v=r[4],w=r[5],x=r[6],t=r[7],e[4]=v*s+w*a+x*h+t*m,e[5]=v*n+w*u+x*l+t*g,e[6]=v*i+w*c+x*f+t*y,e[7]=v*o+w*d+x*p+t*b,v=r[8],w=r[9],x=r[10],t=r[11],e[8]=v*s+w*a+x*h+t*m,e[9]=v*n+w*u+x*l+t*g,e[10]=v*i+w*c+x*f+t*y,e[11]=v*o+w*d+x*p+t*b,v=r[12],w=r[13],x=r[14],t=r[15],e[12]=v*s+w*a+x*h+t*m,e[13]=v*n+w*u+x*l+t*g,e[14]=v*i+w*c+x*f+t*y,e[15]=v*o+w*d+x*p+t*b,e};function Lr(){var e=new Mr(3);return Mr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Or(e,t,r){var s=new Mr(3);return s[0]=e,s[1]=t,s[2]=r,s}var Dr;function Rr(){var e=new Mr(4);return Mr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Lr(),Dr=new Mr(4),Mr!=Float32Array&&(Dr[0]=0,Dr[1]=0,Dr[2]=0,Dr[3]=0);var Fr,Pr=function(e,t,r,s){var n=new Mr(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=s,n};Lr(),Or(1,0,0),Or(0,1,0),Rr(),Rr(),Fr=new Mr(9),Mr!=Float32Array&&(Fr[1]=0,Fr[2]=0,Fr[3]=0,Fr[5]=0,Fr[6]=0,Fr[7]=0),Fr[0]=1,Fr[4]=1,Fr[8]=1;class Cr{constructor(e){this.device=e}get(){return this.buffer}destroy(){this.buffer.destroy()}}class kr extends Cr{constructor(e,t){super(e),this.itemsCount=t.length,this.typedArray=t,this.buffer=e.createBuffer({size:8*Math.ceil(t.byteLength/8),usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new(this.typedArray instanceof Uint16Array?Uint16Array:Uint32Array)(this.buffer.getMappedRange()).set(t),this.buffer.unmap()}get isInt16(){return this.typedArray instanceof Uint16Array}bind(e){return e.setIndexBuffer(this.buffer,this.isInt16?"uint16":"uint32"),this}}class Nr{constructor(e=0,t=3,r="float32x4"){this.offset=0,this.size=3,this.format="float32x4",this.offset=e,this.size=t,this.format=r}}class $r extends Cr{constructor(e,t,r,s=4*Float32Array.BYTES_PER_ELEMENT,n=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i="vertex"){super(e),this.attributes=new Map,this.stepMode="vertex",this.bindPointIdx=t,this.typedArray=r,this.arrayStride=s,this.stepMode=i,this.buffer=e.createBuffer({size:r.byteLength,usage:n,mappedAtCreation:!0}),new Float32Array(this.buffer.getMappedRange()).set(r),this.buffer.unmap()}get itemsCount(){return this.typedArray.length/this.arrayStride}getLayout(r){return this.attributes.size,{arrayStride:this.arrayStride,stepMode:this.stepMode,attributes:Array.from(this.attributes).map(([,e],t)=>({offset:e.offset,format:e.format,shaderLocation:r+t}))}}addAttribute(e,t=0,r=3,s="float32x4"){s=new Nr(t,r,s);return this.attributes.set(e,s),this}bind(e){return e.setVertexBuffer(this.bindPointIdx,this.buffer),this}}class Vr extends Cr{constructor(e,t,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST){super(e),this.byteLength=t,this.buffer=e.createBuffer({size:t,usage:r})}write(e,t){return this.device.queue.writeBuffer(this.buffer,e,t),this}}class zr{constructor(e){this.source="",this.device=e}static getVertexInputFormat(e){switch(e){case"float32":return"f32";case"float32x2":return"vec2<f32>";case"float32x3":case"float32x4":return"vec4<f32>"}}get shaderModule(){return this.module||(this.module=this.device.createShaderModule({code:this.source})),this.module}addUniformInputs(e,t=1){return this.source+=`
      [[block]] struct UniformsInput {
        ${Object.entries(e).reduce((e,[t,{type:r}])=>e+=`${t}: ${r};`,"")}
      };

      [[group(0), binding(${t})]] var<uniform> inputUBO: UniformsInput;
    `,this}addTextureInputs(e){return this.source+=e.reduce((e,{bindIdx:t,name:r,type:s})=>e+`
          [[group(0), binding(${t})]] var ${r}: ${s};
        `,""),this}addSamplerInputs(e){return this.source+=e.reduce((e,{bindIdx:t,name:r,type:s})=>e+`
          [[group(0), binding(${t})]] var ${r}: ${s};
          `,""),this}addStorages(e){return e.forEach(({bindIdx:e,name:t,attributes:r})=>{this.source+=`
        struct ${t} {
          ${Object.entries(r).map(([e,t])=>`${e}: ${t};`).join("\n")}
        };

        [[block]] struct ${t}Collection {
          ${t.toLowerCase()}s: [[stride(48)]] array<Light>;
        };

        [[group(0), binding(${e})]] var<storage, read_write> ${t.toLowerCase()}Collection: ${t}Collection;
      `}),this}addHeadSnippet(e){return e&&(this.source+=e),this}}zr.ENTRY_FUNCTION="main";class Hr extends zr{constructor(e){super(e),this.source+=Hr.TRANSFORM_UBO_SNIPPET}addShaderVars(e,t={}){let s=0,n="",i="";e.forEach(({attributes:e})=>{for(var[t,{format:r}]of e){r=zr.getVertexInputFormat(r);n+=`
          [[location(${s})]] ${t}: ${r};
        `,i+=`
          [[location(${s})]] ${t}: ${r};
        `,s++}});for(var[r,{format:o}]of Object.entries(t)){o=zr.getVertexInputFormat(o);i+=`
        [[location(${s})]] ${r}: ${o};
      `,s++}return this.source+=`
      struct Input {
        ${n}
      };

      struct Output {
        [[builtin(position)]] Position: vec4<f32>;
        ${i}
      };
    `,this}addMainFnSnippet(e){return this.source+=`
      [[stage(vertex)]] fn main (input: Input) -> Output {
        var output: Output;
        ${e}
        return output;
      }
    `,this}}Hr.TRANSFORM_UBO_SNIPPET=`
    [[block]] struct Transform {
      projectionMatrix: mat4x4<f32>;
      viewMatrix: mat4x4<f32>;
      modelMatrix: mat4x4<f32>;
      normalMatrix: mat4x4<f32>;
    };

    [[group(0), binding(0)]] var<uniform> transform: Transform;
  `;class Gr extends zr{addShaderVars(e,t={},r={}){let s=0,n=0,i="",o="";e.forEach(({attributes:e})=>{for(var[t,{format:r}]of e){r=zr.getVertexInputFormat(r);i+=`
          [[location(${s})]] ${t}: ${r};
        `,s++}});for(var[a,{format:u}]of Object.entries(t)){u=zr.getVertexInputFormat(u);i+=`
        [[location(${s})]] ${a}: ${u};
      `,s++}for(var[c,{format:d}]of Object.entries(r)){d=zr.getVertexInputFormat(d);o+=`
        [[location(${n+1})]] ${c}: ${d};
      `,n++}return this.source+=`
      struct Input {
        [[builtin(position)]] coords: vec4<f32>;
        ${i}
      };

      struct Output {
        [[location(0)]] Color: vec4<f32>;
        ${o}
      };
    `,this}addMainFnSnippet(e){return this.source+=`
      [[stage(fragment)]] fn main (input: Input) -> Output {
        var output: Output;
        ${e}
        return output;
      }
    `,this}}class Wr{constructor(e,t=0){this.samplers=[],this.textures=[],this.uniformBlocks=[],this.storageBuffers=[],this.device=e,this.bindingIndex=t}bind(e){return e.setBindGroup(this.bindingIndex,this.bindGroup),this}addSampler(e){return this.samplers.push(e),this}addTexture(e){return this.textures.push(e),this}addStorage(e){return this.storageBuffers.push(e),this}addUBO(e){e=new Vr(this.device,e);return this.uniformBlocks.push(e),this}writeToUBO(e,t,r){const s=this.uniformBlocks[e];return s&&s.write(t,r),this}getLayout(){const t=[];let r=0;return this.uniformBlocks.forEach(()=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,binding:r,buffer:{type:"uniform"}}),r++}),this.samplers.forEach(e=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,binding:r,sampler:{type:e.bindingType}}),r++}),this.textures.forEach(e=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,binding:r,texture:{sampleType:e.sampleType}}),r++}),this.storageBuffers.forEach(()=>{t.push({visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,binding:r,buffer:{type:"storage"}}),r++}),this.device.createBindGroupLayout({entries:t})}attachToPipeline(e){const r=[];let s=0;return this.uniformBlocks.forEach(e=>{r.push({binding:s,resource:{buffer:e.get(),offset:0,size:e.byteLength}}),s++}),this.samplers.forEach(e=>{r.push({binding:s,resource:e.get()}),s++}),this.textures.forEach((e,t)=>{r.push({binding:s,resource:e.get().createView()}),s++}),this.storageBuffers.forEach((e,t)=>{r.push({binding:s,resource:{buffer:e.get(),offset:0,size:e.byteLength}}),s++}),this.bindGroup=this.device.createBindGroup({layout:e.getBindGroupLayout(this.bindingIndex),entries:r}),this}destroy(){this.uniformBlocks.forEach(e=>e.destroy()),this.textures.forEach(e=>e.destroy()),this.samplers.forEach(e=>e.destroy()),this.storageBuffers.forEach(e=>e.destroy())}}class qr{constructor(e,t,r="float",s="2d",n="texture_2d<f32>"){this.device=e,this.name=t,this.sampleType=r,this.viewDimension=s,this.wglslTextureType=n}get(){return this.texture}fromImageBitmap(e,t="rgba8unorm",r=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT){return this.texture=this.device.createTexture({size:[e.width,e.height,1],format:t,usage:r}),this.device.queue.copyExternalImageToTexture({source:e},{texture:this.texture},[e.width,e.height]),this}fromDefinition(e){return this.texture=this.device.createTexture(e),this}copyFromTexture(e,t,r){return e.copyTextureToTexture(t,{texture:this.texture},r),this}destroy(){this.texture.destroy()}}const Yr="triangle-list",Xr=new Map([["mat4x4<f32>",[16,Float32Array.BYTES_PER_ELEMENT]],["mat3x3<f32>",[12,Float32Array.BYTES_PER_ELEMENT]],["vec4<f32>",[4,Float32Array.BYTES_PER_ELEMENT]],["vec3<f32>",[3,Float32Array.BYTES_PER_ELEMENT]],["vec2<f32>",[2,Float32Array.BYTES_PER_ELEMENT]],["f32",[1,Float32Array.BYTES_PER_ELEMENT]],["i32",[4,Int32Array.BYTES_PER_ELEMENT]],["u32",[1,Uint32Array.BYTES_PER_ELEMENT]],["i16",[1,Int16Array.BYTES_PER_ELEMENT]],["u16",[1,Uint16Array.BYTES_PER_ELEMENT]]]);class Qr{constructor(e){this.vertexCount=0,this.instanceCount=1,this.vertexBuffers=[],this.primitiveType=Yr,this.device=e}get hasIndex(){return!!this.indexBuffer}get stripIndexFormat(){var e;let t=void 0;return"line-strip"!==this.primitiveType&&"triangle-strip"!==this.primitiveType||(t=null!==(e=this.indexBuffer)&&void 0!==e&&e.isInt16?"uint16":"uint32"),t}addIndexBuffer(e){return this.vertexCount=e.itemsCount,this.indexBuffer=e,this}addVertexBuffer(e){return e.attributes.get("position")&&!this.vertexCount&&(this.vertexCount=e.itemsCount),this.vertexBuffers.push(e),this}getVertexBuffersLayout(){const e=[];let t=0;for(const r of this.vertexBuffers.values())e.push(r.getLayout(t)),t+=r.attributes.size;return e}draw(t){this.vertexBuffers.forEach(e=>e.bind(t)),this.indexBuffer?(this.indexBuffer.bind(t),t.drawIndexed(this.vertexCount,this.instanceCount)):t.draw(this.vertexCount,this.instanceCount)}destroy(){var e;null!==(e=this.indexBuffer)&&void 0!==e&&e.destroy(),this.vertexBuffers.forEach(e=>e.destroy())}}var Kr="undefined"!=typeof Float32Array?Float32Array:Array;function Jr(){var e=new Kr(16);return Kr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Zr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function es(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ts,rs=function(e,t,r){var s=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],d=t[7],h=t[8],l=t[9],f=t[10],p=t[11],m=t[12],g=t[13],y=t[14],b=t[15],v=r[0],w=r[1],x=r[2],t=r[3];return e[0]=v*s+w*a+x*h+t*m,e[1]=v*n+w*u+x*l+t*g,e[2]=v*i+w*c+x*f+t*y,e[3]=v*o+w*d+x*p+t*b,v=r[4],w=r[5],x=r[6],t=r[7],e[4]=v*s+w*a+x*h+t*m,e[5]=v*n+w*u+x*l+t*g,e[6]=v*i+w*c+x*f+t*y,e[7]=v*o+w*d+x*p+t*b,v=r[8],w=r[9],x=r[10],t=r[11],e[8]=v*s+w*a+x*h+t*m,e[9]=v*n+w*u+x*l+t*g,e[10]=v*i+w*c+x*f+t*y,e[11]=v*o+w*d+x*p+t*b,v=r[12],w=r[13],x=r[14],t=r[15],e[12]=v*s+w*a+x*h+t*m,e[13]=v*n+w*u+x*l+t*g,e[14]=v*i+w*c+x*f+t*y,e[15]=v*o+w*d+x*p+t*b,e};function ss(){var e=new Kr(3);return Kr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ns(e,t,r){var s=new Kr(3);return s[0]=e,s[1]=t,s[2]=r,s}function is(e,t,r,s){return e[0]=t,e[1]=r,e[2]=s,e}function os(e,t,r){var s=t[0],n=t[1],i=t[2],o=r[0],t=r[1],r=r[2];return e[0]=n*r-i*t,e[1]=i*o-s*r,e[2]=s*t-n*o,e}ss(),ts=new Kr(2),Kr!=Float32Array&&(ts[0]=0,ts[1]=0);class as{constructor(){this.position=ns(0,0,0),this.rotation=ns(0,0,0),this.scale=ns(1,1,1),this.modelMatrix=Jr(),this.shouldUpdate=!0}copyFromMatrix(e){return Zr(this.modelMatrix,e),this.shouldUpdate=!1,this}setPosition(e){var{x:t=this.position[0],y:r=this.position[1],z:e=this.position[2]}=e;return is(this.position,t,r,e),this.shouldUpdate=!0,this}setScale(e){var{x:t=this.scale[0],y:r=this.scale[1],z:e=this.scale[2]}=e;return is(this.scale,t,r,e),this.shouldUpdate=!0,this}setRotation(e){var{x:t=this.rotation[0],y:r=this.rotation[1],z:e=this.rotation[2]}=e;return is(this.rotation,t,r,e),this.shouldUpdate=!0,this}updateModelMatrix(){var e,t,r,s,n,i,o,a,u,c,d,h,l,f,p,m,g;return es(this.modelMatrix),f=this.modelMatrix,i=this.modelMatrix,l=this.position,h=l[0],p=l[1],c=l[2],i===f?(f[12]=i[0]*h+i[4]*p+i[8]*c+i[12],f[13]=i[1]*h+i[5]*p+i[9]*c+i[13],f[14]=i[2]*h+i[6]*p+i[10]*c+i[14],f[15]=i[3]*h+i[7]*p+i[11]*c+i[15]):(e=i[0],t=i[1],u=i[2],d=i[3],r=i[4],s=i[5],m=i[6],g=i[7],n=i[8],o=i[9],a=i[10],l=i[11],f[0]=e,f[1]=t,f[2]=u,f[3]=d,f[4]=r,f[5]=s,f[6]=m,f[7]=g,f[8]=n,f[9]=o,f[10]=a,f[11]=l,f[12]=e*h+r*p+n*c+i[12],f[13]=t*h+s*p+o*c+i[13],f[14]=u*h+m*p+a*c+i[14],f[15]=d*h+g*p+l*c+i[15]),o=this.modelMatrix,u=this.modelMatrix,m=this.rotation[0],a=Math.sin(m),f=Math.cos(m),d=u[4],h=u[5],g=u[6],p=u[7],l=u[8],c=u[9],i=u[10],m=u[11],u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=d*f+l*a,o[5]=h*f+c*a,o[6]=g*f+i*a,o[7]=p*f+m*a,o[8]=l*f-d*a,o[9]=c*f-h*a,o[10]=i*f-g*a,o[11]=m*f-p*a,u=this.modelMatrix,l=this.modelMatrix,d=this.rotation[1],c=Math.sin(d),h=Math.cos(d),i=l[0],g=l[1],o=l[2],m=l[3],f=l[8],p=l[9],a=l[10],d=l[11],l!==u&&(u[4]=l[4],u[5]=l[5],u[6]=l[6],u[7]=l[7],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[0]=i*h-f*c,u[1]=g*h-p*c,u[2]=o*h-a*c,u[3]=m*h-d*c,u[8]=i*c+f*h,u[9]=g*c+p*h,u[10]=o*c+a*h,u[11]=m*c+d*h,l=this.modelMatrix,i=this.modelMatrix,f=this.rotation[2],g=Math.sin(f),p=Math.cos(f),o=i[0],a=i[1],u=i[2],m=i[3],c=i[4],d=i[5],h=i[6],f=i[7],i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=o*p+c*g,l[1]=a*p+d*g,l[2]=u*p+h*g,l[3]=m*p+f*g,l[4]=c*p-o*g,l[5]=d*p-a*g,l[6]=h*p-u*g,l[7]=f*p-m*g,l=this.modelMatrix,f=this.modelMatrix,p=this.scale,m=p[0],g=p[1],p=p[2],l[0]=f[0]*m,l[1]=f[1]*m,l[2]=f[2]*m,l[3]=f[3]*m,l[4]=f[4]*g,l[5]=f[5]*g,l[6]=f[6]*g,l[7]=f[7]*g,l[8]=f[8]*p,l[9]=f[9]*p,l[10]=f[10]*p,l[11]=f[11]*p,l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],this.shouldUpdate=!1,this}}class us extends as{constructor(){super(...arguments),this.renderable=!1,this.parentNode=null,this.children=[],this.worldMatrix=Jr(),this.normalMatrix=Jr(),this.setParent=(e=null)=>{var t;return!this.parentNode||0<=(t=this.parentNode.children.indexOf(this))&&this.parentNode.children.splice(t,1),e&&e.children.push(this),this.parentNode=e,this},this.updateWorldMatrix=(e=null)=>{var t,r,s,n,i,o,a,u,c,d,h,l,f,p,m,g,y,b,v,w,x,_,E,T,A,M,I,S,B;return this.shouldUpdate&&this.updateModelMatrix(),e?rs(this.worldMatrix,e,this.modelMatrix):Zr(this.worldMatrix,this.modelMatrix),_=this.normalMatrix,B=this.worldMatrix,t=B[0],r=B[1],s=B[2],n=B[3],i=B[4],o=B[5],a=B[6],u=B[7],E=B[8],A=B[9],I=B[10],c=B[11],d=B[12],h=B[13],l=B[14],f=B[15],(B=(S=t*o-r*i)*(x=I*f-c*l)-(M=t*a-s*i)*(w=A*f-c*h)+(p=t*u-n*i)*(v=A*l-I*h)+(T=r*a-s*o)*(b=E*f-c*d)-(m=r*u-n*o)*(y=E*l-I*d)+(g=s*u-n*a)*(e=E*h-A*d))&&(_[0]=(o*x-a*w+u*v)*(B=1/B),_[1]=(s*w-r*x-n*v)*B,_[2]=(h*g-l*m+f*T)*B,_[3]=(I*m-A*g-c*T)*B,_[4]=(a*b-i*x-u*y)*B,_[5]=(t*x-s*b+n*y)*B,_[6]=(l*p-d*g-f*M)*B,_[7]=(E*g-I*p+c*M)*B,_[8]=(i*w-o*b+u*e)*B,_[9]=(r*b-t*w-n*e)*B,_[10]=(d*m-h*p+f*S)*B,_[11]=(A*p-E*m-c*S)*B,_[12]=(o*y-i*v-a*e)*B,_[13]=(t*v-r*y+s*e)*B,_[14]=(h*M-d*T-l*S)*B,_[15]=(E*T-A*M+I*S)*B),_=this.normalMatrix,E=this.normalMatrix,_===E?(T=E[1],A=E[2],M=E[3],I=E[6],S=E[7],B=E[11],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=T,_[6]=E[9],_[7]=E[13],_[8]=A,_[9]=I,_[11]=E[14],_[12]=M,_[13]=S,_[14]=B):(_[0]=E[0],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=E[1],_[5]=E[5],_[6]=E[9],_[7]=E[13],_[8]=E[2],_[9]=E[6],_[10]=E[10],_[11]=E[14],_[12]=E[3],_[13]=E[7],_[14]=E[11],_[15]=E[15]),this.children.forEach(e=>{e.updateWorldMatrix(this.worldMatrix)}),this},this.traverseGraph=(t,e=this)=>(t(e),this.children.forEach(e=>e.traverseGraph(t)),this)}}const cs=(e,t,r)=>Math.min(Math.max(e,t),r);class ds{constructor(){this.value=0,this.damping=.5}addForce(e){this.value+=e}update(){return 1e-6<this.value*this.value?this.value*=this.damping:this.stop(),this.value}stop(){this.value=0}}class hs{constructor(e,t=document.body,r=!1,s=1){this.target=ss(),this.minDistance=0,this.maxDistance=1/0,this.isEnabled=!0,this.targetXDampedAction=new ds,this.targetYDampedAction=new ds,this.targetZDampedAction=new ds,this.targetThetaDampedAction=new ds,this.targetPhiDampedAction=new ds,this.targetRadiusDampedAction=new ds,this._isShiftDown=!1,this._rotateStart={x:9999,y:9999},this._rotateEnd={x:9999,y:9999},this._roatteDelta={x:9999,y:9999},this._zoomDistanceEnd=0,this._zoomDistance=0,this.state="",this.loopId=0,this._panStart={x:0,y:0},this._panDelta={x:0,y:0},this._panEnd={x:0,y:0},this._paused=!1,this._isDebug=!1,this.mouseWheelForce=1,this.mouseWheelForce=s,this.camera=e,this.domElement=t,this.isDamping=!1,this.dampingFactor=.25,this.isZoom=!0,this.zoomSpeed=1,this.isRotate=!0,this.rotateSpeed=1,this.isPan=!0,this.keyPanSpeed=7,this.enableKeys=!0,this.keys={LEFT:"37",UP:"38",RIGHT:"39",BOTTOM:"40",SHIFT:"16"},this.originTarget=ss(),this.originPosition=ss(),this.originPosition[0]=e.position[0],this.originPosition[1]=e.position[0],this.originPosition[2]=e.position[0];s=this.camera.position[0],t=this.camera.position[1],e=this.camera.position[2],s=Math.sqrt(s*s+t*t+e*e),t=Math.atan2(this.camera.position[0],this.camera.position[2]),e=Math.acos(cs(this.camera.position[1]/s,-1,1));this._spherical={radius:s,theta:t,phi:e},this._bindEvens(),this.setEventHandler(),this.startTick(),(this._isDebug=r)&&(this._outputEl=document.createElement("div"),this._outputEl.setAttribute("style",`
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 999;
      font-family: monospace;
      font-size: 14px;
      user-select: none;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 3px 6px;
    `),document.body.appendChild(this._outputEl))}lookAt([e,t,r]){return is(this.target,e,t,r),this}setEventHandler(){this.domElement.addEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.addEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.addEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.addEventListener("touchstart",this._touchStartHandler,!1),this.domElement.addEventListener("touchmove",this._touchMoveHandler,!1),window.addEventListener("keydown",this._onKeyDownHandler,!1),window.addEventListener("keyup",this._onKeyUpHandler,!1)}removeEventHandler(){this.domElement.removeEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.removeEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.removeEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1),this.domElement.removeEventListener("touchstart",this._touchStartHandler,!1),this.domElement.removeEventListener("touchmove",this._touchMoveHandler,!1),window.removeEventListener("keydown",this._onKeyDownHandler,!1),window.removeEventListener("keydown",this._onKeyUpHandler,!1)}startTick(){this.loopId=requestAnimationFrame(this.tick)}pause(){this._paused=!0}start(){this._paused=!1}tick(){var e,t,r;this._paused||(this.updateDampedAction(),this.updateCamera(),this._isDebug&&(e=Math.round(100*this.camera.position[0])/100,t=Math.round(100*this.camera.position[1])/100,r=Math.round(100*this.camera.position[2])/100,this._outputEl.textContent=`x: ${e} y: ${t} z: ${r}`)),this.loopId=requestAnimationFrame(this.tick)}updateDampedAction(){this.target[0]+=this.targetXDampedAction.update(),this.target[1]+=this.targetYDampedAction.update(),this.target[2]+=this.targetZDampedAction.update(),this._spherical.theta+=this.targetThetaDampedAction.update(),this._spherical.phi+=this.targetPhiDampedAction.update(),this._spherical.radius+=this.targetRadiusDampedAction.update()}updateCamera(){var e=this._spherical,t=Math.sin(e.phi)*e.radius;this.camera.position[0]=t*Math.sin(e.theta)+this.target[0],this.camera.position[1]=Math.cos(e.phi)*e.radius+this.target[1],this.camera.position[2]=t*Math.cos(e.theta)+this.target[2],this.camera.lookAtPosition[0]=this.target[0],this.camera.lookAtPosition[1]=this.target[1],this.camera.lookAtPosition[2]=this.target[2],this.camera.updateViewMatrix()}_bindEvens(){this.tick=this.tick.bind(this),this._contextMenuHandler=this._contextMenuHandler.bind(this),this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._touchStartHandler=this._touchStartHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._onKeyDownHandler=this._onKeyDownHandler.bind(this),this._onKeyUpHandler=this._onKeyUpHandler.bind(this)}_contextMenuHandler(e){this.isEnabled&&e.preventDefault()}_mouseDownHandler(e){this.isEnabled&&(0===e.button?(this.state="rotate",this._rotateStart={x:e.clientX,y:e.clientY}):(this.state="pan",this._panStart={x:e.clientX,y:e.clientY}),this.domElement.addEventListener("mousemove",this._mouseMoveHandler,!1),window.addEventListener("mouseup",this._mouseUpHandler,!1))}_mouseUpHandler(){this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1)}_mouseMoveHandler(e){this.isEnabled&&("rotate"===this.state?(this._rotateEnd={x:e.clientX,y:e.clientY},this._roatteDelta={x:this._rotateEnd.x-this._rotateStart.x,y:this._rotateEnd.y-this._rotateStart.y},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y}):"pan"===this.state&&(this._panEnd={x:e.clientX,y:e.clientY},this._panDelta={x:-.5*(this._panEnd.x-this._panStart.x),y:.5*(this._panEnd.y-this._panStart.y)},this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}))}_mouseWheelHandler(e){var t=this.mouseWheelForce;0<e.deltaY?this.targetRadiusDampedAction.addForce(t):this.targetRadiusDampedAction.addForce(-t)}_touchStartHandler(e){var t,r;switch(e.touches.length){case 1:this.state="rotate",this._rotateStart={x:e.touches[0].clientX,y:e.touches[0].clientY};break;case 2:this.state="zoom",t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistance=Math.sqrt(t*t+r*r);break;case 3:this.state="pan",this._panStart={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3}}}_touchMoveHandler(e){var t;switch(e.preventDefault(),e.touches.length){case 1:if("rotate"!==this.state)return;this._rotateEnd={x:e.touches[0].clientX,y:e.touches[0].clientY},this._roatteDelta={x:.5*(this._rotateEnd.x-this._rotateStart.x),y:.5*(this._rotateEnd.y-this._rotateStart.y)},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y};break;case 2:if("zoom"!==this.state)return;t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistanceEnd=Math.sqrt(t*t+r*r);var r=this._zoomDistanceEnd-this._zoomDistance,r=this._spherical.radius-(r*=1.5),r=cs(r,this.minDistance,this.maxDistance);this._zoomDistance=this._zoomDistanceEnd,this._spherical.radius=r;break;case 3:this._panEnd={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3},this._panDelta={x:this._panEnd.x-this._panStart.x,y:this._panEnd.y-this._panStart.y},this._panDelta.x*=-1,this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}}}_onKeyDownHandler(e){let t=0,r=0;switch(e.key){case this.keys.SHIFT:this._isShiftDown=!0;break;case this.keys.LEFT:t=-10;break;case this.keys.RIGHT:t=10;break;case this.keys.UP:r=10;break;case this.keys.BOTTOM:r=-10}this._isShiftDown?(this._roatteDelta={x:-t,y:r},this._updateRotateHandler()):(this._panDelta={x:t,y:r},this._updatePanHandler())}_onKeyUpHandler(e){e.key===this.keys.SHIFT&&(this._isShiftDown=!1)}_updatePanHandler(){var e,t,r,s,n=ss(),i=ss();const o=ss();o[0]=this.target[0]-this.camera.position[0],o[1]=this.target[1]-this.camera.position[1],o[2]=this.target[2]-this.camera.position[2],e=o,t=o,r=t[0],s=t[1],a=t[2],0<(a=r*r+s*s+a*a)&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,os(n,o,[0,1,0]),os(i,n,o);var a=Math.max(this._spherical.radius/2e3,.001);this.targetXDampedAction.addForce((n[0]*this._panDelta.x+i[0]*this._panDelta.y)*a),this.targetYDampedAction.addForce((n[1]*this._panDelta.x+i[1]*this._panDelta.y)*a),this.targetZDampedAction.addForce((n[2]*this._panDelta.x+i[2]*this._panDelta.y)*a)}_updateRotateHandler(){this.targetThetaDampedAction.addForce(-this._roatteDelta.x/this.domElement.clientWidth),this.targetPhiDampedAction.addForce(-this._roatteDelta.y/this.domElement.clientHeight)}}class ls{constructor(e,t,r,s){this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=Jr(),this.viewMatrix=Jr(),this.zoom=1,this.fieldOfView=e,this.aspect=t,this.near=r,this.far=s,this.updateProjectionMatrix()}setPosition({x:e=this.position[0],y:t=this.position[1],z:r=this.position[2]}){return this.position=[e,t,r],this}updateViewMatrix(){var e,t,r,s,n,i,o,a,u,c,d,h,l,f;return e=this.viewMatrix,t=this.position,r=this.lookAtPosition,s=ls.UP_VECTOR,i=t[0],o=t[1],a=t[2],u=s[0],c=s[1],d=s[2],h=r[0],l=r[1],f=r[2],Math.abs(i-h)<1e-6&&Math.abs(o-l)<1e-6&&Math.abs(a-f)<1e-6?es(e):(n=i-h,t=o-l,s=a-f,h=c*(s*=r=1/Math.hypot(n,t,s))-d*(t*=r),l=d*(n*=r)-u*s,f=u*t-c*n,(r=Math.hypot(h,l,f))?(h*=r=1/r,l*=r,f*=r):f=l=h=0,d=t*f-s*l,u=s*h-n*f,c=n*l-t*h,(r=Math.hypot(d,u,c))?(d*=r=1/r,u*=r,c*=r):c=u=d=0,e[0]=h,e[1]=d,e[2]=n,e[3]=0,e[4]=l,e[5]=u,e[6]=t,e[7]=0,e[8]=f,e[9]=c,e[10]=s,e[11]=0,e[12]=-(h*i+l*o+f*a),e[13]=-(d*i+u*o+c*a),e[14]=-(n*i+t*o+s*a),e[15]=1),this}updateProjectionMatrix(){var e,t,r,s,n;return e=this.projectionMatrix,t=this.fieldOfView,r=this.aspect,s=this.near,n=this.far,t=1/Math.tan(t/2),e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+s)*(t=1/(s-n)),e[14]=2*n*s*t):(e[10]=-1,e[14]=-2*s),this}lookAt(e){return this.lookAtPosition=e,this.updateViewMatrix(),this}}ls.UP_VECTOR=[0,1,0];class fs extends us{constructor(e,{geometry:t,uniforms:r={},storages:s=[],textures:n=[],samplers:i=[],vertexShaderSource:o,fragmentShaderSource:a,multisample:u={},depthStencil:c={format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"},targets:d=[{format:"bgra8unorm"}],primitiveType:h=Yr}){super(),this.renderable=!0,this.uniforms={},t.primitiveType=h,this.device=e,this.geometry=t;let l=0;for(var[f,p]of Object.entries(r)){this.uniforms[f]=Object.assign({byteOffset:l},p);f=Xr.get(p.type);if(!f)throw new Error("cant find uniform mapping");var[p,f]=f;l+=p*f}const m=l?2:1,g=new Hr(e),y=new Gr(e);l&&g.addUniformInputs(r),g.addShaderVars(t.vertexBuffers,o.outputs).addSamplerInputs(i.map(({name:e,wglslSamplerType:t},r)=>({bindIdx:m+r,name:e,type:t}))).addTextureInputs(n.map(({name:e,wglslTextureType:t},r)=>({bindIdx:m+i.length+r,name:e,type:`${t}`}))).addStorages(s.map(({dataStride:e,structDefinition:t,name:r},s)=>({bindIdx:m+i.length+n.length+s,name:r,attributes:t,dataStride:e}))).addHeadSnippet(o.head).addMainFnSnippet(o.main),l&&y.addUniformInputs(r),y.addShaderVars(t.vertexBuffers,a.inputs,a.outputs).addSamplerInputs(i.map(({name:e,wglslSamplerType:t},r)=>({bindIdx:m+r,name:e,type:t}))).addTextureInputs(n.map(({name:e,wglslTextureType:t},r)=>({bindIdx:m+i.length+r,name:e,type:`${t}`}))).addStorages(s.map(({name:e,dataStride:t,structDefinition:r},s)=>({dataStride:t,bindIdx:m+i.length+n.length+s,name:e,attributes:r}))).addHeadSnippet(a.head).addMainFnSnippet(a.main),this.uboBindGroup=new Wr(e,0);var b,v;this.uboBindGroup.addUBO(64*Float32Array.BYTES_PER_ELEMENT),l&&this.uboBindGroup.addUBO(l);for({value:b,byteOffset:v}of Object.values(this.uniforms))this.uboBindGroup.writeToUBO(1,v,b);i.forEach(e=>this.uboBindGroup.addSampler(e)),n.map(e=>this.uboBindGroup.addTexture(e)),s.forEach(e=>this.uboBindGroup.addStorage(e));const w={layout:this.device.createPipelineLayout({bindGroupLayouts:[this.uboBindGroup.getLayout()]}),vertex:{module:g.shaderModule,entryPoint:zr.ENTRY_FUNCTION,buffers:t.getVertexBuffersLayout()},fragment:{module:y.shaderModule,entryPoint:zr.ENTRY_FUNCTION,targets:d},primitive:{topology:h,stripIndexFormat:t.stripIndexFormat},multisample:u};c&&(w.depthStencil=c),this.pipeline=e.createRenderPipeline(w),this.uboBindGroup.attachToPipeline(this.pipeline)}setUniform(e,t){e=this.uniforms[e];if(!e)throw new Error("Uniform does not belong to UBO");return this.uboBindGroup.writeToUBO(1,e.byteOffset,t),this}render(e,t){var r;this.updateWorldMatrix(null===(r=this.parentNode)||void 0===r?void 0:r.worldMatrix),this.uboBindGroup.writeToUBO(0,32*Float32Array.BYTES_PER_ELEMENT,this.worldMatrix).writeToUBO(0,48*Float32Array.BYTES_PER_ELEMENT,this.normalMatrix),this.uboBindGroup.writeToUBO(0,0,t.projectionMatrix).writeToUBO(0,16*Float32Array.BYTES_PER_ELEMENT,t.viewMatrix),this.uboBindGroup.bind(e),e.setPipeline(this.pipeline),this.geometry.draw(e)}destroy(){this.uboBindGroup.destroy()}}e(void 0,void 0,void 0,function*(){var e=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter();const t=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",e=>{document.body.innerHTML+=t}),window.addEventListener("error",e=>{document.body.innerHTML+=t}),e||(document.body.innerHTML+=t)}),e(void 0,void 0,void 0,function*(){var e=yield async function(e,t,r){Array.isArray(t)||Ie(t)||(r=t,t=void 0);const s=Te(r);let n=e;return"string"==typeof e&&(n=await s(e)),V(e)&&(n=await s(e)),He(n,t,r)}(`${window.ASSETS_BASE_URL}/Buggy.gltf`,Ar);const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const r=yield null===(s=navigator.gpu)||void 0===s?void 0:s.requestAdapter(),c=yield null===r||void 0===r?void 0:r.requestDevice(),n=t.getContext("webgpu");var s=n.getPreferredFormat(r);const d="triangle-list";n.configure({device:c,format:s});const i=new us;!function t(a,e=null){let u=new us;a.mesh&&a.mesh.primitives.map(e=>{const t=new Qr(c);if(e.attributes.POSITION){const i=new $r(c,0,e.attributes.POSITION.value,e.attributes.POSITION.bytesPerElement).addAttribute("position",0,e.attributes.POSITION.bytesPerElement,"float32x3");t.addVertexBuffer(i)}if(e.attributes.NORMAL){const o=new $r(c,1,e.attributes.NORMAL.value,e.attributes.NORMAL.bytesPerElement).addAttribute("normal",0,e.attributes.NORMAL.bytesPerElement,"float32x3");t.addVertexBuffer(o)}const r=new kr(c,e.indices.value);t.addIndexBuffer(r);const{material:{pbrMetallicRoughness:{baseColorFactor:s}}}=a.mesh.primitives[0],n=new fs(c,{geometry:t,uniforms:{baseColor:{type:"vec4<f32>",value:new Float32Array(s)}},multisample:{count:4},vertexShaderSource:{main:`
  let worldPosition: vec4<f32> = transform.modelMatrix * input.position;
  output.Position = transform.projectionMatrix *
                    transform.viewMatrix *
                    worldPosition;
  
  output.normal = transform.normalMatrix *
                  input.normal;

  output.position = worldPosition;
`},fragmentShaderSource:{main:`
  let normal: vec3<f32> = normalize(input.normal.rgb);
  let lightColor: vec3<f32> = vec3<f32>(1.0);

  // ambient light
  let ambientFactor: f32 = 0.1;
  let ambientLight: vec3<f32> = lightColor * ambientFactor;

  // diffuse light
  let lightDirection: vec3<f32> = normalize(vec3<f32>(0.5, 1.0, 4.0) - input.position.rgb);
  let diffuseStrength: f32 = max(dot(normal, lightDirection), 0.0);
  let diffuseLight: vec3<f32> = lightColor * diffuseStrength;

  // combine lighting
  let finalLight: vec3<f32> = diffuseLight + ambientLight;
  output.Color = vec4<f32>(inputUBO.baseColor.rgb * finalLight, 1.0);
`},primitiveType:d});n.setParent(u)});if(a.matrix)u.copyFromMatrix(a.matrix);else{const s=Ir();if(a.translation&&Sr(s,s,a.translation),a.rotation){const n=Pr(a.rotation[0],a.rotation[1],a.rotation[2],1),i=Ir();Ur(i,n),jr(s,s,i)}a.scale&&Br(s,s,a.scale),u.copyFromMatrix(s)}e&&u.setParent(e);const r=a.nodes||a.children;r&&r.length&&r.forEach(e=>{t(e,u)})}(e.scene,i);i.setPosition({x:-.5,y:-.1}).setScale({x:.02,y:.02,z:.02}).updateWorldMatrix();const o=new ls(45*Math.PI/180,t.width/t.height,.1,20).setPosition({x:.81,y:.31,z:3.91}).lookAt([0,0,0]).updateProjectionMatrix().updateViewMatrix();new hs(o,document.body,!1,.1).lookAt([0,.5,0]);const a=new qr(c,"texture_depth").fromDefinition({size:[t.width,t.height,1],sampleCount:4,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),u=new qr(c,"render_texture").fromDefinition({size:[t.width,t.height],sampleCount:4,format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT});requestAnimationFrame(function e(t){requestAnimationFrame(e);const r=c.createCommandEncoder();const s=r.beginRenderPass({colorAttachments:[{view:u.get().createView(),resolveTarget:n.getCurrentTexture().createView(),loadValue:[.1,.1,.1,1],storeOp:"store"}],depthStencilAttachment:{view:a.get().createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}});i.traverseGraph(e=>{e.renderable&&e.render(s,o)});s.endPass();c.queue.submit([r.finish()])})})}();
