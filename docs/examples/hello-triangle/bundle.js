!function(){"use strict";function t(t,a,s,u){return new(s=s||Promise)(function(i,e){function o(t){try{n(u.next(t))}catch(t){e(t)}}function r(t){try{n(u.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?i(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(o,r)}n((u=u.apply(t,a||[])).next())})}var e,i,f=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function a(){var t=new r(16);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function m(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,i){var o=new r(3);return o[0]=t,o[1]=e,o[2]=i,o}function n(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),e=new r(3),r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),i=new r(2),r!=Float32Array&&(i[0]=0,i[1]=0);class p{constructor(){this.position=o(0,0,0),this.rotation=o(0,0,0),this.scale=o(1,1,1),this.modelMatrix=a(),this.shouldUpdate=!0}copyFromMatrix(t){var e;return e=this.modelMatrix,t=t,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this.shouldUpdate=!1,this}setPosition(t){var{x:e=this.position[0],y:i=this.position[1],z:t=this.position[2]}=t;return n(this.position,e,i,t),this.shouldUpdate=!0,this}setScale(t){var{x:e=this.scale[0],y:i=this.scale[1],z:t=this.scale[2]}=t;return n(this.scale,e,i,t),this.shouldUpdate=!0,this}setRotation(t){var{x:e=this.rotation[0],y:i=this.rotation[1],z:t=this.rotation[2]}=t;return n(this.rotation,e,i,t),this.shouldUpdate=!0,this}updateModelMatrix(){var t,e,i,o,r,n,a,s,u,h,d,l,c,p,f,M,v;return m(this.modelMatrix),p=this.modelMatrix,n=this.modelMatrix,c=this.position,l=c[0],f=c[1],h=c[2],n===p?(p[12]=n[0]*l+n[4]*f+n[8]*h+n[12],p[13]=n[1]*l+n[5]*f+n[9]*h+n[13],p[14]=n[2]*l+n[6]*f+n[10]*h+n[14],p[15]=n[3]*l+n[7]*f+n[11]*h+n[15]):(t=n[0],e=n[1],u=n[2],d=n[3],i=n[4],o=n[5],M=n[6],v=n[7],r=n[8],a=n[9],s=n[10],c=n[11],p[0]=t,p[1]=e,p[2]=u,p[3]=d,p[4]=i,p[5]=o,p[6]=M,p[7]=v,p[8]=r,p[9]=a,p[10]=s,p[11]=c,p[12]=t*l+i*f+r*h+n[12],p[13]=e*l+o*f+a*h+n[13],p[14]=u*l+M*f+s*h+n[14],p[15]=d*l+v*f+c*h+n[15]),a=this.modelMatrix,u=this.modelMatrix,M=this.rotation[0],s=Math.sin(M),p=Math.cos(M),d=u[4],l=u[5],v=u[6],f=u[7],c=u[8],h=u[9],n=u[10],M=u[11],u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=d*p+c*s,a[5]=l*p+h*s,a[6]=v*p+n*s,a[7]=f*p+M*s,a[8]=c*p-d*s,a[9]=h*p-l*s,a[10]=n*p-v*s,a[11]=M*p-f*s,u=this.modelMatrix,c=this.modelMatrix,d=this.rotation[1],h=Math.sin(d),l=Math.cos(d),n=c[0],v=c[1],a=c[2],M=c[3],p=c[8],f=c[9],s=c[10],d=c[11],c!==u&&(u[4]=c[4],u[5]=c[5],u[6]=c[6],u[7]=c[7],u[12]=c[12],u[13]=c[13],u[14]=c[14],u[15]=c[15]),u[0]=n*l-p*h,u[1]=v*l-f*h,u[2]=a*l-s*h,u[3]=M*l-d*h,u[8]=n*h+p*l,u[9]=v*h+f*l,u[10]=a*h+s*l,u[11]=M*h+d*l,c=this.modelMatrix,n=this.modelMatrix,p=this.rotation[2],v=Math.sin(p),f=Math.cos(p),a=n[0],s=n[1],u=n[2],M=n[3],h=n[4],d=n[5],l=n[6],p=n[7],n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=a*f+h*v,c[1]=s*f+d*v,c[2]=u*f+l*v,c[3]=M*f+p*v,c[4]=h*f-a*v,c[5]=d*f-s*v,c[6]=l*f-u*v,c[7]=p*f-M*v,c=this.modelMatrix,p=this.modelMatrix,f=this.scale,M=f[0],v=f[1],f=f[2],c[0]=p[0]*M,c[1]=p[1]*M,c[2]=p[2]*M,c[3]=p[3]*M,c[4]=p[4]*v,c[5]=p[5]*v,c[6]=p[6]*v,c[7]=p[7]*v,c[8]=p[8]*f,c[9]=p[9]*f,c[10]=p[10]*f,c[11]=p[11]*f,c[12]=p[12],c[13]=p[13],c[14]=p[14],c[15]=p[15],this.shouldUpdate=!1,this}}class M{constructor(t,e,i,o,r,n){this.left=-1,this.right=1,this.top=1,this.bottom=-1,this.near=.1,this.far=2e3,this.zoom=1,this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=a(),this.viewMatrix=a(),this.left=t,this.right=e,this.top=i,this.bottom=o,this.near=r,this.far=n,this.updateProjectionMatrix()}setPosition({x:t=this.position[0],y:e=this.position[1],z:i=this.position[2]}){return this.position=[t,e,i],this}updateViewMatrix(){var t,e,i,o,r,n,a,s,u,h,d,l,c,p;return t=this.viewMatrix,e=this.position,i=this.lookAtPosition,o=M.UP_VECTOR,n=e[0],a=e[1],s=e[2],u=o[0],h=o[1],d=o[2],l=i[0],c=i[1],p=i[2],Math.abs(n-l)<f&&Math.abs(a-c)<f&&Math.abs(s-p)<f?m(t):(r=n-l,e=a-c,o=s-p,l=h*(o*=i=1/Math.hypot(r,e,o))-d*(e*=i),c=d*(r*=i)-u*o,p=u*e-h*r,(i=Math.hypot(l,c,p))?(l*=i=1/i,c*=i,p*=i):p=c=l=0,d=e*p-o*c,u=o*l-r*p,h=r*c-e*l,(i=Math.hypot(d,u,h))?(d*=i=1/i,u*=i,h*=i):h=u=d=0,t[0]=l,t[1]=d,t[2]=r,t[3]=0,t[4]=c,t[5]=u,t[6]=e,t[7]=0,t[8]=p,t[9]=h,t[10]=o,t[11]=0,t[12]=-(l*n+c*a+p*s),t[13]=-(d*n+u*a+h*s),t[14]=-(r*n+e*a+o*s),t[15]=1),this}updateProjectionMatrix(){var t,e,i,o,r,n,a,s,u,h;return t=this.projectionMatrix,e=this.left,i=this.right,o=this.bottom,r=this.top,n=this.near,a=this.far,s=1/(e-i),u=1/(o-r),h=1/(n-a),t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*s,t[13]=(r+o)*u,t[14]=(a+n)*h,t[15]=1,this}lookAt(t){return this.lookAtPosition=t,this.updateViewMatrix(),this}}M.UP_VECTOR=[0,1,0];t(void 0,void 0,void 0,function*(){var t=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter();const e=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",t=>{document.body.innerHTML+=e}),window.addEventListener("error",t=>{document.body.innerHTML+=e}),t||(document.body.innerHTML+=e)}),t(void 0,void 0,void 0,function*(){const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const e=yield null===(s=navigator.gpu)||void 0===s?void 0:s.requestAdapter(),i=yield null===e||void 0===e?void 0:e.requestDevice(),o=t.getContext("webgpu");var r=o.getPreferredFormat(e);o.configure({device:i,format:r});const n=new M(0,t.width,t.height,0,.1,3);n.setPosition({x:0,y:0,z:2}),n.lookAt([0,0,0]),n.updateProjectionMatrix(),n.updateViewMatrix();var a=(new p).setPosition({x:t.width/2,y:t.height/2,z:0}).updateModelMatrix(),s=new Float32Array([0,200,200,-200,-200,-200]);const u=i.createBuffer({size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(u.getMappedRange()).set(s),u.unmap();s=new Float32Array([1,0,0,0,1,0,0,0,1]);const h=i.createBuffer({size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(h.getMappedRange()).set(s),h.unmap();const d=i.createRenderPipeline({vertex:{module:i.createShaderModule({code:"\n[[block]]\nstruct Transform {\n  projectionMatrix: mat4x4<f32>;\n  viewMatrix: mat4x4<f32>;\n  modelMatrix: mat4x4<f32>;\n};\n\n[[group(0), binding(0)]]\nvar <uniform> transforms: Transform;\n\nstruct Input {\n  [[location(0)]] position: vec4<f32>;\n  [[location(1)]] color: vec3<f32>;\n};\n\nstruct Output {\n  [[builtin(position)]] Position : vec4<f32>;\n  [[location(0)]] vColor: vec3<f32>;\n};\n\n[[stage(vertex)]]\n\nfn main (input: Input) -> Output {\n  var output: Output;\n  \n  output.Position = transforms.projectionMatrix *\n                    transforms.viewMatrix *\n                    transforms.modelMatrix *\n                    input.position;\n\n  output.vColor = input.color;\n  return output;\n}"}),entryPoint:"main",buffers:[{arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:i.createShaderModule({code:"\nstruct Input {\n  [[location(0)]] vColor: vec3<f32>;\n};\n\n[[stage(fragment)]]\n\nfn main (input: Input) -> [[location(0)]] vec4<f32> {\n  return vec4<f32>(input.vColor, 1.0);\n}\n"}),entryPoint:"main",targets:[{format:r}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0}});s=i.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),r=i.createBindGroup({layout:d.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s,offset:0,size:48*Float32Array.BYTES_PER_ELEMENT}}]});i.queue.writeBuffer(s,0,n.projectionMatrix),i.queue.writeBuffer(s,16*Float32Array.BYTES_PER_ELEMENT,n.viewMatrix),i.queue.writeBuffer(s,32*Float32Array.BYTES_PER_ELEMENT,a.modelMatrix);const l=i.createCommandEncoder();a=o.getCurrentTexture().createView();const c=l.beginRenderPass({colorAttachments:[{view:a,loadValue:[.1,.1,.1,1],storeOp:"store"}]});c.setPipeline(d),c.setVertexBuffer(0,u),c.setVertexBuffer(1,h),c.setBindGroup(0,r),c.draw(3),c.endPass(),i.queue.submit([l.finish()])})}();
