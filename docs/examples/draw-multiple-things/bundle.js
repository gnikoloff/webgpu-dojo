!function(){"use strict";function t(t,s,o,h){return new(o=o||Promise)(function(r,e){function i(t){try{n(h.next(t))}catch(t){e(t)}}function a(t){try{n(h.throw(t))}catch(t){e(t)}}function n(t){var e;t.done?r(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(i,a)}n((h=h.apply(t,s||[])).next())})}const l="front",p="back",m="bottom",v="left",f="right";var y=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function H(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function E(t,e,r){var i=new a(3);return i[0]=t,i[1]=e,i[2]=r,i}function R(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function M(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function U(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function L(t,e){var r=e[0],i=e[1],a=e[2],a=r*r+i*i+a*a;return 0<a&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function s(t,e,r){var i=e[0],a=e[1],n=e[2],s=r[0],e=r[1],r=r[2];return t[0]=a*r-n*e,t[1]=n*s-i*r,t[2]=i*e-a*s,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var F=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function _(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}H(),_();class k{constructor(){this.position=E(0,0,0),this.rotation=E(0,0,0),this.scale=E(1,1,1),this.modelMatrix=n(),this.shouldUpdate=!0}copyFromMatrix(t){var e;return e=this.modelMatrix,t=t,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this.shouldUpdate=!1,this}setPosition(t){var{x:e=this.position[0],y:r=this.position[1],z:t=this.position[2]}=t;return R(this.position,e,r,t),this.shouldUpdate=!0,this}setScale(t){var{x:e=this.scale[0],y:r=this.scale[1],z:t=this.scale[2]}=t;return R(this.scale,e,r,t),this.shouldUpdate=!0,this}setRotation(t){var{x:e=this.rotation[0],y:r=this.rotation[1],z:t=this.rotation[2]}=t;return R(this.rotation,e,r,t),this.shouldUpdate=!0,this}updateModelMatrix(){var t,e,r,i,a,n,s,o,h,u,d,c,l,p,m,v,f;return g(this.modelMatrix),p=this.modelMatrix,n=this.modelMatrix,l=this.position,c=l[0],m=l[1],u=l[2],n===p?(p[12]=n[0]*c+n[4]*m+n[8]*u+n[12],p[13]=n[1]*c+n[5]*m+n[9]*u+n[13],p[14]=n[2]*c+n[6]*m+n[10]*u+n[14],p[15]=n[3]*c+n[7]*m+n[11]*u+n[15]):(t=n[0],e=n[1],h=n[2],d=n[3],r=n[4],i=n[5],v=n[6],f=n[7],a=n[8],s=n[9],o=n[10],l=n[11],p[0]=t,p[1]=e,p[2]=h,p[3]=d,p[4]=r,p[5]=i,p[6]=v,p[7]=f,p[8]=a,p[9]=s,p[10]=o,p[11]=l,p[12]=t*c+r*m+a*u+n[12],p[13]=e*c+i*m+s*u+n[13],p[14]=h*c+v*m+o*u+n[14],p[15]=d*c+f*m+l*u+n[15]),s=this.modelMatrix,h=this.modelMatrix,v=this.rotation[0],o=Math.sin(v),p=Math.cos(v),d=h[4],c=h[5],f=h[6],m=h[7],l=h[8],u=h[9],n=h[10],v=h[11],h!==s&&(s[0]=h[0],s[1]=h[1],s[2]=h[2],s[3]=h[3],s[12]=h[12],s[13]=h[13],s[14]=h[14],s[15]=h[15]),s[4]=d*p+l*o,s[5]=c*p+u*o,s[6]=f*p+n*o,s[7]=m*p+v*o,s[8]=l*p-d*o,s[9]=u*p-c*o,s[10]=n*p-f*o,s[11]=v*p-m*o,h=this.modelMatrix,l=this.modelMatrix,d=this.rotation[1],u=Math.sin(d),c=Math.cos(d),n=l[0],f=l[1],s=l[2],v=l[3],p=l[8],m=l[9],o=l[10],d=l[11],l!==h&&(h[4]=l[4],h[5]=l[5],h[6]=l[6],h[7]=l[7],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[0]=n*c-p*u,h[1]=f*c-m*u,h[2]=s*c-o*u,h[3]=v*c-d*u,h[8]=n*u+p*c,h[9]=f*u+m*c,h[10]=s*u+o*c,h[11]=v*u+d*c,l=this.modelMatrix,n=this.modelMatrix,p=this.rotation[2],f=Math.sin(p),m=Math.cos(p),s=n[0],o=n[1],h=n[2],v=n[3],u=n[4],d=n[5],c=n[6],p=n[7],n!==l&&(l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=s*m+u*f,l[1]=o*m+d*f,l[2]=h*m+c*f,l[3]=v*m+p*f,l[4]=u*m-s*f,l[5]=d*m-o*f,l[6]=c*m-h*f,l[7]=p*m-v*f,l=this.modelMatrix,p=this.modelMatrix,m=this.scale,v=m[0],f=m[1],m=m[2],l[0]=p[0]*v,l[1]=p[1]*v,l[2]=p[2]*v,l[3]=p[3]*v,l[4]=p[4]*f,l[5]=p[5]*f,l[6]=p[6]*f,l[7]=p[7]*f,l[8]=p[8]*m,l[9]=p[9]*m,l[10]=p[10]*m,l[11]=p[11]*m,l[12]=p[12],l[13]=p[13],l[14]=p[14],l[15]=p[15],this.shouldUpdate=!1,this}}const o=(t,e,r)=>Math.min(Math.max(t,e),r),P=(t,e,r)=>(r-t)/(e-t),S=t=>(t-=2*Math.floor(.5*t),t=Math.min(Math.max(t,0),2),1-Math.abs(t-1));class h{constructor(){this.value=0,this.damping=.5}addForce(t){this.value+=t}update(){return 1e-6<this.value*this.value?this.value*=this.damping:this.stop(),this.value}stop(){this.value=0}}class C{constructor(t,e=document.body,r=!1,i=1){this.target=H(),this.minDistance=0,this.maxDistance=1/0,this.isEnabled=!0,this.targetXDampedAction=new h,this.targetYDampedAction=new h,this.targetZDampedAction=new h,this.targetThetaDampedAction=new h,this.targetPhiDampedAction=new h,this.targetRadiusDampedAction=new h,this._isShiftDown=!1,this._rotateStart={x:9999,y:9999},this._rotateEnd={x:9999,y:9999},this._roatteDelta={x:9999,y:9999},this._zoomDistanceEnd=0,this._zoomDistance=0,this.state="",this.loopId=0,this._panStart={x:0,y:0},this._panDelta={x:0,y:0},this._panEnd={x:0,y:0},this._paused=!1,this._isDebug=!1,this.mouseWheelForce=1,this.mouseWheelForce=i,this.camera=t,this.domElement=e,this.isDamping=!1,this.dampingFactor=.25,this.isZoom=!0,this.zoomSpeed=1,this.isRotate=!0,this.rotateSpeed=1,this.isPan=!0,this.keyPanSpeed=7,this.enableKeys=!0,this.keys={LEFT:"37",UP:"38",RIGHT:"39",BOTTOM:"40",SHIFT:"16"},this.originTarget=H(),this.originPosition=H(),this.originPosition[0]=t.position[0],this.originPosition[1]=t.position[0],this.originPosition[2]=t.position[0];i=this.camera.position[0],e=this.camera.position[1],t=this.camera.position[2],i=Math.sqrt(i*i+e*e+t*t),e=Math.atan2(this.camera.position[0],this.camera.position[2]),t=Math.acos(o(this.camera.position[1]/i,-1,1));this._spherical={radius:i,theta:e,phi:t},this._bindEvens(),this.setEventHandler(),this.startTick(),(this._isDebug=r)&&(this._outputEl=document.createElement("div"),this._outputEl.setAttribute("style",`
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 999;
      font-family: monospace;
      font-size: 14px;
      user-select: none;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 3px 6px;
    `),document.body.appendChild(this._outputEl))}lookAt([t,e,r]){return R(this.target,t,e,r),this}setEventHandler(){this.domElement.addEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.addEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.addEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.addEventListener("touchstart",this._touchStartHandler,!1),this.domElement.addEventListener("touchmove",this._touchMoveHandler,!1),window.addEventListener("keydown",this._onKeyDownHandler,!1),window.addEventListener("keyup",this._onKeyUpHandler,!1)}removeEventHandler(){this.domElement.removeEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.removeEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.removeEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1),this.domElement.removeEventListener("touchstart",this._touchStartHandler,!1),this.domElement.removeEventListener("touchmove",this._touchMoveHandler,!1),window.removeEventListener("keydown",this._onKeyDownHandler,!1),window.removeEventListener("keydown",this._onKeyUpHandler,!1)}startTick(){this.loopId=requestAnimationFrame(this.tick)}pause(){this._paused=!0}start(){this._paused=!1}tick(){var t,e,r;this._paused||(this.updateDampedAction(),this.updateCamera(),this._isDebug&&(t=Math.round(100*this.camera.position[0])/100,e=Math.round(100*this.camera.position[1])/100,r=Math.round(100*this.camera.position[2])/100,this._outputEl.textContent=`x: ${t} y: ${e} z: ${r}`)),this.loopId=requestAnimationFrame(this.tick)}updateDampedAction(){this.target[0]+=this.targetXDampedAction.update(),this.target[1]+=this.targetYDampedAction.update(),this.target[2]+=this.targetZDampedAction.update(),this._spherical.theta+=this.targetThetaDampedAction.update(),this._spherical.phi+=this.targetPhiDampedAction.update(),this._spherical.radius+=this.targetRadiusDampedAction.update()}updateCamera(){var t=this._spherical,e=Math.sin(t.phi)*t.radius;this.camera.position[0]=e*Math.sin(t.theta)+this.target[0],this.camera.position[1]=Math.cos(t.phi)*t.radius+this.target[1],this.camera.position[2]=e*Math.cos(t.theta)+this.target[2],this.camera.lookAtPosition[0]=this.target[0],this.camera.lookAtPosition[1]=this.target[1],this.camera.lookAtPosition[2]=this.target[2],this.camera.updateViewMatrix()}_bindEvens(){this.tick=this.tick.bind(this),this._contextMenuHandler=this._contextMenuHandler.bind(this),this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._touchStartHandler=this._touchStartHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._onKeyDownHandler=this._onKeyDownHandler.bind(this),this._onKeyUpHandler=this._onKeyUpHandler.bind(this)}_contextMenuHandler(t){this.isEnabled&&t.preventDefault()}_mouseDownHandler(t){this.isEnabled&&(0===t.button?(this.state="rotate",this._rotateStart={x:t.clientX,y:t.clientY}):(this.state="pan",this._panStart={x:t.clientX,y:t.clientY}),this.domElement.addEventListener("mousemove",this._mouseMoveHandler,!1),window.addEventListener("mouseup",this._mouseUpHandler,!1))}_mouseUpHandler(){this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1)}_mouseMoveHandler(t){this.isEnabled&&("rotate"===this.state?(this._rotateEnd={x:t.clientX,y:t.clientY},this._roatteDelta={x:this._rotateEnd.x-this._rotateStart.x,y:this._rotateEnd.y-this._rotateStart.y},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y}):"pan"===this.state&&(this._panEnd={x:t.clientX,y:t.clientY},this._panDelta={x:-.5*(this._panEnd.x-this._panStart.x),y:.5*(this._panEnd.y-this._panStart.y)},this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}))}_mouseWheelHandler(t){var e=this.mouseWheelForce;0<t.deltaY?this.targetRadiusDampedAction.addForce(e):this.targetRadiusDampedAction.addForce(-e)}_touchStartHandler(t){var e,r;switch(t.touches.length){case 1:this.state="rotate",this._rotateStart={x:t.touches[0].clientX,y:t.touches[0].clientY};break;case 2:this.state="zoom",e=t.touches[1].clientX-t.touches[0].clientX,r=t.touches[1].clientY-t.touches[0].clientY,this._zoomDistance=Math.sqrt(e*e+r*r);break;case 3:this.state="pan",this._panStart={x:(t.touches[0].clientX+t.touches[1].clientX+t.touches[2].clientX)/3,y:(t.touches[0].clientY+t.touches[1].clientY+t.touches[2].clientY)/3}}}_touchMoveHandler(t){var e;switch(t.preventDefault(),t.touches.length){case 1:if("rotate"!==this.state)return;this._rotateEnd={x:t.touches[0].clientX,y:t.touches[0].clientY},this._roatteDelta={x:.5*(this._rotateEnd.x-this._rotateStart.x),y:.5*(this._rotateEnd.y-this._rotateStart.y)},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y};break;case 2:if("zoom"!==this.state)return;e=t.touches[1].clientX-t.touches[0].clientX,r=t.touches[1].clientY-t.touches[0].clientY,this._zoomDistanceEnd=Math.sqrt(e*e+r*r);var r=this._zoomDistanceEnd-this._zoomDistance,r=this._spherical.radius-(r*=1.5),r=o(r,this.minDistance,this.maxDistance);this._zoomDistance=this._zoomDistanceEnd,this._spherical.radius=r;break;case 3:this._panEnd={x:(t.touches[0].clientX+t.touches[1].clientX+t.touches[2].clientX)/3,y:(t.touches[0].clientY+t.touches[1].clientY+t.touches[2].clientY)/3},this._panDelta={x:this._panEnd.x-this._panStart.x,y:this._panEnd.y-this._panStart.y},this._panDelta.x*=-1,this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}}}_onKeyDownHandler(t){let e=0,r=0;switch(t.key){case this.keys.SHIFT:this._isShiftDown=!0;break;case this.keys.LEFT:e=-10;break;case this.keys.RIGHT:e=10;break;case this.keys.UP:r=10;break;case this.keys.BOTTOM:r=-10}this._isShiftDown?(this._roatteDelta={x:-e,y:r},this._updateRotateHandler()):(this._panDelta={x:e,y:r},this._updatePanHandler())}_onKeyUpHandler(t){t.key===this.keys.SHIFT&&(this._isShiftDown=!1)}_updatePanHandler(){var t=H(),e=H();const r=H();r[0]=this.target[0]-this.camera.position[0],r[1]=this.target[1]-this.camera.position[1],r[2]=this.target[2]-this.camera.position[2],L(r,r),s(t,r,[0,1,0]),s(e,t,r);var i=Math.max(this._spherical.radius/2e3,.001);this.targetXDampedAction.addForce((t[0]*this._panDelta.x+e[0]*this._panDelta.y)*i),this.targetYDampedAction.addForce((t[1]*this._panDelta.x+e[1]*this._panDelta.y)*i),this.targetZDampedAction.addForce((t[2]*this._panDelta.x+e[2]*this._panDelta.y)*i)}_updateRotateHandler(){this.targetThetaDampedAction.addForce(-this._roatteDelta.x/this.domElement.clientWidth),this.targetPhiDampedAction.addForce(-this._roatteDelta.y/this.domElement.clientHeight)}}class I{constructor(t,e,r,i){this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=n(),this.viewMatrix=n(),this.zoom=1,this.fieldOfView=t,this.aspect=e,this.near=r,this.far=i,this.updateProjectionMatrix()}setPosition({x:t=this.position[0],y:e=this.position[1],z:r=this.position[2]}){return this.position=[t,e,r],this}updateViewMatrix(){var t,e,r,i,a,n,s,o,h,u,d,c,l,p;return t=this.viewMatrix,e=this.position,r=this.lookAtPosition,i=I.UP_VECTOR,n=e[0],s=e[1],o=e[2],h=i[0],u=i[1],d=i[2],c=r[0],l=r[1],p=r[2],Math.abs(n-c)<y&&Math.abs(s-l)<y&&Math.abs(o-p)<y?g(t):(a=n-c,e=s-l,i=o-p,c=u*(i*=r=1/Math.hypot(a,e,i))-d*(e*=r),l=d*(a*=r)-h*i,p=h*e-u*a,(r=Math.hypot(c,l,p))?(c*=r=1/r,l*=r,p*=r):p=l=c=0,d=e*p-i*l,h=i*c-a*p,u=a*l-e*c,(r=Math.hypot(d,h,u))?(d*=r=1/r,h*=r,u*=r):u=h=d=0,t[0]=c,t[1]=d,t[2]=a,t[3]=0,t[4]=l,t[5]=h,t[6]=e,t[7]=0,t[8]=p,t[9]=u,t[10]=i,t[11]=0,t[12]=-(c*n+l*s+p*o),t[13]=-(d*n+h*s+u*o),t[14]=-(a*n+e*s+i*o),t[15]=1),this}updateProjectionMatrix(){var t,e,r,i,a;return t=this.projectionMatrix,e=this.fieldOfView,r=this.aspect,i=this.near,a=this.far,e=1/Math.tan(e/2),t[0]=e/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=(a+i)*(e=1/(i-a)),t[14]=2*a*i*e):(t[10]=-1,t[14]=-2*i),this}lookAt(t){return this.lookAtPosition=t,this.updateViewMatrix(),this}}function w(r,i,a,n,s,t,o,h,u,d=0,c=1,l=2,p=1,m=-1,v=0,f=0){var y=v,g=s/h,_=t/u;for(let e=0;e<=u;e++){var w=e*_-t/2;for(let t=0;t<=h;t++,v++){var x,A,E,M=t*g-s/2;r[3*v+d]=M*p,r[3*v+c]=w*m,r[3*v+l]=o/2,i[3*v+d]=0,i[3*v+c]=0,i[3*v+l]=0<=o?1:-1,a[2*v]=t/h,a[2*v+1]=1-e/u,e!==u&&t!==h&&(x=y+t+e*(h+1),A=y+t+(e+1)*(h+1),E=y+t+(e+1)*(h+1)+1,M=y+t+e*(h+1)+1,n[6*f]=x,n[6*f+1]=A,n[6*f+2]=M,n[6*f+3]=A,n[6*f+4]=E,n[6*f+5]=M,f++)}}}function e(t={}){var{width:e=1,height:r=1,depth:i=1,widthSegments:a=1,heightSegments:n=1,depthSegments:s=1}=t,o=a,h=n,u=s,d=(o+1)*(h+1)*2+(o+1)*(u+1)*2+(h+1)*(u+1)*2,c=6*(o*h*2+o*u*2+h*u*2),t=new Float32Array(3*d),a=new Float32Array(3*d),n=new Float32Array(2*d),s=new(65536<d?Uint32Array:Uint16Array)(c),d=0,c=0;return w(t,a,n,s,i,r,e,u,h,2,1,0,-1,-1,0,0),w(t,a,n,s,i,r,-e,u,h,2,1,0,1,-1,d+=(u+1)*(h+1),c+=u*h),w(t,a,n,s,e,i,r,u,h,0,2,1,1,1,d+=(u+1)*(h+1),c+=u*h),w(t,a,n,s,e,i,-r,u,h,0,2,1,1,-1,d+=(o+1)*(u+1),c+=o*u),w(t,a,n,s,e,r,-i,o,h,0,1,2,-1,-1,d+=(o+1)*(u+1),c+=o*u),w(t,a,n,s,e,r,i,o,h,0,1,2,1,-1,d+=(o+1)*(h+1),c+=o*h),{vertices:t,normal:a,uv:n,indices:s}}function r(t={}){var{width:e=1,height:r=1,depth:i=1,widthSegments:a=1,heightSegments:n=1,depthSegments:s=1}=t,o=a,h=n,u=s;const d=[];var c=(u+1)*(h+1),t=u*h*6,a=new Float32Array(3*c),n=new Float32Array(3*c),s=new Float32Array(2*c),c=new(65536<c?Uint32Array:Uint16Array)(t);w(a,n,s,c,i,r,e,u,h,2,1,0,-1,-1,0,0),d.push({orientation:f,vertices:a,normal:n,uv:s,indices:c});t=(u+1)*(h+1),a=u*h*6,n=new Float32Array(3*t),s=new Float32Array(3*t),c=new Float32Array(2*t),t=new(65536<t?Uint32Array:Uint16Array)(a);w(n,s,c,t,i,r,-e,u,h,2,1,0,1,-1,0,0),d.push({orientation:v,vertices:n,normal:s,uv:c,indices:t});a=(u+1)*(h+1),n=u*h*6,s=new Float32Array(3*a),c=new Float32Array(3*a),t=new Float32Array(2*a),a=new(65536<a?Uint32Array:Uint16Array)(n);w(s,c,t,a,e,i,r,u,h,0,2,1,1,1,0,0),d.push({orientation:"top",vertices:s,normal:c,uv:t,indices:a});n=(u+1)*(h+1),s=u*h*6,c=new Float32Array(3*n),t=new Float32Array(3*n),a=new Float32Array(2*n),s=new(65536<n?Uint32Array:Uint16Array)(s);w(c,t,a,s,e,i,-r,u,h,0,2,1,1,-1,0,0),d.push({orientation:m,vertices:c,normal:t,uv:a,indices:s});c=(o+1)*(u+1),t=o*u*6,a=new Float32Array(3*c),s=new Float32Array(3*c),u=new Float32Array(2*c),c=new(65536<c?Uint32Array:Uint16Array)(t);w(a,s,u,c,e,r,-i,o,h,0,1,2,-1,-1,0,0),d.push({orientation:p,vertices:a,normal:s,uv:u,indices:c});t=(o+1)*(h+1),a=o*h*6,s=new Float32Array(3*t),u=new Float32Array(3*t),c=new Float32Array(2*t),a=new(65536<t?Uint32Array:Uint16Array)(a);return w(s,u,c,a,e,r,i,o,h,0,1,2,1,-1,0,0),d.push({orientation:l,vertices:s,normal:u,uv:c,indices:a}),d}I.UP_VECTOR=[0,1,0];class u{static xp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=r,e[1]=-t,e[2]=i,e}static xn(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=r,e[1]=t,e[2]=-i,e}static yp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=-t,e[1]=i,e[2]=r,e}static yn(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=t,e[1]=i,e[2]=-r,e}static zp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=i,e[1]=-r,e[2]=t,e}static zn(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=-i,e[1]=r,e[2]=t,e}static xp_yn(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=-i,e[1]=-t,e[2]=r,e}static xp_yp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=i,e[1]=-t,e[2]=-r,e}static xp_yp_yp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=-r,e[1]=-t,e[2]=-i,e}static xp_xp(t,e){var r=t[0],i=t[1],t=t[2];return e[0]=r,e[1]=-i,e[2]=-t,e}}var i=({width:t=1,height:e=1,depth:r=1,radius:i=.5,div:a=4})=>{i=function(t=2,e=2,r=2,n=.5,s=4){const o=t/2,i=e/2,h=r/2,u=2*s,d=[],c=[],l=[],p=H();let a,m,v,f,y,g,_,w;_=i;const x=[E(n-o,i-n,n-h),E(o-n,i-n,n-h),E(n-o,i-n,h-n),E(o-n,i-n,h-n)],A=(t,e)=>{var r,i,a=P(-h,h,t);for(v=0;v<=u;v++)i=v<=s?0:1,r=S(v/s),y=v<=s?-1:1,g=o*y+n*r*-y,R(p,g,_,t),F(p,p,x[i|e]),L(p,p),l.push(p[0],p[1],p[2]),U(p,p,n),M(p,p,x[i|e]),d.push(p[0],p[1],p[2]),c.push(P(-o,o,g),a),1==r&&(R(p,o-n,_,t),F(p,p,x[1|e]),L(p,p),l.push(p[0],p[1],p[2]),U(p,p,n),M(p,p,x[1|e]),d.push(p[0],p[1],p[2]),c.push(P(-o,o,o-n),a))};for(m=0;m<=u;m++)a=m<=s?0:2,f=S(m/s),y=m<=s?-1:1,w=h*y+n*f*-y,A(w,a),1==f&&A(h-n,2);return{verts:d,uv:c,norm:l,indices:function(t,e){let r=[],i=t+1,a,n,s,o,h,u;for(n=0;n<e;n++)for(a=0;a<t;a++)s=n*i+a,o=s+i,h=o+1,u=s+1,r.push(s,o,h,h,u,s);return r}(1+u,1+u)}}(t,e,r,i,a),a={verts:[],indices:[],uv:[],norm:[]};return d(a,i,(t,e)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e)),d(a,i,u.xp),d(a,i,u.xp_yp),d(a,i,u.xp_yp_yp),d(a,i,u.xp_yn),d(a,i,u.xp_xp),{vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}};function d(e,r,i){var t=e.verts.length/3,a=r.verts.length;const n=H(),s=H();for(let t=0;t<a;t+=3)R(n,r.verts[t],r.verts[t+1],r.verts[t+2]),i(n,s),e.verts.push(s[0],s[1],s[2]),R(n,r.norm[t],r.norm[t+1],r.norm[t+2]),i(n,s),e.norm.push(s[0],s[1],s[2]);for(const n of r.uv)e.uv.push(n);for(const n of r.indices)e.indices.push(t+n)}var c=({width:t=1,height:e=1,depth:r=1,radius:i=.5,div:a=4})=>{i=function(t=2,e=2,r=2,n=.5,s=4){const o=t/2,i=e/2,h=r/2,u=2*s,d=[],c=[],l=[],p=H();let a,m,v,f,y,g,_,w;_=i;const x=[E(n-o,i-n,n-h),E(o-n,i-n,n-h),E(n-o,i-n,h-n),E(o-n,i-n,h-n)],A=(t,e)=>{var r,i,a=P(-h,h,t);for(v=0;v<=u;v++)i=v<=s?0:1,r=S(v/s),y=v<=s?-1:1,g=o*y+n*r*-y,R(p,g,_,t),F(p,p,x[i|e]),L(p,p),l.push(p[0],p[1],p[2]),U(p,p,n),M(p,p,x[i|e]),d.push(p[0],p[1],p[2]),c.push(P(-o,o,g),a),1==r&&(R(p,o-n,_,t),F(p,p,x[1|e]),L(p,p),l.push(p[0],p[1],p[2]),U(p,p,n),M(p,p,x[1|e]),d.push(p[0],p[1],p[2]),c.push(P(-o,o,o-n),a))};for(m=0;m<=u;m++)a=m<=s?0:2,f=S(m/s),y=m<=s?-1:1,w=h*y+n*f*-y,A(w,a),1==f&&A(h-n,2);return{verts:d,uv:c,norm:l,indices:function(t,e){let r=[],i=t+1,a,n,s,o,h,u;for(n=0;n<e;n++)for(a=0;a<t;a++)s=n*i+a,o=s+i,h=o+1,u=s+1,r.push(s,o,h,h,u,s);return r}(1+u,1+u)}}(t,e,r,i,a);const n=[];a={verts:[],indices:[],uv:[],norm:[]};return x(a,i,(t,e)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e)),n.push({orientation:"top",vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),x(a={verts:[],indices:[],uv:[],norm:[]},i,u.xp),n.push({orientation:l,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),x(a={verts:[],indices:[],uv:[],norm:[]},i,u.xp_yp),n.push({orientation:v,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),x(a={verts:[],indices:[],uv:[],norm:[]},i,u.xp_yp_yp),n.push({orientation:p,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),x(a={verts:[],indices:[],uv:[],norm:[]},i,u.xp_yn),n.push({orientation:f,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),x(a={verts:[],indices:[],uv:[],norm:[]},i,u.xp_xp),n.push({orientation:m,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),n};function x(e,r,i){var t=e.verts.length/3,a=r.verts.length;const n=H(),s=H();for(let t=0;t<a;t+=3)R(n,r.verts[t],r.verts[t+1],r.verts[t+2]),i(n,s),e.verts.push(s[0],s[1],s[2]),R(n,r.norm[t],r.norm[t+1],r.norm[t+2]),i(n,s),e.norm.push(s[0],s[1],s[2]);for(const n of r.uv)e.uv.push(n);for(const n of r.indices)e.indices.push(t+n)}function A(t={}){var{radius:r=1,segments:i=8,thetaStart:a=0,thetaLength:n=2*Math.PI}=t;const e=[],s=[],o=[],h=[],u=H(),d=_();s.push(0,0,0),o.push(0,0,1),h.push(.5,.5);for(let t=0,e=3;t<=i;t++,e+=3){var c=a+t/i*n;u[0]=r*Math.cos(c),u[1]=r*Math.sin(c),s.push(...u),o.push(0,0,1),d[0]=(s[e]/r+1)/2,d[1]=(s[e+1]/r+1)/2,h.push(d[0],d[1])}for(let t=1;t<=i;t++)e.push(t,t+1,0);return{indices:new(65536<i?Uint32Array:Uint16Array)(e),vertices:new Float32Array(s),normal:new Float32Array(o),uv:new Float32Array(h)}}function D(t={}){var{width:e=1,height:r=1,widthSegments:i=1,heightSegments:a=1}=t,n=i,s=a,o=(n+1)*(s+1),h=n*s*6,t=new Float32Array(3*o),i=new Float32Array(3*o),a=new Float32Array(2*o),h=new(65536<o?Uint32Array:Uint16Array)(h);return w(t,i,a,h,e,r,0,n,s),{vertices:t,normal:i,uv:a,indices:h}}function B(t={}){var{radius:e=.5,widthSegments:r=16,heightSegments:i=Math.ceil(.5*r),phiStart:a=0,phiLength:n=2*Math.PI,thetaStart:s=0,thetaLength:t=Math.PI}=t,o=r,h=i,u=a,d=n,c=s,l=t,s=(o+1)*(h+1),t=o*h*6;const p=new Float32Array(3*s),m=new Float32Array(3*s),v=new Float32Array(2*s),f=new(65536<s?Uint32Array:Uint16Array)(t);let y=0,g=0,_=0;var w=c+l;const x=[];var A=H();for(let t=0;t<=h;t++){const T=[];var E=t/h;for(let t=0;t<=o;t++,y++){var M=t/o,U=-e*Math.cos(u+M*d)*Math.sin(c+E*l),F=e*Math.cos(c+E*l),P=e*Math.sin(u+M*d)*Math.sin(c+E*l);R(A,p[3*y]=U,p[3*y+1]=F,p[3*y+2]=P),L(A,A),m[3*y]=A[0],m[3*y+1]=A[1],m[3*y+2]=A[2],v[2*y]=M,v[2*y+1]=1-E,T.push(g++)}x.push(T)}for(let e=0;e<h;e++)for(let t=0;t<o;t++){var S=x[e][t+1],D=x[e][t],B=x[e+1][t],b=x[e+1][t+1];(0!==e||0<c)&&(f[3*_]=S,f[3*_+1]=D,f[3*_+2]=b,_++),(e!==h-1||w<Math.PI)&&(f[3*_]=D,f[3*_+1]=B,f[3*_+2]=b,_++)}return{vertices:p,normal:m,uv:v,indices:f}}function b(t={}){var{radius:r=.5,tube:i=.35,arc:a=2*Math.PI,radialSegments:e=8,tubularSegments:t=6}=t,n=Math.floor(e),s=Math.floor(t);const o=[],h=[],u=[],d=[],c=H(),l=H();var p=H();for(let e=0;e<=n;e++)for(let t=0;t<=s;t++){var m=t/s*a,v=e/n*Math.PI*2;l[0]=(r+i*Math.cos(v))*Math.cos(m),l[1]=(r+i*Math.cos(v))*Math.sin(m),l[2]=i*Math.sin(v),h.push(l[0],l[1],l[2]),c[0]=r*Math.cos(m),c[1]=r*Math.sin(m),F(p,l,c),L(p,p),u.push(p[0],p[1],p[0]),d.push(t/s,e/n)}for(let e=1;e<=n;e++)for(let t=1;t<=s;t++){var f=(s+1)*e+t-1,y=(s+1)*(e-1)+t-1,g=(s+1)*(e-1)+t,_=(s+1)*e+t;o.push(f,y,_),o.push(y,g,_)}return{indices:new(65536<(n+1)*(s+1)?Uint32Array:Uint16Array)(o),vertices:new Float32Array(h),normal:new Float32Array(u),uv:new Float32Array(d)}}var O=Object.freeze({__proto__:null,createBox:e,createBoxSeparateFace:r,createRoundedBoxSeparateFace:c,createRoundedBox:i,createCircle:A,createPlane:D,createSphere:B,createTorus:b,GeometryUtils:{createBox:e,createBoxSeparateFace:r,createRoundedBoxSeparateFace:c,createRoundedBox:i,createCircle:A,createPlane:D,createSphere:B,createTorus:b}});t(void 0,void 0,void 0,function*(){var t=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter();const e=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",t=>{document.body.innerHTML+=e}),window.addEventListener("error",t=>{document.body.innerHTML+=e}),t||(document.body.innerHTML+=e)}),t(void 0,void 0,void 0,function*(){const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const e=yield null===(r=navigator.gpu)||void 0===r?void 0:r.requestAdapter(),a=yield null===e||void 0===e?void 0:e.requestDevice(),n=t.getContext("webgpu");var r=n.getPreferredFormat(e);n.configure({device:a,format:r});const{vertices:i,normal:s,indices:o}=O.createBox(),h=a.createBuffer({size:i.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(h.getMappedRange()).set(i),h.unmap();const u=a.createBuffer({size:s.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(u.getMappedRange()).set(s),u.unmap();const d=a.createBuffer({size:o.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new(o instanceof Uint16Array?Uint16Array:Uint32Array)(d.getMappedRange()).set(o),d.unmap();const{vertices:c,normal:l,indices:p}=O.createSphere({widthSegments:30,heightSegments:30}),m=a.createBuffer({size:c.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(m.getMappedRange()).set(c),m.unmap();const v=a.createBuffer({size:l.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(v.getMappedRange()).set(l),v.unmap();const f=a.createBuffer({size:p.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new(p instanceof Uint16Array?Uint16Array:Uint32Array)(f.getMappedRange()).set(p),f.unmap();const{vertices:y,normal:g,indices:_}=O.createTorus({radialSegments:25,tubularSegments:25}),w=a.createBuffer({size:y.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(w.getMappedRange()).set(y),w.unmap();const x=a.createBuffer({size:g.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(x.getMappedRange()).set(g),x.unmap();const A=a.createBuffer({size:_.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new(_ instanceof Uint16Array?Uint16Array:Uint32Array)(A.getMappedRange()).set(_),A.unmap();const E=a.createRenderPipeline({vertex:{module:a.createShaderModule({code:"\n[[block]]\nstruct Camera {\n  projectionMatrix: mat4x4<f32>;\n  viewMatrix: mat4x4<f32>;\n};\n\n[[group(0), binding(0)]]\nvar<uniform> camera: Camera;\n\n[[block]]\nstruct Transform {\n  modelMatrix: mat4x4<f32>;\n};\n[[group(1), binding(0)]]\nvar <uniform> transform: Transform;\n\nstruct Input {\n  [[location(0)]] position: vec4<f32>;\n  [[location(1)]] normal: vec3<f32>;\n};\n\nstruct Output {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] normal: vec3<f32>;\n};\n\n[[stage(vertex)]]\nfn main (input: Input) -> Output {\n  var output: Output;\n\n  output.Position = camera.projectionMatrix *\n                    camera.viewMatrix *\n                    transform.modelMatrix *\n                    input.position;\n                    \n  output.normal = input.normal;\n\n  return output;\n}\n"}),entryPoint:"main",buffers:[{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:a.createShaderModule({code:"\nstruct Input {\n  [[location(0)]] normal: vec3<f32>;\n};\n\n[[stage(fragment)]]\n\nfn main (input: Input) -> [[location(0)]] vec4<f32> {\n  return vec4<f32>(normalize(input.normal) * 0.5 + 0.5, 1.0);\n}\n"}),entryPoint:"main",targets:[{format:r}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0},multisample:{count:4},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),M=a.createBuffer({size:32*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),U=a.createBindGroup({layout:E.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:M,offset:0,size:32*Float32Array.BYTES_PER_ELEMENT}}]}),F=a.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),P=a.createBindGroup({layout:E.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:F,offset:0,size:16*Float32Array.BYTES_PER_ELEMENT}}]}),S=a.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),D=a.createBindGroup({layout:E.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:S,offset:0,size:16*Float32Array.BYTES_PER_ELEMENT}}]}),B=a.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),b=a.createBindGroup({layout:E.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:B,offset:0,size:16*Float32Array.BYTES_PER_ELEMENT}}]}),T=new I(45*Math.PI/180,t.width/t.height,.1,100);T.setPosition({x:0,y:1.5,z:-4}),T.lookAt([0,0,0]),T.updateProjectionMatrix(),T.updateViewMatrix(),new C(T);const H=new k,R=new k,L=new k,G=a.createTexture({size:[t.width,t.height,1],format:"depth24plus",sampleCount:4,usage:GPUTextureUsage.RENDER_ATTACHMENT}),z=a.createTexture({size:[t.width,t.height],sampleCount:4,format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT});let Y=z.createView();requestAnimationFrame(function t(e){requestAnimationFrame(t);e/=1e3;const r=a.createCommandEncoder();const i=r.beginRenderPass({colorAttachments:[{view:Y,resolveTarget:n.getCurrentTexture().createView(),loadValue:[.1,.1,.1,1],storeOp:"store"}],depthStencilAttachment:{view:G.createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}});i.setPipeline(E);i.setBindGroup(0,U);a.queue.writeBuffer(M,0,T.projectionMatrix);a.queue.writeBuffer(M,16*Float32Array.BYTES_PER_ELEMENT,T.viewMatrix);H.setPosition({x:-2,y:.5*Math.sin(e)}).setRotation({y:.2*e}).updateModelMatrix();i.setBindGroup(1,P);a.queue.writeBuffer(F,0,H.modelMatrix);i.setVertexBuffer(0,h);i.setVertexBuffer(1,u);i.setIndexBuffer(d,o instanceof Uint16Array?"uint16":"uint32");i.drawIndexed(o.length);R.setPosition({x:2,y:.5*Math.sin(e+.5)}).setRotation({y:-.2*e}).updateModelMatrix();i.setBindGroup(1,D);a.queue.writeBuffer(S,0,R.modelMatrix);i.setVertexBuffer(0,m);i.setVertexBuffer(1,v);i.setIndexBuffer(f,p instanceof Uint16Array?"uint16":"uint32");i.drawIndexed(p.length);L.setPosition({x:0,y:.5*Math.sin(e+1)}).setRotation({z:-.2*e,y:-.6*e}).updateModelMatrix();i.setBindGroup(1,b);a.queue.writeBuffer(B,0,L.modelMatrix);i.setVertexBuffer(0,w);i.setVertexBuffer(1,x);i.setIndexBuffer(A,_ instanceof Uint16Array?"uint16":"uint32");i.drawIndexed(_.length);i.endPass();a.queue.submit([r.finish()])})})}();
