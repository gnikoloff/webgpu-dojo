!function(){"use strict";function t(t,o,s,u){return new(s=s||Promise)(function(r,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function a(t){try{i(u.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(n,a)}i((u=u.apply(t,o||[])).next())})}var e,p="undefined"!=typeof Float32Array?Float32Array:Array;function q(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y(t,e,r){var n,a,i,o,s,u,c,h,l,d,p,v=r[0],f=r[1],y=r[2];return e===t?(t[12]=e[0]*v+e[4]*f+e[8]*y+e[12],t[13]=e[1]*v+e[5]*f+e[9]*y+e[13],t[14]=e[2]*v+e[6]*f+e[10]*y+e[14],t[15]=e[3]*v+e[7]*f+e[11]*y+e[15]):(n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],d=e[9],p=e[10],r=e[11],t[0]=n,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=d,t[10]=p,t[11]=r,t[12]=n*v+s*f+l*y+e[12],t[13]=a*v+u*f+d*y+e[13],t[14]=i*v+c*f+p*y+e[14],t[15]=o*v+h*f+r*y+e[15]),t}function D(t,e,r,n){var a=e[0],i=e[1],o=e[2],s=n[0],u=n[1],c=n[2],h=a-r[0],l=i-r[1],e=o-r[2],n=h*h+l*l+e*e;0<n&&(h*=n=1/Math.sqrt(n),l*=n,e*=n);r=u*e-c*l,c=c*h-s*e,u=s*l-u*h;return 0<(n=r*r+c*c+u*u)&&(r*=n=1/Math.sqrt(n),c*=n,u*=n),t[0]=r,t[1]=c,t[2]=u,t[3]=0,t[4]=l*u-e*c,t[5]=e*r-h*u,t[6]=h*c-l*r,t[7]=0,t[8]=h,t[9]=l,t[10]=e,t[11]=0,t[12]=a,t[13]=i,t[14]=o,t[15]=1,t}function j(t,e,r){var n=new p(3);return n[0]=t,n[1]=e,n[2]=r,n}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),e=new p(3),p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0);const d="front",v="back",f="bottom",y="left",m="right";var w=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function F(t,e,r){var n=new a(3);return n[0]=t,n[1]=e,n[2]=r,n}function L(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function U(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function P(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function C(t,e){var r=e[0],n=e[1],a=e[2],a=r*r+n*n+a*a;return 0<a&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var E=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function g(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}I(),g();class H{constructor(){this.position=F(0,0,0),this.rotation=F(0,0,0),this.scale=F(1,1,1),this.modelMatrix=i(),this.shouldUpdate=!0}copyFromMatrix(t){var e;return e=this.modelMatrix,t=t,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this.shouldUpdate=!1,this}setPosition(t){var{x:e=this.position[0],y:r=this.position[1],z:t=this.position[2]}=t;return L(this.position,e,r,t),this.shouldUpdate=!0,this}setScale(t){var{x:e=this.scale[0],y:r=this.scale[1],z:t=this.scale[2]}=t;return L(this.scale,e,r,t),this.shouldUpdate=!0,this}setRotation(t){var{x:e=this.rotation[0],y:r=this.rotation[1],z:t=this.rotation[2]}=t;return L(this.rotation,e,r,t),this.shouldUpdate=!0,this}updateModelMatrix(){var t,e,r,n,a,i,o,s,u,c,h,l,d,p,v,f,y;return A(this.modelMatrix),p=this.modelMatrix,i=this.modelMatrix,d=this.position,l=d[0],v=d[1],c=d[2],i===p?(p[12]=i[0]*l+i[4]*v+i[8]*c+i[12],p[13]=i[1]*l+i[5]*v+i[9]*c+i[13],p[14]=i[2]*l+i[6]*v+i[10]*c+i[14],p[15]=i[3]*l+i[7]*v+i[11]*c+i[15]):(t=i[0],e=i[1],u=i[2],h=i[3],r=i[4],n=i[5],f=i[6],y=i[7],a=i[8],o=i[9],s=i[10],d=i[11],p[0]=t,p[1]=e,p[2]=u,p[3]=h,p[4]=r,p[5]=n,p[6]=f,p[7]=y,p[8]=a,p[9]=o,p[10]=s,p[11]=d,p[12]=t*l+r*v+a*c+i[12],p[13]=e*l+n*v+o*c+i[13],p[14]=u*l+f*v+s*c+i[14],p[15]=h*l+y*v+d*c+i[15]),o=this.modelMatrix,u=this.modelMatrix,f=this.rotation[0],s=Math.sin(f),p=Math.cos(f),h=u[4],l=u[5],y=u[6],v=u[7],d=u[8],c=u[9],i=u[10],f=u[11],u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=h*p+d*s,o[5]=l*p+c*s,o[6]=y*p+i*s,o[7]=v*p+f*s,o[8]=d*p-h*s,o[9]=c*p-l*s,o[10]=i*p-y*s,o[11]=f*p-v*s,u=this.modelMatrix,d=this.modelMatrix,h=this.rotation[1],c=Math.sin(h),l=Math.cos(h),i=d[0],y=d[1],o=d[2],f=d[3],p=d[8],v=d[9],s=d[10],h=d[11],d!==u&&(u[4]=d[4],u[5]=d[5],u[6]=d[6],u[7]=d[7],u[12]=d[12],u[13]=d[13],u[14]=d[14],u[15]=d[15]),u[0]=i*l-p*c,u[1]=y*l-v*c,u[2]=o*l-s*c,u[3]=f*l-h*c,u[8]=i*c+p*l,u[9]=y*c+v*l,u[10]=o*c+s*l,u[11]=f*c+h*l,d=this.modelMatrix,i=this.modelMatrix,p=this.rotation[2],y=Math.sin(p),v=Math.cos(p),o=i[0],s=i[1],u=i[2],f=i[3],c=i[4],h=i[5],l=i[6],p=i[7],i!==d&&(d[8]=i[8],d[9]=i[9],d[10]=i[10],d[11]=i[11],d[12]=i[12],d[13]=i[13],d[14]=i[14],d[15]=i[15]),d[0]=o*v+c*y,d[1]=s*v+h*y,d[2]=u*v+l*y,d[3]=f*v+p*y,d[4]=c*v-o*y,d[5]=h*v-s*y,d[6]=l*v-u*y,d[7]=p*v-f*y,d=this.modelMatrix,p=this.modelMatrix,v=this.scale,f=v[0],y=v[1],v=v[2],d[0]=p[0]*f,d[1]=p[1]*f,d[2]=p[2]*f,d[3]=p[3]*f,d[4]=p[4]*y,d[5]=p[5]*y,d[6]=p[6]*y,d[7]=p[7]*y,d[8]=p[8]*v,d[9]=p[9]*v,d[10]=p[10]*v,d[11]=p[11]*v,d[12]=p[12],d[13]=p[13],d[14]=p[14],d[15]=p[15],this.shouldUpdate=!1,this}}const T=(t,e,r)=>(r-t)/(e-t),S=t=>(t-=2*Math.floor(.5*t),t=Math.min(Math.max(t,0),2),1-Math.abs(t-1));class k{constructor(t,e,r,n){this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=i(),this.viewMatrix=i(),this.zoom=1,this.fieldOfView=t,this.aspect=e,this.near=r,this.far=n,this.updateProjectionMatrix()}setPosition({x:t=this.position[0],y:e=this.position[1],z:r=this.position[2]}){return this.position=[t,e,r],this}updateViewMatrix(){var t,e,r,n,a,i,o,s,u,c,h,l,d,p;return t=this.viewMatrix,e=this.position,r=this.lookAtPosition,n=k.UP_VECTOR,i=e[0],o=e[1],s=e[2],u=n[0],c=n[1],h=n[2],l=r[0],d=r[1],p=r[2],Math.abs(i-l)<w&&Math.abs(o-d)<w&&Math.abs(s-p)<w?A(t):(a=i-l,e=o-d,n=s-p,l=c*(n*=r=1/Math.hypot(a,e,n))-h*(e*=r),d=h*(a*=r)-u*n,p=u*e-c*a,(r=Math.hypot(l,d,p))?(l*=r=1/r,d*=r,p*=r):p=d=l=0,h=e*p-n*d,u=n*l-a*p,c=a*d-e*l,(r=Math.hypot(h,u,c))?(h*=r=1/r,u*=r,c*=r):c=u=h=0,t[0]=l,t[1]=h,t[2]=a,t[3]=0,t[4]=d,t[5]=u,t[6]=e,t[7]=0,t[8]=p,t[9]=c,t[10]=n,t[11]=0,t[12]=-(l*i+d*o+p*s),t[13]=-(h*i+u*o+c*s),t[14]=-(a*i+e*o+n*s),t[15]=1),this}updateProjectionMatrix(){var t,e,r,n,a;return t=this.projectionMatrix,e=this.fieldOfView,r=this.aspect,n=this.near,a=this.far,e=1/Math.tan(e/2),t[0]=e/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=(a+n)*(e=1/(n-a)),t[14]=2*a*n*e):(t[10]=-1,t[14]=-2*n),this}lookAt(t){return this.lookAtPosition=t,this.updateViewMatrix(),this}}function M(r,n,a,i,o,t,s,u,c,h=0,l=1,d=2,p=1,v=-1,f=0,y=0){var m=f,w=o/u,A=t/c;for(let e=0;e<=c;e++){var g=e*A-t/2;for(let t=0;t<=u;t++,f++){var M,x,F,U=t*w-o/2;r[3*f+h]=U*p,r[3*f+l]=g*v,r[3*f+d]=s/2,n[3*f+h]=0,n[3*f+l]=0,n[3*f+d]=0<=s?1:-1,a[2*f]=t/u,a[2*f+1]=1-e/c,e!==c&&t!==u&&(M=m+t+e*(u+1),x=m+t+(e+1)*(u+1),F=m+t+(e+1)*(u+1)+1,U=m+t+e*(u+1)+1,i[6*y]=M,i[6*y+1]=x,i[6*y+2]=U,i[6*y+3]=x,i[6*y+4]=F,i[6*y+5]=U,y++)}}}function r(t={}){var{width:e=1,height:r=1,depth:n=1,widthSegments:a=1,heightSegments:i=1,depthSegments:o=1}=t,s=a,u=i,c=o,h=(s+1)*(u+1)*2+(s+1)*(c+1)*2+(u+1)*(c+1)*2,l=6*(s*u*2+s*c*2+u*c*2),t=new Float32Array(3*h),a=new Float32Array(3*h),i=new Float32Array(2*h),o=new(65536<h?Uint32Array:Uint16Array)(l),h=0,l=0;return M(t,a,i,o,n,r,e,c,u,2,1,0,-1,-1,0,0),M(t,a,i,o,n,r,-e,c,u,2,1,0,1,-1,h+=(c+1)*(u+1),l+=c*u),M(t,a,i,o,e,n,r,c,u,0,2,1,1,1,h+=(c+1)*(u+1),l+=c*u),M(t,a,i,o,e,n,-r,c,u,0,2,1,1,-1,h+=(s+1)*(c+1),l+=s*c),M(t,a,i,o,e,r,-n,s,u,0,1,2,-1,-1,h+=(s+1)*(c+1),l+=s*c),M(t,a,i,o,e,r,n,s,u,0,1,2,1,-1,h+=(s+1)*(u+1),l+=s*u),{vertices:t,normal:a,uv:i,indices:o}}function n(t={}){var{width:e=1,height:r=1,depth:n=1,widthSegments:a=1,heightSegments:i=1,depthSegments:o=1}=t,s=a,u=i,c=o;const h=[];var l=(c+1)*(u+1),t=c*u*6,a=new Float32Array(3*l),i=new Float32Array(3*l),o=new Float32Array(2*l),l=new(65536<l?Uint32Array:Uint16Array)(t);M(a,i,o,l,n,r,e,c,u,2,1,0,-1,-1,0,0),h.push({orientation:m,vertices:a,normal:i,uv:o,indices:l});t=(c+1)*(u+1),a=c*u*6,i=new Float32Array(3*t),o=new Float32Array(3*t),l=new Float32Array(2*t),t=new(65536<t?Uint32Array:Uint16Array)(a);M(i,o,l,t,n,r,-e,c,u,2,1,0,1,-1,0,0),h.push({orientation:y,vertices:i,normal:o,uv:l,indices:t});a=(c+1)*(u+1),i=c*u*6,o=new Float32Array(3*a),l=new Float32Array(3*a),t=new Float32Array(2*a),a=new(65536<a?Uint32Array:Uint16Array)(i);M(o,l,t,a,e,n,r,c,u,0,2,1,1,1,0,0),h.push({orientation:"top",vertices:o,normal:l,uv:t,indices:a});i=(c+1)*(u+1),o=c*u*6,l=new Float32Array(3*i),t=new Float32Array(3*i),a=new Float32Array(2*i),o=new(65536<i?Uint32Array:Uint16Array)(o);M(l,t,a,o,e,n,-r,c,u,0,2,1,1,-1,0,0),h.push({orientation:f,vertices:l,normal:t,uv:a,indices:o});l=(s+1)*(c+1),t=s*c*6,a=new Float32Array(3*l),o=new Float32Array(3*l),c=new Float32Array(2*l),l=new(65536<l?Uint32Array:Uint16Array)(t);M(a,o,c,l,e,r,-n,s,u,0,1,2,-1,-1,0,0),h.push({orientation:v,vertices:a,normal:o,uv:c,indices:l});t=(s+1)*(u+1),a=s*u*6,o=new Float32Array(3*t),c=new Float32Array(3*t),l=new Float32Array(2*t),a=new(65536<t?Uint32Array:Uint16Array)(a);return M(o,c,l,a,e,r,n,s,u,0,1,2,1,-1,0,0),h.push({orientation:d,vertices:o,normal:c,uv:l,indices:a}),h}k.UP_VECTOR=[0,1,0];class o{static xp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=r,e[1]=-t,e[2]=n,e}static xn(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=r,e[1]=t,e[2]=-n,e}static yp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=-t,e[1]=n,e[2]=r,e}static yn(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=t,e[1]=n,e[2]=-r,e}static zp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=n,e[1]=-r,e[2]=t,e}static zn(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=-n,e[1]=r,e[2]=t,e}static xp_yn(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=-n,e[1]=-t,e[2]=r,e}static xp_yp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=n,e[1]=-t,e[2]=-r,e}static xp_yp_yp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=-r,e[1]=-t,e[2]=-n,e}static xp_xp(t,e){var r=t[0],n=t[1],t=t[2];return e[0]=r,e[1]=-n,e[2]=-t,e}}var s=({width:t=1,height:e=1,depth:r=1,radius:n=.5,div:a=4})=>{n=function(t=2,e=2,r=2,i=.5,o=4){const s=t/2,n=e/2,u=r/2,c=2*o,h=[],l=[],d=[],p=I();let a,v,f,y,m,w,A,g;A=n;const M=[F(i-s,n-i,i-u),F(s-i,n-i,i-u),F(i-s,n-i,u-i),F(s-i,n-i,u-i)],x=(t,e)=>{var r,n,a=T(-u,u,t);for(f=0;f<=c;f++)n=f<=o?0:1,r=S(f/o),m=f<=o?-1:1,w=s*m+i*r*-m,L(p,w,A,t),E(p,p,M[n|e]),C(p,p),d.push(p[0],p[1],p[2]),P(p,p,i),U(p,p,M[n|e]),h.push(p[0],p[1],p[2]),l.push(T(-s,s,w),a),1==r&&(L(p,s-i,A,t),E(p,p,M[1|e]),C(p,p),d.push(p[0],p[1],p[2]),P(p,p,i),U(p,p,M[1|e]),h.push(p[0],p[1],p[2]),l.push(T(-s,s,s-i),a))};for(v=0;v<=c;v++)a=v<=o?0:2,y=S(v/o),m=v<=o?-1:1,g=u*m+i*y*-m,x(g,a),1==y&&x(u-i,2);return{verts:h,uv:l,norm:d,indices:function(t,e){let r=[],n=t+1,a,i,o,s,u,c;for(i=0;i<e;i++)for(a=0;a<t;a++)o=i*n+a,s=o+n,u=s+1,c=o+1,r.push(o,s,u,u,c,o);return r}(1+c,1+c)}}(t,e,r,n,a),a={verts:[],indices:[],uv:[],norm:[]};return u(a,n,(t,e)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e)),u(a,n,o.xp),u(a,n,o.xp_yp),u(a,n,o.xp_yp_yp),u(a,n,o.xp_yn),u(a,n,o.xp_xp),{vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}};function u(e,r,n){var t=e.verts.length/3,a=r.verts.length;const i=I(),o=I();for(let t=0;t<a;t+=3)L(i,r.verts[t],r.verts[t+1],r.verts[t+2]),n(i,o),e.verts.push(o[0],o[1],o[2]),L(i,r.norm[t],r.norm[t+1],r.norm[t+2]),n(i,o),e.norm.push(o[0],o[1],o[2]);for(const i of r.uv)e.uv.push(i);for(const i of r.indices)e.indices.push(t+i)}var c=({width:t=1,height:e=1,depth:r=1,radius:n=.5,div:a=4})=>{n=function(t=2,e=2,r=2,i=.5,o=4){const s=t/2,n=e/2,u=r/2,c=2*o,h=[],l=[],d=[],p=I();let a,v,f,y,m,w,A,g;A=n;const M=[F(i-s,n-i,i-u),F(s-i,n-i,i-u),F(i-s,n-i,u-i),F(s-i,n-i,u-i)],x=(t,e)=>{var r,n,a=T(-u,u,t);for(f=0;f<=c;f++)n=f<=o?0:1,r=S(f/o),m=f<=o?-1:1,w=s*m+i*r*-m,L(p,w,A,t),E(p,p,M[n|e]),C(p,p),d.push(p[0],p[1],p[2]),P(p,p,i),U(p,p,M[n|e]),h.push(p[0],p[1],p[2]),l.push(T(-s,s,w),a),1==r&&(L(p,s-i,A,t),E(p,p,M[1|e]),C(p,p),d.push(p[0],p[1],p[2]),P(p,p,i),U(p,p,M[1|e]),h.push(p[0],p[1],p[2]),l.push(T(-s,s,s-i),a))};for(v=0;v<=c;v++)a=v<=o?0:2,y=S(v/o),m=v<=o?-1:1,g=u*m+i*y*-m,x(g,a),1==y&&x(u-i,2);return{verts:h,uv:l,norm:d,indices:function(t,e){let r=[],n=t+1,a,i,o,s,u,c;for(i=0;i<e;i++)for(a=0;a<t;a++)o=i*n+a,s=o+n,u=s+1,c=o+1,r.push(o,s,u,u,c,o);return r}(1+c,1+c)}}(t,e,r,n,a);const i=[];a={verts:[],indices:[],uv:[],norm:[]};return h(a,n,(t,e)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e)),i.push({orientation:"top",vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),h(a={verts:[],indices:[],uv:[],norm:[]},n,o.xp),i.push({orientation:d,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),h(a={verts:[],indices:[],uv:[],norm:[]},n,o.xp_yp),i.push({orientation:y,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),h(a={verts:[],indices:[],uv:[],norm:[]},n,o.xp_yp_yp),i.push({orientation:v,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),h(a={verts:[],indices:[],uv:[],norm:[]},n,o.xp_yn),i.push({orientation:m,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),h(a={verts:[],indices:[],uv:[],norm:[]},n,o.xp_xp),i.push({orientation:f,vertices:new Float32Array(a.verts),normal:new Float32Array(a.norm),uv:new Float32Array(a.uv),indices:new Uint16Array(a.indices)}),i};function h(e,r,n){var t=e.verts.length/3,a=r.verts.length;const i=I(),o=I();for(let t=0;t<a;t+=3)L(i,r.verts[t],r.verts[t+1],r.verts[t+2]),n(i,o),e.verts.push(o[0],o[1],o[2]),L(i,r.norm[t],r.norm[t+1],r.norm[t+2]),n(i,o),e.norm.push(o[0],o[1],o[2]);for(const i of r.uv)e.uv.push(i);for(const i of r.indices)e.indices.push(t+i)}function l(t={}){var{radius:r=1,segments:n=8,thetaStart:a=0,thetaLength:i=2*Math.PI}=t;const e=[],o=[],s=[],u=[],c=I(),h=g();o.push(0,0,0),s.push(0,0,1),u.push(.5,.5);for(let t=0,e=3;t<=n;t++,e+=3){var l=a+t/n*i;c[0]=r*Math.cos(l),c[1]=r*Math.sin(l),o.push(...c),s.push(0,0,1),h[0]=(o[e]/r+1)/2,h[1]=(o[e+1]/r+1)/2,u.push(h[0],h[1])}for(let t=1;t<=n;t++)e.push(t,t+1,0);return{indices:new(65536<n?Uint32Array:Uint16Array)(e),vertices:new Float32Array(o),normal:new Float32Array(s),uv:new Float32Array(u)}}function x(t={}){var{width:e=1,height:r=1,widthSegments:n=1,heightSegments:a=1}=t,i=n,o=a,s=(i+1)*(o+1),u=i*o*6,t=new Float32Array(3*s),n=new Float32Array(3*s),a=new Float32Array(2*s),u=new(65536<s?Uint32Array:Uint16Array)(u);return M(t,n,a,u,e,r,0,i,o),{vertices:t,normal:n,uv:a,indices:u}}function _(t={}){var{radius:e=.5,widthSegments:r=16,heightSegments:n=Math.ceil(.5*r),phiStart:a=0,phiLength:i=2*Math.PI,thetaStart:o=0,thetaLength:t=Math.PI}=t,s=r,u=n,c=a,h=i,l=o,d=t,o=(s+1)*(u+1),t=s*u*6;const p=new Float32Array(3*o),v=new Float32Array(3*o),f=new Float32Array(2*o),y=new(65536<o?Uint32Array:Uint16Array)(t);let m=0,w=0,A=0;var g=l+d;const M=[];var x=I();for(let t=0;t<=u;t++){const R=[];var F=t/u;for(let t=0;t<=s;t++,m++){var U=t/s,P=-e*Math.cos(c+U*h)*Math.sin(l+F*d),E=e*Math.cos(l+F*d),T=e*Math.sin(c+U*h)*Math.sin(l+F*d);L(x,p[3*m]=P,p[3*m+1]=E,p[3*m+2]=T),C(x,x),v[3*m]=x[0],v[3*m+1]=x[1],v[3*m+2]=x[2],f[2*m]=U,f[2*m+1]=1-F,R.push(w++)}M.push(R)}for(let e=0;e<u;e++)for(let t=0;t<s;t++){var S=M[e][t+1],_=M[e][t],B=M[e+1][t],b=M[e+1][t+1];(0!==e||0<l)&&(y[3*A]=S,y[3*A+1]=_,y[3*A+2]=b,A++),(e!==u-1||g<Math.PI)&&(y[3*A]=_,y[3*A+1]=B,y[3*A+2]=b,A++)}return{vertices:p,normal:v,uv:f,indices:y}}function B(t={}){var{radius:r=.5,tube:n=.35,arc:a=2*Math.PI,radialSegments:e=8,tubularSegments:t=6}=t,i=Math.floor(e),o=Math.floor(t);const s=[],u=[],c=[],h=[],l=I(),d=I();var p=I();for(let e=0;e<=i;e++)for(let t=0;t<=o;t++){var v=t/o*a,f=e/i*Math.PI*2;d[0]=(r+n*Math.cos(f))*Math.cos(v),d[1]=(r+n*Math.cos(f))*Math.sin(v),d[2]=n*Math.sin(f),u.push(d[0],d[1],d[2]),l[0]=r*Math.cos(v),l[1]=r*Math.sin(v),E(p,d,l),C(p,p),c.push(p[0],p[1],p[0]),h.push(t/o,e/i)}for(let e=1;e<=i;e++)for(let t=1;t<=o;t++){var y=(o+1)*e+t-1,m=(o+1)*(e-1)+t-1,w=(o+1)*(e-1)+t,A=(o+1)*e+t;s.push(y,m,A),s.push(m,w,A)}return{indices:new(65536<(i+1)*(o+1)?Uint32Array:Uint16Array)(s),vertices:new Float32Array(u),normal:new Float32Array(c),uv:new Float32Array(h)}}var W=Object.freeze({__proto__:null,createBox:r,createBoxSeparateFace:n,createRoundedBoxSeparateFace:c,createRoundedBox:s,createCircle:l,createPlane:x,createSphere:_,createTorus:B,GeometryUtils:{createBox:r,createBoxSeparateFace:n,createRoundedBoxSeparateFace:c,createRoundedBox:s,createCircle:l,createPlane:x,createSphere:_,createTorus:B}});const X=j(0,1,0);t(void 0,void 0,void 0,function*(){var t=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter();const e=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",t=>{document.body.innerHTML+=e}),window.addEventListener("error",t=>{document.body.innerHTML+=e}),t||(document.body.innerHTML+=e)}),t(void 0,void 0,void 0,function*(){const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const e=yield null===(c=navigator.gpu)||void 0===c?void 0:c.requestAdapter(),A=yield null===e||void 0===e?void 0:e.requestDevice(),g=t.getContext("webgpu");var r=g.getPreferredFormat(e);g.configure({device:A,format:r});const{vertices:n,normal:a,indices:M}=W.createSphere({widthSegments:32,heightSegments:32}),x=A.createBuffer({size:n.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(x.getMappedRange()).set(n),x.unmap();const F=A.createBuffer({size:a.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(F.getMappedRange()).set(a),F.unmap();const U=A.createBuffer({size:M.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new(M instanceof Uint16Array?Uint16Array:Uint32Array)(U.getMappedRange()).set(M),U.unmap();const P=A.createRenderPipeline({vertex:{module:A.createShaderModule({code:"\n[[block]]\nstruct Uniforms {\n  projectionMatrix: mat4x4<f32>;\n  viewMatrix: mat4x4<f32>;\n  modelMatrix: mat4x4<f32>;\n};\n[[group(0), binding(0)]]\nvar<uniform> uniforms: Uniforms;\n\n[[block]]\nstruct InstancedTransform {\n  instanceModelMatrix: [[stride(64)]] array<mat4x4<f32>, 16>;\n};\n[[group(0), binding(1)]]\nvar<uniform> instancedTransform: InstancedTransform;\n\nstruct Input {\n  [[builtin(instance_index)]] instanceIdx : u32;\n  [[location(0)]] position: vec4<f32>;\n  [[location(1)]] normal: vec3<f32>;\n};\n\nstruct Output {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] normal: vec3<f32>;\n};\n\n[[stage(vertex)]]\nfn main (input: Input) -> Output {\n  var output: Output;\n\n  let instancePos: vec4<f32> = uniforms.modelMatrix *\n                    instancedTransform.instanceModelMatrix[input.instanceIdx] *\n                    input.position;\n  \n  \n  output.Position = uniforms.projectionMatrix *\n                    uniforms.viewMatrix *\n                    uniforms.modelMatrix *\n                    instancedTransform.instanceModelMatrix[input.instanceIdx] *\n                    input.position;\n                    \n  output.normal = input.normal;\n\n  return output;\n}\n"}),entryPoint:"main",buffers:[{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:A.createShaderModule({code:"\n[[group(0), binding(2)]] var mySampler: sampler;\n[[group(0), binding(3)]] var myTexture: texture_2d<f32>;\n\nstruct Input {\n  [[location(0)]] normal: vec3<f32>;\n};\n\n[[stage(fragment)]]\n\nfn main (input: Input) -> [[location(0)]] vec4<f32> {\n  return textureSample(myTexture, mySampler, normalize(input.normal).xy * 0.5 + 0.5);\n}\n"}),entryPoint:"main",targets:[{format:r}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0},multisample:{count:4},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),i=new Image;i.src=`${window.ASSETS_BASE_URL}/eye-texture.jpeg`,yield i.decode();var o=yield createImageBitmap(i);const s=A.createTexture({size:[o.width,o.height,1],format:r,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});A.queue.copyExternalImageToTexture({source:o},{texture:s},[o.width,o.height]);var u=A.createSampler({magFilter:"linear",minFilter:"linear"});const E=A.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),T=A.createBuffer({size:256*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});var c=A.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const S=new Float32Array(256),_=new Float32Array(48),B=(o=new p(16),p!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o);A.queue.writeBuffer(c,0,_);const b=A.createBindGroup({layout:P.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:E}},{binding:1,resource:{buffer:T}},{binding:2,resource:u},{binding:3,resource:s.createView()}]});c=45*Math.PI/180,u=t.width/t.height;const h=2*Math.tan(c/2)*7,l=h*(innerWidth/innerHeight),R=new k(c,u,.1,100);R.setPosition({x:0,y:0,z:7}),R.lookAt([0,0,0]),R.updateProjectionMatrix(),R.updateViewMatrix();const I=new H,L=A.createTexture({size:[t.width,t.height,1],format:"depth24plus",sampleCount:4,usage:GPUTextureUsage.RENDER_ATTACHMENT}),d=A.createTexture({size:[t.width,t.height],sampleCount:4,format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT});let C=d.createView();const G=new Float32Array([0,0]),O=new Float32Array([0,0]);let N=0,z=N,V=0;requestAnimationFrame(function t(e){requestAnimationFrame(t);e/=1e3;const r=e-V;V=e;const n=5*r;z+=-z*n;N+=(z-N)*n;const a=A.createCommandEncoder();const i=a.beginRenderPass({colorAttachments:[{view:C,resolveTarget:g.getCurrentTexture().createView(),loadValue:[.1,.1,.1,1],storeOp:"store"}],depthStencilAttachment:{view:L.createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}});A.queue.writeBuffer(E,0,R.projectionMatrix);A.queue.writeBuffer(E,16*Float32Array.BYTES_PER_ELEMENT,R.viewMatrix);A.queue.writeBuffer(E,32*Float32Array.BYTES_PER_ELEMENT,I.modelMatrix);const o=r;G[0]+=(O[0]-G[0])*o;G[1]+=(O[1]-G[1])*o;let s=0;const u=5/4;const c=5/4;for(let e=0;e<4;e++)for(let t=0;t<4;t++){const h=2*Math.cos(s),l=2*Math.sin(s),d=Math.sin(2*s)*s,p=1.25*e-2.5+.5+h*N,v=1.25*t-2.5+.5+l*N,f=p+(h-p)*N,y=v+(l-v)*N,m=d*N,w=j(f,y,m);q(B),Y(B,B,w),D(B,w,j(G[0],G[1],1),X),S.set(B,16*s),_.set(w,3*s),s++}A.queue.writeBuffer(T,0,S);i.setPipeline(P);i.setVertexBuffer(0,x);i.setVertexBuffer(1,F);i.setIndexBuffer(U,M instanceof Uint16Array?"uint16":"uint32");i.setBindGroup(0,b);i.drawIndexed(M.length,16);i.endPass();A.queue.submit([a.finish()])}),document.body.addEventListener("mousemove",function(t){var e=(t.pageX/innerWidth*2-1)*l*.5,t=(2*(1-t.pageY/innerHeight)-1)*h*.5;O[0]=e,O[1]=t}),t.addEventListener("click",function(){z++})})}();
