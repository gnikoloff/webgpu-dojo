!function(){"use strict";function e(e,o,a,u){return new(a=a||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function s(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,s)}i((u=u.apply(e,o||[])).next())})}function d(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const r=t.global||t.self||t.window||{},n="object"!=typeof process||"[object process]"!==String(process)||process.browser;var s="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);s&&parseFloat(s[1]);const o="3.0.11";function c(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const i=t.global||t.self||t.window||{},a="object"!=typeof process||"[object process]"!==String(process)||process.browser,u="function"==typeof importScripts,l="undefined"!=typeof window&&void 0!==window.orientation;s="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}s&&parseFloat(s[1]);class f{constructor(e,t){h(this,"name",void 0),h(this,"workerThread",void 0),h(this,"isRunning",void 0),h(this,"result",void 0),h(this,"_resolve",void 0),h(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){c(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){c(this.isRunning),this.isRunning=!1,this._reject(e)}}const m=new Map;function p(e){c(e.source&&!e.url||!e.source&&e.url);let t=m.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;e=`\
try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`;return g(e)}(e.url),m.set(e.url,t)),e.source&&(t=g(e.source),m.set(e.source,t))),c(t),t}function g(e){e=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(e)}function y(e){return e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const b=()=>{};class v{static isSupported(){return"undefined"!=typeof Worker}constructor(e){h(this,"name",void 0),h(this,"source",void 0),h(this,"url",void 0),h(this,"terminated",!1),h(this,"worker",void 0),h(this,"onMessage",void 0),h(this,"onError",void 0),h(this,"_loadableURL","");var{name:t,source:r,url:e}=e;c(r||e),this.name=t,this.source=r,this.url=e,this.onMessage=b,this.onError=e=>{},this.worker=this._createBrowserWorker()}destroy(){this.onMessage=b,this.onError=b,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||function e(t,r=!0,n){const s=n||new Set;if(t)if(y(t))s.add(t);else if(y(t.buffer))s.add(t.buffer);else if(!ArrayBuffer.isView(t)&&r&&"object"==typeof t)for(const i in t)e(t[i],r,s);return void 0===n?Array.from(s):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=p({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}}class w{constructor(e){h(this,"name","unnamed"),h(this,"source",void 0),h(this,"url",void 0),h(this,"maxConcurrency",1),h(this,"maxMobileConcurrency",1),h(this,"onDebug",()=>{}),h(this,"reuseWorkers",!0),h(this,"props",{}),h(this,"jobQueue",[]),h(this,"idleQueue",[]),h(this,"count",0),h(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(t,r=(e,t,r)=>e.done(r),n=(e,t)=>e.error(t)){var e=new Promise(e=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:e}),this));return this._startQueuedJob(),e}async _startQueuedJob(){if(this.jobQueue.length){const e=this._getAvailableWorker();if(e){const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new f(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(0<this.idleQueue.length)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new v({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return l?this.maxMobileConcurrency:this.maxConcurrency}}const _={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class x{static isSupported(){return v.isSupported()}static getWorkerFarm(e={}){return x._workerFarm=x._workerFarm||new x({}),x._workerFarm.setProps(e),x._workerFarm}constructor(e){h(this,"props",void 0),h(this,"workerPools",new Map),this.props={..._},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){var{name:t,source:r,url:e}=e;let n=this.workerPools.get(t);return n||(n=new w({name:t,source:r,url:e}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}h(x,"_workerFarm",void 0);const T="latest";const E="3.0.11",A={};async function M(e,t=null,r={}){return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;var n=r.modules||{};if(n[e])return n[e];if(!a)return`modules/${t}/dist/libs/${e}`;if(r.CDN)return c(r.CDN.startsWith("http")),`${r.CDN}/${t}@${E}/dist/libs/${e}`;if(u)return`../src/libs/${e}`;return`modules/${t}/src/libs/${e}`}(e,t,r)),A[e]=A[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return t.arrayBuffer()}if(!a)return;if(u)return importScripts(e);const t=await fetch(e),r=await t.text();return function(t,e){if(!a)return;if(u)return eval.call(i,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}(r,e)}(e),A[e]}async function I(e,t,r,n,s){var i=e.id,e=function(t,r={}){var e=r[t.id]||{},n=`${t.id}-worker.js`;let s=e.workerUrl;if("test"===r._workerType&&(s=`modules/${t.module}/dist/${n}`),!s){let e=t.version;"latest"===e&&(e=T);r=e?`@${e}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${r}/dist/${n}`}return c(s),s}(e,r);const o=x.getWorkerFarm(r),a=o.getWorkerPool({name:i,url:e});r=JSON.parse(JSON.stringify(r));const u=await a.startJob("process-on-worker",async function(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(n.error);break;case"process":var{id:s,input:i,options:o}=n;try{var a=await e(i,o);t.postMessage("done",{id:s,result:a})}catch(e){a=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:s,error:a})}}}.bind(null,s));return u.postMessage("process",{input:t,options:r}),(await u.result).result}function j(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(n.getUint8(t+e));return s}function L(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${r=t,t=5,"string"==typeof r?r.slice(0,t):ArrayBuffer.isView(r)?j(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?j(r,0,t):""}"`)}var r}function S(e){if(void 0,e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function D(e,t,r){t=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(t).buffer}function U(e,t){return d(0<=e),d(0<t),e+(t-1)&~(t-1)}async function O(e){const t=[];for await(const r of e)t.push(r);return function(...e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e);e=t.reduce((e,t)=>e+t.byteLength,0);const r=new Uint8Array(e);let n=0;for(const s of t)r.set(s,n),n+=s.byteLength;return r.buffer}(...t)}let R="";const B={};const k=e=>"function"==typeof e,F=e=>null!==e&&"object"==typeof e,C=e=>F(e)&&e.constructor==={}.constructor,P=e=>e&&"function"==typeof e[Symbol.iterator],N=e=>e&&"function"==typeof e[Symbol.asyncIterator],V=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,H=e=>"undefined"!=typeof Blob&&e instanceof Blob,$=e=>e&&"object"==typeof e&&e.isBuffer,z=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||F(e)&&k(e.tee)&&k(e.cancel)&&k(e.getReader))(e)||(e=>F(e)&&k(e.read)&&k(e.pipe)&&"boolean"==typeof e.readable)(e),W=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,G=/^([-\w.]+\/[-\w.+]+)/;function q(e){e=W.exec(e);return e?e[1]:""}const X=/\?.*/;function Y(e){if(V(e)){var t=Q(e.url||""),r=e.headers.get("content-type")||"";return{url:t,type:(n=r,((r=G.exec(n))?r[1]:n)||q(t))}}var n;return H(e)?{url:Q(e.name||""),type:e.type||""}:"string"==typeof e?{url:Q(e),type:q(e)}:{url:"",type:""}}function Q(e){return e.replace(X,"")}async function K(e){if(V(e))return e;const t={};var r=(n=e,V(n)?n.headers["content-length"]||-1:H(n)?n.size:"string"==typeof n?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1);0<=r&&(t["content-length"]=String(r));var{url:n,type:r}=Y(e);r&&(t["content-type"]=r);r=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return new Promise(r=>{const e=new FileReader;e.onload=e=>{var t;return r(null==e||null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(t)})}if(e instanceof ArrayBuffer)return`data:base64,${function(e){let t="";var r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5))}`;return null}(e);r&&(t["x-first-bytes"]=r),"string"==typeof e&&(e=(new TextEncoder).encode(e));e=new Response(e,{headers:t});return Object.defineProperty(e,"url",{value:n}),e}async function J(e){if(!e.ok){e=await async function(t){let r=`Failed to fetch resource ${t.url} (${t.status}): `;try{const n=t.headers.get("Content-Type");let e=t.statusText;n.includes("application/json")&&(e+=` ${await t.text()}`),r+=e,r=60<r.length?`${r.slice(60)}...`:r}catch(e){}return r}(e);throw new Error(e)}}async function Z(t,r){if("string"!=typeof t)return K(t);{t=function(e){for(const r in B){var t;e.startsWith(r)&&(t=B[r],e=e.replace(r,t))}return e=!e.startsWith("http://")&&!e.startsWith("https://")?`${R}${e}`:e}(t);let e=r;return null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(e=r.fetch),fetch(t,e)}}t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process};const ee=t.window||t.self||t.global,te=t.process||{},re="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",ne=!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;var t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;const r=e||t;return!!(r&&0<=r.indexOf("Electron"))}();class se{constructor(e,t,r="sessionStorage"){this.storage=function(e){try{const r=window[e];var t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch(e){return null}}(r),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){return Object.assign(this.config,e),this.storage&&(e=JSON.stringify(this.config),this.storage.setItem(this.id,e)),this}_loadConfiguration(){let e={};var t;return this.storage&&(t=this.storage.getItem(this.id),e=t?JSON.parse(t):{}),Object.assign(this.config,e),this}}const ie={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function oe(e){return"string"==typeof e?ie[e.toUpperCase()]||ie.WHITE:e}function ae(e,t){if(!e)throw new Error(t||"Assertion failed")}function ue(){let e;var t;return e=ne&&ee.performance?ee.performance.now():te.hrtime?1e3*(t=te.hrtime())[0]+t[1]/1e6:Date.now(),e}const ce={debug:ne&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},de={enabled:!0,level:0};function le(){}const he={},fe={once:!0};class me{constructor({id:e}={id:""}){this.id=e,this.VERSION=re,this._startTs=ue(),this._deltaTs=ue(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new se("__probe-".concat(this.id,"__"),de),this.userData={},this.timeStamp("".concat(this.id," started")),function(e,t=["constructor"]){var r=Object.getPrototypeOf(e);for(const n of Object.getOwnPropertyNames(r))"function"==typeof e[n]&&(t.find(e=>n===e)||(e[n]=e[n].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ue()-this._startTs).toPrecision(10))}getDelta(){return Number((ue()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){ae(e,t)}warn(e){return this._getLogFunction(0,e,ce.warn,arguments,fe)}error(e){return this._getLogFunction(0,e,ce.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,ce.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ce.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ce.debug||ce.info,arguments,fe)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||le,r&&[r],{tag:function(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}(t)}):le}image({logLevel:e,priority:t,image:r,message:n="",scale:s=1}){return this._shouldLog(e||t)?(ne?function({image:e,message:i="",scale:o=1}){if("string"==typeof e){const a=new Image;return a.onload=()=>{var e,t,r,n,s;e=a,t=i,r=o,n=600,s=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29"),e.width>n&&(r=Math.min(r,n/e.width)),n=e.width*r,r=e.height*r,["font-size:1px;","padding:".concat(Math.floor(r/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(r,"px;"),"background:url(".concat(s,");"),"background-size:".concat(n,"px ").concat(r,"px;"),"color:transparent;"].join(""),"".concat(t," %c+")},a.src=e,le}const t=e.nodeName||"";if("img"===t.toLowerCase())return le;if("canvas"!==t.toLowerCase())return le;{const r=new Image;return r.onload=()=>{},r.src=e.toDataURL(),le}}:function({image:e,scale:t=1}){let r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return()=>r(e,{fit:"box",width:"".concat(Math.round(80*t),"%")}).then(e=>{});return le})({image:r,message:n,scale:s}):le}settings(){}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time||console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd||console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||le)}group(e,t,r={collapsed:!1}){var{collapsed:t}=r=ge({logLevel:e,message:t,opts:r});return r.method=(t?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||le)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=pe(e)}_getLogFunction(e,t,r,n=[],s){if(this._shouldLog(e)){s=ge({logLevel:e,message:t,args:n,opts:s}),ae(r=r||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=ue();n=s.tag||s.message;if(s.once){if(he[n])return le;he[n]=ue()}return t=function(e,t,r){{var n;"string"==typeof t&&(n=r.time?function(e,t=8){return t=Math.max(t-e.length,0),"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"",t=function(e,t,r){return ne||"string"!=typeof e||(t&&(t=oe(t),e="[".concat(t,"m").concat(e,"[39m")),r&&(t=oe(r),e="[".concat(r+10,"m").concat(e,"[49m"))),e}(t=(r.time?"".concat(e,": ").concat(n,"  "):"".concat(e,": ")).concat(t),r.color,r.background))}return t}(this.id,s.message,s),r.bind(console,t,...s.args)}return le}}function pe(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return ae(Number.isFinite(t)&&0<=t),t}function ge(e){var{logLevel:t,message:r}=e;e.logLevel=pe(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(e.args=n,typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var s=typeof e.message;return ae("string"==s||"object"==s),Object.assign(e,e.opts)}me.VERSION=re;const ye=new me({id:"loaders.gl"});class be{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const ve={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){h(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},we={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function _e(){r.loaders=r.loaders||{};const{loaders:e}=r;return e._state=e._state||{},e._state}const xe=()=>{const e=_e();return e.globalOptions=e.globalOptions||{...ve},e.globalOptions};function Te(e,t,r,n){return r=r||[],function(e,t){Ae(e,null,ve,we,t);for(const i of t){var r=e&&e[i.id]||{},n=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Ae(r,i.id,n,s,t)}}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n=e.options||{},s={...n};(function(e,t){!t||"baseUri"in e||(e.baseUri=t)})(s,r),null===s.log&&(s.log=new be);return Me(s,xe()),Me(s,t),s}(t,e,n)}function Ee(e,t){var r=xe();const n=e||r;return"function"==typeof n.fetch?n.fetch:F(n.fetch)?e=>Z(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:Z}function Ae(e,t,r,n,s){var i=t||"Top level",o=t?`${t}.`:"";for(const d in e){var a=!t&&F(e[d]),u="baseUri"===d&&!t,c="workerUrl"===d&&t;d in r||u||c||(d in n?ye.warn(`${i} loader option \'${o}${d}\' no longer supported, use \'${n[d]}\'`)():a||(a=function(e,t){const r=e.toLowerCase();let n="";for(const s of t)for(const i in s.options){if(e===i)return`Did you mean \'${s.id}.${i}\'?`;const o=i.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(n=n||`Did you mean \'${s.id}.${i}\'?`)}return n}(d,s),ye.warn(`${i} loader option \'${o}${d}\' not recognized. ${a}`)()))}}function Me(e,t){for(const n in t){var r;n in t&&(r=t[n],C(r)&&C(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n])}}function Ie(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===e||void 0===e?void 0:e.extensions))}function je(e){var t;return d(e,"null loader"),d(Ie(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(null!==e&&void 0!==e&&e.parseTextSync||null!==e&&void 0!==e&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Le=()=>{const e=_e();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const Se=/\.([^.]+)$/;function De(e,t=[],r,n){if(!Ue(e))return null;if(t&&!Array.isArray(t))return je(t);let s=[];t&&(s=s.concat(t)),null!=r&&r.ignoreRegisteredLoaders||s.push(...Le()),function(e){for(const t of e)je(t)}(s);n=function(e,t,r,n){var{url:s,type:i}=Y(e),n=s||(null==n?void 0:n.url);let o=null;null!=r&&r.mimeType&&(o=Re(t,null==r?void 0:r.mimeType));return o=o||function(e,t){t=t&&Se.exec(t),t=t&&t[1];return t?function(e,t){t=t.toLowerCase();for(const r of e)for(const n of r.extensions)if(n.toLowerCase()===t)return r;return null}(e,t):null}(t,n),o=o||Re(t,i),o=o||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(function(t,e){if(e.testText)return e.testText(t);const r=Array.isArray(e.tests)?e.tests:[e.tests];return r.some(e=>t.startsWith(e))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(Be(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer)if(Be(t,0,r))return r;return null}(t,e),o=o||Re(t,null==r?void 0:r.fallbackMimeType),o}(e,s,r,n);if(!(n||null!=r&&r.nothrow))throw new Error(Oe(e));return n}function Ue(e){return!(e instanceof Response&&204===e.status)}function Oe(e){var{url:t,type:r}=Y(e);let n="No valid loader found";return e&&(n+=` data: "${function(e,t=5){{if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return ke(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return ke(e,0,t)}return""}(e)}", contentType: "${r}"`),t&&(n+=` url: ${t}`),n}function Re(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t===`application/x.${r.id}`)return r}return null}function Be(t,r,n){const e=Array.isArray(n.tests)?n.tests:[n.tests];return e.some(e=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;var n=new Uint8Array(e),s=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==s[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":var s=ke(e,t,n.length);return n===s;default:return!1}}(t,r,n,e))}function ke(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(n.getUint8(t+e));return s}const Fe=262144;const Ce=262144;const Pe=1048576;function Ne(e,t){return n?async function*(e,t){const r=e.getReader();let n;try{for(;;){var s=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());var{done:i,value:o}=await s;if(i)return;yield S(o)}}catch(e){r.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield S(t)}(e)}function Ve(e,t){if("string"==typeof e)return function*(e,t){var r=(null==t?void 0:t.chunkSize)||Fe;let n=0;const s=new TextEncoder;for(;n<e.length;){var i=Math.min(e.length-n,r),o=e.slice(n,n+i);n+=i,yield s.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){var{chunkSize:r=Ce}=t;let n=0;for(;n<e.byteLength;){var s=Math.min(e.byteLength-n,r),i=new ArrayBuffer(s),o=new Uint8Array(e,n,s);const a=new Uint8Array(i);a.set(o),n+=s,yield i}}(e,t);if(H(e))return async function*(e,t){var r=(null==t?void 0:t.chunkSize)||Pe;let n=0;for(;n<e.size;){var s=n+r,i=await e.slice(n,s).arrayBuffer();n=s,yield i}}(e,t);if(z(e))return Ne(e,t);if(V(e))return Ne(e.body,t);throw new Error("makeIterator")}const He="Cannot convert supplied data type";async function $e(e,t,r){var n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(t,r){if(r.text&&"string"==typeof t)return t;if((t=$(t)?t.buffer:t)instanceof ArrayBuffer){var e=t;if(!r.text||r.binary)return e;{const n=new TextDecoder("utf8");return n.decode(e)}}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){const s=new TextDecoder("utf8");return s.decode(t)}let e=t.buffer;r=t.byteLength||t.length;return 0===t.byteOffset&&r===e.byteLength||(e=e.slice(t.byteOffset,t.byteOffset+r)),e}throw new Error(He)}(e,t);if(H(e)&&(e=await K(e)),V(e)){const s=e;return await J(s),t.binary?await s.arrayBuffer():await s.text()}if(z(e)&&(e=Ve(e,r)),P(e)||N(e))return O(e);throw new Error(He)}async function ze(e,t,r,n){c(!n||"object"==typeof n),!t||Array.isArray(t)||Ie(t)||(r=t,t=n=void 0),r=r||{};var{url:s}=Y(e=await e),i=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;return e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders&&(t=Array.isArray(t.loaders)?t.loaders:[t.loaders],r=r?[...r,...t]:t),r&&r.length?r:null}(t,n),t=await async function(e,t=[],r,n){if(!Ue(e))return null;let s=De(e,t,{...r,nothrow:!0},n);if(s)return s;if(H(e)&&(e=await e.slice(0,10).arrayBuffer(),s=De(e,t,r,n)),!(s||null!=r&&r.nothrow))throw new Error(Oe(e));return s}(e,i,r);return t?async function(e,t,r,n){if(function(e,t=o){c(e,"no worker provided"),e=e.version}(e),t=await $e(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return x.isSupported()&&(e.worker&&null!=t&&t.worker)}(e,r))return I(e,t,r,0,ze);if(e.parseText&&"string"==typeof t)return e.parseText(t,r,n,e);if(e.parse)return e.parse(t,r,n,e);throw c(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(t,e,r=Te(r,t,i,s),n=function(e,t,r=null){if(r)return r;const n={fetch:Ee(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:s,parse:ze,loaders:i},r,n)):null}function We(e,t){if(!e)throw new Error(t)}s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const Ge=s.global||s.self||s.window;t="object"!=typeof process||"[object process]"!==String(process)||process.browser,s="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);s&&parseFloat(s[1]);var{_parseImageNode:s}=Ge;const qe="undefined"!=typeof Image,Xe="undefined"!=typeof ImageBitmap;s=Boolean(s);const Ye=!!t||s;function Qe(e){e=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!e)throw new Error("Not an image");return e}const Ke=/^data:image\/svg\+xml/,Je=/\.svg((\?|#).*)?$/;function Ze(e){return e&&(Ke.test(e)||Je.test(e))}function et(e,t){if(Ze(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function tt(e,t,r){e=function(t,e){if(Ze(e)){const r=new TextDecoder;let e=r.decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return et(t,e)}(e,r);const n=self.URL||self.webkitURL;r="string"!=typeof e&&n.createObjectURL(e);try{return await async function(r,e){const n=new Image;if(n.src=r,e.image&&e.image.decode&&n.decode)return await n.decode(),n;return new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>t(new Error(`Could not load image ${r}: ${e}`))}catch(e){t(e)}})}(r||e,t)}finally{r&&n.revokeObjectURL(r)}}const rt={};let nt=!0;async function st(e,t,r){let n;n=Ze(r)?await tt(e,t,r):et(e,r);t=t&&t.imagebitmap;return async function(e,t=null){!function(e){for(const t in e||rt)return!1;return!0}(t)&&nt||(t=null);if(t)try{return createImageBitmap(e,t)}catch(e){nt=!1}return createImageBitmap(e)}(n,t)}const it=!1,ot=!0;function at(e){e=ut(e);return function(e){const t=ut(e),r=24<=t.byteLength&&2303741511===t.getUint32(0,it);return r?{mimeType:"image/png",width:t.getUint32(16,it),height:t.getUint32(20,it)}:null}(e)||function(e){const t=ut(e),r=3<=t.byteLength&&65496===t.getUint16(0,it)&&255===t.getUint8(2);if(!r)return null;const{tableMarkers:n,sofMarkers:s}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let i=2;for(;i+9<t.byteLength;){var o=t.getUint16(i,it);if(s.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,it),width:t.getUint16(i+7,it)};if(!n.has(o))return null;i+=2,i+=t.getUint16(i,it)}return null}(e)||function(e){const t=ut(e),r=10<=t.byteLength&&1195984440===t.getUint32(0,it);return r?{mimeType:"image/gif",width:t.getUint16(6,ot),height:t.getUint16(8,ot)}:null}(e)||function(e){const t=ut(e),r=14<=t.byteLength&&16973===t.getUint16(0,it)&&t.getUint32(2,ot)===t.byteLength;return r?{mimeType:"image/bmp",width:t.getUint32(18,ot),height:t.getUint32(22,ot)}:null}(e)}function ut(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const ct={id:"image",module:"images",name:"Images",version:"3.0.11",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){var n=((t=t||{}).image||{}).type||"auto",{url:s}=r||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(Xe)return"imagebitmap";if(qe)return"image";if(Ye)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Xe||qe||Ye;case"imagebitmap":return Xe;case"image":return qe;case"data":return Ye;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":i=await st(e,t,s);break;case"image":i=await tt(e,t,s);break;case"data":i=await function(e,t){var{mimeType:r}=at(e)||{};const{_parseImageNode:n}=Ge;return We(n),n(e,r,t)}(e,t);break;default:We(!1)}return"data"===n&&(i=function(e){switch(Qe(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(at(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};function dt(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function lt(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return r.substr(0,r.lastIndexOf("/")+1)+e}t={name:"Draco",id:"draco",module:"draco",version:"3.0.11",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class ht{constructor(e,t){h(this,"fields",void 0),h(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(e)),function(e){const t={};for(const r of e)t[r.name],t[r.name]=!0}(e),this.fields=e,this.metadata=t||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...e){const t=Object.create(null);for(const r of e)t[r]=!0;e=this.fields.filter(e=>t[e.name]);return new ht(e,this.metadata)}selectAt(...e){e=e.map(e=>this.fields[e]).filter(Boolean);return new ht(e,this.metadata)}assign(e){let t,r=this.metadata;var n;e instanceof ht?(n=e,t=n.fields,r=ft(ft(new Map,this.metadata),n.metadata)):t=e;const s=Object.create(null);for(const i of this.fields)s[i.name]=i;for(const o of t)s[o.name]=o;e=Object.values(s);return new ht(e,r)}}function ft(e,t){return new Map([...e||new Map,...t||new Map])}class mt{constructor(e,t,r=!1,n=new Map){h(this,"name",void 0),h(this,"type",void 0),h(this,"nullable",void 0),h(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new mt(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}}let pt;(s=pt=pt||{})[s.NONE=0]="NONE",s[s.Null=1]="Null",s[s.Int=2]="Int",s[s.Float=3]="Float",s[s.Binary=4]="Binary",s[s.Utf8=5]="Utf8",s[s.Bool=6]="Bool",s[s.Decimal=7]="Decimal",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Timestamp=10]="Timestamp",s[s.Interval=11]="Interval",s[s.List=12]="List",s[s.Struct=13]="Struct",s[s.Union=14]="Union",s[s.FixedSizeBinary=15]="FixedSizeBinary",s[s.FixedSizeList=16]="FixedSizeList",s[s.Map=17]="Map",s[s.Dictionary=-1]="Dictionary",s[s.Int8=-2]="Int8",s[s.Int16=-3]="Int16",s[s.Int32=-4]="Int32",s[s.Int64=-5]="Int64",s[s.Uint8=-6]="Uint8",s[s.Uint16=-7]="Uint16",s[s.Uint32=-8]="Uint32",s[s.Uint64=-9]="Uint64",s[s.Float16=-10]="Float16",s[s.Float32=-11]="Float32",s[s.Float64=-12]="Float64",s[s.DateDay=-13]="DateDay",s[s.DateMillisecond=-14]="DateMillisecond",s[s.TimestampSecond=-15]="TimestampSecond",s[s.TimestampMillisecond=-16]="TimestampMillisecond",s[s.TimestampMicrosecond=-17]="TimestampMicrosecond",s[s.TimestampNanosecond=-18]="TimestampNanosecond",s[s.TimeSecond=-19]="TimeSecond",s[s.TimeMillisecond=-20]="TimeMillisecond",s[s.TimeMicrosecond=-21]="TimeMicrosecond",s[s.TimeNanosecond=-22]="TimeNanosecond",s[s.DenseUnion=-23]="DenseUnion",s[s.SparseUnion=-24]="SparseUnion",s[s.IntervalDayTime=-25]="IntervalDayTime",s[s.IntervalYearMonth=-26]="IntervalYearMonth";class gt{static isNull(e){return e&&e.typeId===pt.Null}static isInt(e){return e&&e.typeId===pt.Int}static isFloat(e){return e&&e.typeId===pt.Float}static isBinary(e){return e&&e.typeId===pt.Binary}static isUtf8(e){return e&&e.typeId===pt.Utf8}static isBool(e){return e&&e.typeId===pt.Bool}static isDecimal(e){return e&&e.typeId===pt.Decimal}static isDate(e){return e&&e.typeId===pt.Date}static isTime(e){return e&&e.typeId===pt.Time}static isTimestamp(e){return e&&e.typeId===pt.Timestamp}static isInterval(e){return e&&e.typeId===pt.Interval}static isList(e){return e&&e.typeId===pt.List}static isStruct(e){return e&&e.typeId===pt.Struct}static isUnion(e){return e&&e.typeId===pt.Union}static isFixedSizeBinary(e){return e&&e.typeId===pt.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===pt.FixedSizeList}static isMap(e){return e&&e.typeId===pt.Map}static isDictionary(e){return e&&e.typeId===pt.Dictionary}get typeId(){return pt.NONE}compareTo(e){return this===e}}class yt extends gt{constructor(e,t){super(),h(this,"isSigned",void 0),h(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return pt.Int}get[Symbol.toStringTag](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}class bt extends yt{constructor(){super(!0,8)}}class vt extends yt{constructor(){super(!0,16)}}class wt extends yt{constructor(){super(!0,32)}}class _t extends yt{constructor(){super(!1,8)}}class xt extends yt{constructor(){super(!1,16)}}class Tt extends yt{constructor(){super(!1,32)}}const Et={HALF:16,SINGLE:32,DOUBLE:64};class At extends gt{constructor(e){super(),h(this,"precision",void 0),this.precision=e}get typeId(){return pt.Float}get[Symbol.toStringTag](){return"Float"}toString(){return`Float${this.precision}`}}class Mt extends At{constructor(){super(Et.SINGLE)}}class It extends At{constructor(){super(Et.DOUBLE)}}class jt extends gt{constructor(e,t){super(),h(this,"listSize",void 0),h(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return pt.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Symbol.toStringTag](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}function Lt(e,t,r){var n=Dt(t.metadata);const s=[];var i=function(e){const t={};for(const n in e){var r=e[n];t[r.name||"undefined"]=r}return t}(t.attributes);for(const a in e){var o=e[a],o=St(a,o,i[a]);s.push(o)}return r&&(r=St("indices",r),s.push(r)),new ht(s,n)}function St(e,t,r){var n=r?Dt(r.metadata):void 0,r=function(e){switch(e.constructor){case Int8Array:return new bt;case Uint8Array:return new _t;case Int16Array:return new vt;case Uint16Array:return new xt;case Int32Array:return new wt;case Uint32Array:return new Tt;case Float32Array:return new Mt;case Float64Array:return new It;default:throw new Error("array type not supported")}}(t.value);return new mt(e,new jt(t.size,new mt("value",r)),!1,n)}function Dt(e){const t=new Map;for(const r in e)t.set(`${r}.string`,JSON.stringify(e[r]));return t}const Ut={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ot={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Rt{constructor(e){h(this,"draco",void 0),h(this,"decoder",void 0),h(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);t=this.decoder.GetEncodedGeometryType(n);const s=new(t===this.draco.TRIANGULAR_MESH?this.draco.Mesh:this.draco.PointCloud);try{let e;switch(t){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!s.ptr){var i=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(i)}var o=this._getDracoLoaderData(s,t,r),a=this._getMeshData(s,o,r),u=function(e){let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;var a=e.POSITION?e.POSITION.value:[],u=a&&a.length;for(let e=0;e<u;e+=3){var c=a[e],d=a[e+1],l=a[e+2];t=c<t?c:t,r=d<r?d:r,n=l<n?l:n,s=c>s?c:s,i=d>i?d:i,o=l>o?l:o}return[[t,r,n],[s,i,o]]}(a.attributes),c=Lt(a.attributes,o,a.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:u},...a,schema:c}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,r){var n=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:r}}_getDracoAttributes(t,r){const n={};for(let e=0;e<t.num_attributes();e++){const i=this.decoder.GetAttribute(t,e);var s=this._getAttributeMetadata(t,e);n[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:e,metadata:s};s=this._getQuantizationTransform(i,r);s&&(n[i.unique_id()].quantization_transform=s);s=this._getOctahedronTransform(i,r);s&&(n[i.unique_id()].octahedron_transform=s)}return n}_getMeshData(e,t,r){var n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const a of Object.values(e.attributes)){var s=this._deduceAttributeName(a,r);a.name=s;var{value:i,size:o}=this._getAttributeValues(t,a);n[s]={value:i,size:o,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}return n}_getTriangleListIndices(e){var t=3*e.num_faces(),r=4*t,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(t){const r=t.size(),n=new Int32Array(r);for(let e=0;e<r;e++)n[e]=t.GetValue(e);return n}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=Ot[t.data_type];var n=t.num_components,s=e.num_points()*n,i=s*r.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,r);let a;var u=this.draco._malloc(i);try{var c=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,c,o,i,u),a=new r(this.draco.HEAPF32.buffer,u,s).slice()}finally{this.draco._free(u)}return{value:a,size:n}}_deduceAttributeName(e,t){var r,n,s=e.unique_id;for([r,n]of Object.entries(t.extraAttributes||{}))if(n===s)return r;var i=e.attribute_type;for(const o in Ut)if(this.draco[o]===i)return Ut[o];t=t.attributeNameEntry||"name";return e.metadata[t]?e.metadata[t].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){e=this.decoder.GetMetadata(e);return this._getDracoMetadata(e)}_getAttributeMetadata(e,t){t=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(t)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={};var n=this.metadataQuerier.NumEntries(t);for(let e=0;e<n;e++){var s=this.metadataQuerier.GetEntryName(t,e);r[s]=this._getDracoMetadataField(t,s)}return r}_getDracoMetadataField(e,t){var r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);var n=function(t){const r=t.size(),n=new Int32Array(r);for(let e=0;e<r;e++)n[e]=t.GetValue(e);return n}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){var{quantizedAttributes:t=[],octahedronAttributes:e=[]}=e;for(const r of[...t,...e])this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits(),range:n.range(),min_values:new Float32Array([1,2,3]).map(e=>n.min_value(e))}}finally{this.draco.destroy(n)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits()}}finally{this.draco.destroy(n)}}return null}}const Bt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.js",kt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_wasm_wrapper.js",Ft="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.wasm";let Ct;async function Pt(e){const t=e.modules||{};return Ct=t.draco3d?Ct||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Ct||async function(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await M(Bt,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await M(kt,"draco",e),await M(Ft,"draco",e)])}return t=t||globalThis.DracoDecoderModule,function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise(t=>{e({...r,onModuleLoaded:e=>t({draco:e})})})}(t,r)}(e),Ct}const Nt={...t,parse:async function(e,t){const{draco:r}=await Pt(t),n=new Rt(r);try{return n.parseSync(e,null==t?void 0:t.draco)}finally{n.destroy()}}};const Vt=["SCALAR","VEC2","VEC3","VEC4"];t=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]];const Ht=new Map(t),$t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Gt(e){return Vt[e-1]||Vt[0]}function qt(e){e=Ht.get(e.constructor);if(!e)throw new Error("Illegal typed array");return e}function Xt(e,t){var r=Wt[e.componentType],n=$t[e.type],s=zt[e.componentType],i=e.count*n,s=e.count*n*s;return dt(0<=s&&s<=t.byteLength),{ArrayType:r,length:i,byteLength:s}}const Yt={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Qt{constructor(e){h(this,"gltf",void 0),h(this,"sourceBuffers",void 0),h(this,"byteLength",void 0),this.gltf=e||{json:{...Yt},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(t){var e=this.getUsedExtensions().find(e=>e===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;var r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){var t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];dt(r);t=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,t,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data;const{ArrayType:n,length:s}=Xt(e,t);e=t.byteOffset+e.byteOffset;return new n(r,e,s)}getTypedArrayForImageData(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,e=t.byteOffset||0;return new Uint8Array(r,e,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{};e=r[t];return delete r[t],e}addExtension(e,t={}){return dt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return dt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){var{nodeIndices:e}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(e){var{meshIndex:t,matrix:e}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return e&&(r.matrix=e),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){var{attributes:t,indices:r,material:n,mode:e=4}=e;const s={primitives:[{attributes:this._addAttributes(t),mode:e}]};return r&&(r=this._addIndices(r),s.primitives[0].indices=r),Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){e={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(e,t){var r=at(e),r=t||(null==r?void 0:r.mimeType),r={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){var t=e.byteLength;dt(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);e={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=U(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(e),this.json.bufferViews.length-1}addAccessor(e,t){t={bufferView:e,type:Gt(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(t),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){var r=this.addBufferView(e);let n={min:t.min,max:t.max};n.min&&n.max||(n=this._getAccessorMinMax(e,t.size));e={size:t.size,componentType:qt(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(e,t))}addTexture(e){var{imageIndex:e}=e,e={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(e),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];var r=this.byteLength,n=new ArrayBuffer(r),s=new Uint8Array(n);let i=0;for(const o of this.sourceBuffers||[])i=function(e,t,r){let n;var s,i;return n=e instanceof ArrayBuffer?new Uint8Array(e):(s=e.byteOffset,i=e.byteLength,new Uint8Array(e.buffer||e.arrayBuffer,s,i)),t.set(n,r),r+U(n.byteLength,4)}(o,s,i);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){var n=e.indexOf(t);-1<n?e.splice(n,1):r=!1}}_addAttributes(e={}){const t={};for(const s in e){var r=e[s],n=this._getGltfAttributeName(s),r=this.addBinaryBuffer(r.value,r);t[n]=r}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(r,n){const s={min:null,max:null};if(r.length<n)return s;s.min=[],s.max=[];for(const e of r.subarray(0,n))s.min.push(e),s.max.push(e);for(let t=n;t<r.length;t+=n)for(let e=0;e<n;e++)s.min[0+e]=Math.min(s.min[0+e],r[t+e]),s.max[0+e]=Math.max(s.max[0+e],r[t+e]);return s}}const Kt="KHR_binary_glTF",Jt="KHR_draco_mesh_compression",Zt="KHR_lights_punctual",er="KHR_materials_unlit",tr="KHR_techniques_webgl";function rr(e){var{buffer:t,size:r,count:e}=function(e){let t=e,r=1,n=0;e&&e.value&&(t=e.value,r=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,r=!1){if(!e)return null;if(Array.isArray(e))return new t(e);return!r||e instanceof t?e:new t(e)}(t,Float32Array)),n=t.length/r);return{buffer:t,size:r,count:n}}(e);return{value:t,size:r,byteOffset:0,count:e,type:Gt(r),componentType:qt(t)}}const nr={KHR_draco_mesh_compression:Object.freeze({__proto__:null,decode:async function(e,t,r){var n;if(null!=t&&null!==(n=t.gltf)&&void 0!==n&&n.decompressMeshes){const s=new Qt(e),i=[];for(const o of function*(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}(s))s.getObjectExtension(o,Jt)&&i.push(async function(e,t,r,n){var s=e.getObjectExtension(t,Jt);if(s){s=e.getTypedArrayForBufferView(s.bufferView),s=D(s.buffer,s.byteOffset);const{parse:u}=n,c={...r};delete c["3d-tiles"];var i,o,a,s=await u(s,Nt,c,n),n=function(e){const t={};for(const n in e){var r=e[n];"indices"!==n&&(r=rr(r),t[n]=r)}return t}(s.attributes);for([i,o]of Object.entries(n))i in t.attributes&&(a=t.attributes[i],null!=(a=e.getAccessor(a))&&a.min&&null!=a&&a.max&&(o.min=a.min,o.max=a.max));t.attributes=n,s.indices&&(t.indices=rr(s.indices)),function(e){if(!e.attributes&&0<Object.keys(e.attributes).length)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}}(s,o,t,r));await Promise.all(i),s.removeExtension(Jt)}},encode:function(e,t=0){const r=new Qt(e);for(const n of r.json.meshes||[])!function(e,t=4,r,n){var s;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var i=r.DracoWriter.encodeSync({attributes:e}),e=null==n||null===(s=n.parseSync)||void 0===s?void 0:s.call(n,{attributes:e}),e=r._addFauxAttributes(e.attributes),i=r.addBufferView(i),e={primitives:[{attributes:e,mode:t,extensions:{[Jt]:{bufferView:i,attributes:e}}}]}}(n),r.addRequiredExtension(Jt)}}),KHR_materials_unlit:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:e}=t;t.removeExtension(er);for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,er)},encode:function(e){const t=new Qt(e);var{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,er,{}),t.addExtension(er))}}),KHR_lights_punctual:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;(e=t.getExtension(Zt))&&(t.json.lights=e.lights,t.removeExtension(Zt));for(const s of r.nodes||[]){var n=t.getObjectExtension(s,Zt);n&&(s.light=n.light),t.removeObjectExtension(s,Zt)}},encode:async function(e){const t=new Qt(e),{json:r}=t;if(r.lights){const s=t.addExtension(Zt);dt(!s.lights),s.lights=r.lights,delete r.lights}if(t.json.lights){for(const i of t.json.lights){var n=i.node;t.addObjectExtension(n,Zt,i)}delete t.json.lights}}}),KHR_techniques_webgl:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;if(e=t.getExtension(tr)){var n=function(e,t){const{programs:r=[],shaders:n=[],techniques:s=[]}=e,i=new TextDecoder;return n.forEach(e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=i.decode(t.getTypedArrayForBufferView(e.bufferView))}),r.forEach(e=>{e.fragmentShader=n[e.fragmentShader],e.vertexShader=n[e.vertexShader]}),s.forEach(e=>{e.program=r[e.program]}),s}(e,t);for(const i of r.materials||[]){var s=t.getObjectExtension(i,tr);s&&(i.technique=Object.assign({},s,n[s.technique]),i.technique.values=function(t,r){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(e=>{!t.uniforms[e].value||e in n||(n[e]=t.uniforms[e].value)}),Object.keys(n).forEach(e=>{"object"==typeof n[e]&&void 0!==n[e].index&&(n[e].texture=r.getTexture(n[e].index))}),n}(i.technique,t)),t.removeObjectExtension(i,tr)}t.removeExtension(tr)}},encode:async function(e,t){}})};const sr={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ir={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class or{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(e,t){this.json=e.json;var r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e){const t=new Qt(e),{json:r}=t;for(const s of r.images||[]){var n=t.removeObjectExtension(s,Kt);n&&Object.assign(s,n)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(Kt)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in sr)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){var r=e[t];if(r&&!Array.isArray(r)){e[t]=[];for(const s in r){const i=r[s];i.id=i.id||s;var n=e[t].length;e[t].push(i),this.idToIndexMap[t][s]=n}}}_convertObjectIdsToArrayIndices(e){for(const t in sr)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const n of e.meshes)this._convertMeshIds(n);for(const s of e.nodes)this._convertNodeIds(s);for(const i of e.scenes)this._convertSceneIds(i)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:s}=t;for(const i in r)r[i]=this._convertIdToIndex(r[i],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(e=>this._convertIdToIndex(e,"node"))),e.meshes&&(e.meshes=e.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(e,t){e[t]||(e[t]=[]);for(const n of e[t])for(const s in n){var r=n[s],r=this._convertIdToIndex(r,s);n[s]=r}}_convertIdToIndex(e,t){var r=ir[t];if(r in this.idToIndexMap){r=this.idToIndexMap[r][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values&&r.values.tex;var t=e.textures.findIndex(e=>e.id===n);-1!==t&&(r.pbrMetallicRoughness.baseColorTexture={index:t})}}}const ar={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ur={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};t={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986};const cr={magFilter:t.TEXTURE_MAG_FILTER,minFilter:t.TEXTURE_MIN_FILTER,wrapS:t.TEXTURE_WRAP_S,wrapT:t.TEXTURE_WRAP_T},dr={[t.TEXTURE_MAG_FILTER]:t.LINEAR,[t.TEXTURE_MIN_FILTER]:t.NEAREST_MIPMAP_LINEAR,[t.TEXTURE_WRAP_S]:t.REPEAT,[t.TEXTURE_WRAP_]:t.REPEAT};class lr{postProcess(e,t={}){var{json:r,buffers:n=[],images:s=[],baseUri:e=""}=e;return dt(r),this.baseUri=e,this.json=r,this.buffers=n,this.images=s,this._resolveTree(this.json,t),this.json}_resolveTree(e,t=0){e.bufferViews&&(e.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(e.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(e.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(e.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(e.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(e.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(e.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(e.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t))),e.skins&&(e.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(e.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return"object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map(e=>this.getNode(e)),e}_resolveNode(e,t){return e.id=e.id||`node-${t}`,e.children&&(e.children=e.children.map(e=>this.getNode(e))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce((e,t)=>{t=this.getMesh(t);return e.id=t.id,e.primitives=e.primitives.concat(t.primitives),e},{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||`skin-${t}`,e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||`mesh-${t}`,e.primitives&&(e.primitives=e.primitives.map(e=>{var t=(e={...e}).attributes;e.attributes={};for(const r in t)e.attributes[r]=this.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e})),e}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(t=e.componentType,ur[t]),e.components=(t=e.type,ar[t]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:s}=Xt(e,e.bufferView);t=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset,t=r.arrayBuffer.slice(t,t+s);e.value=new n(t)}return e}_resolveTexture(e,t){return e.id=e.id||`texture-${t}`,e.sampler="sampler"in e?this.getSampler(e.sampler):dr,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const n in e){var r=this._enumSamplerParameter(n);void 0!==r&&(e.parameters[r]=e[n])}return e}_enumSamplerParameter(e){return cr[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));t=this.images[t];return t&&(e.image=t),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;var r=e.buffer;e.buffer=this.buffers[r];t=this.buffers[r].arrayBuffer;let n=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(n+=e.byteOffset),e.data=new Uint8Array(t,n,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e.perspective,e.orthographic,e}}const hr=1735152710,fr=12,mr=8,pr=1313821514,gr=5130562,yr=0,br=1,vr=0,wr=!0;function _r(e,t,r=0){const n=new DataView(t);var s,i,o,a,t=(u=n,c=r+0,`\
${String.fromCharCode(u.getUint8(c+0))}\
${String.fromCharCode(u.getUint8(c+1))}\
${String.fromCharCode(u.getUint8(c+2))}\
${String.fromCharCode(u.getUint8(c+3))}`),u=n.getUint32(r+4,wr),c=n.getUint32(r+8,wr);switch(Object.assign(e,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:t,version:u,json:{},binChunks:[]}),r+=fr,e.version){case 1:return function(e,t,r){d(e.header.byteLength>fr+mr);var n=t.getUint32(r+0,wr),s=t.getUint32(r+4,wr);return r+=mr,d(s===vr),xr(e,t,r,n),r+=n,r+=Tr(e,t,r,e.header.byteLength)}(e,n,r);case 2:return s=e,i=n,o=r,a={},d(s.header.byteLength>fr+mr),function(e,t,r,n){for(;r+8<=e.header.byteLength;){var s=t.getUint32(r+0,wr),i=t.getUint32(r+4,wr);switch(r+=mr,i){case pr:xr(e,t,r,s);break;case gr:Tr(e,t,r,s);break;case yr:n.strict||xr(e,t,r,s);break;case br:n.strict||Tr(e,t,r,s)}r+=U(s,4)}}(s,i,o,a),o+s.header.byteLength;default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}function xr(e,t,r,n){r=new Uint8Array(t.buffer,r,n);const s=new TextDecoder("utf8");r=s.decode(r);return e.json=JSON.parse(r),U(n,4)}function Tr(e,t,r,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),U(n,4)}async function Er(e,t,r=0,n,s){var i,o,a,u;!function(e,t,r,n){n.uri&&(e.baseUri=n.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,r={}){const n=new DataView(e);var{magic:r=hr}=r;return(t=n.getUint32(t,!1))===r||t===hr}(t,r,n)){const o=new TextDecoder;t=o.decode(t)}"string"==typeof t?e.json=L(t):t instanceof ArrayBuffer?(r=_r(s={},t,r,n.glb),dt("glTF"===s.type,`Invalid GLB magic string ${s.type}`),e._glb=s,e.json=s.json):dt(!1,"GLTF: must be ArrayBuffer or string");var s=e.json.buffers||[];e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk&&({binChunks:i}=e._glb,e.buffers[0]={arrayBuffer:i[0].arrayBuffer,byteOffset:i[0].byteOffset,byteLength:i[0].byteLength});var i=e.json.images||[];e.images=new Array(i.length).fill({})}(e,t,r,n),r=e,a={normalize:null==n||null===(a=n.gltf)||void 0===a?void 0:a.normalize},(new or).normalize(r,a);const c=[];if(null!=n&&null!==(i=n.gltf)&&void 0!==i&&i.loadBuffers&&e.json.buffers&&await async function(t,r,n){for(let e=0;e<t.json.buffers.length;++e){const a=t.json.buffers[e];var s,i,o;a.uri&&({fetch:o}=n,dt(o),o=lt(a.uri,r),o=await(null==n||null===(s=n.fetch)||void 0===s?void 0:s.call(n,o)),o=await(null==o||null===(i=o.arrayBuffer)||void 0===i?void 0:i.call(o)),t.buffers[e]={arrayBuffer:o,byteOffset:0,byteLength:o.byteLength},delete a.uri)}}(e,n,s),null!=n&&null!==(o=n.gltf)&&void 0!==o&&o.loadImages){const d=async function(t,r,n){const s=t.json.images||[],i=[];for(let e=0;e<s.length;++e)i.push(async function(e,t,r,n,s){const{fetch:i,parse:o}=s;let a;if(t.uri){n=lt(t.uri,n);const u=await i(n);a=await u.arrayBuffer()}Number.isFinite(t.bufferView)&&(t=function(e,t,r){return dt(e=e.bufferViews[r]),dt(r=t[e.buffer]),t=(e.byteOffset||0)+r.byteOffset,new Uint8Array(r.arrayBuffer,t,e.byteLength)}(e.json,e.buffers,t.bufferView),a=D(t.buffer,t.byteOffset,t.byteLength));dt(a,"glTF image has no data");s=await o(a,ct,{},s);e.images[r]=s}(t,s[e],e,r,n));return Promise.all(i)}(e,n,s);c.push(d)}const d=async function(e,t={},r){for(const i in nr){var n,s=(null==t||null===(n=t.gltf)||void 0===n?void 0:n.excludeExtensions)||{};if(!(i in s&&!s[i])){const o=nr[i];await o.decode(e,t,r)}}}(e,n,s);return c.push(d),await Promise.all(c),null!=n&&null!==(u=n.gltf)&&void 0!==u&&u.postProcess?(u=e,n=n,(new lr).postProcess(u,n)):e}const Ar={name:"glTF",id:"gltf",module:"gltf",version:"3.0.11",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},r){(t={...Ar.options,...t}).gltf={...Ar.options.gltf,...t.gltf};var{byteOffset:n=0}=t;return Er({},e,n,t,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};var Mr,Ir="undefined"!=typeof Float32Array?Float32Array:Array;function jr(){var e=new Ir(16);return Ir!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Lr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sr(){var e=new Ir(3);return Ir!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Dr(e,t,r){var n=new Ir(3);return n[0]=e,n[1]=t,n[2]=r,n}function Ur(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Or(e,t,r){var n=t[0],s=t[1],i=t[2],o=r[0],t=r[1],r=r[2];return e[0]=s*r-i*t,e[1]=i*o-n*r,e[2]=n*t-s*o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),Sr(),Mr=new Ir(2),Ir!=Float32Array&&(Mr[0]=0,Mr[1]=0);class Rr{constructor(){this.position=Dr(0,0,0),this.rotation=Dr(0,0,0),this.scale=Dr(1,1,1),this.modelMatrix=jr(),this.shouldUpdate=!0}copyFromMatrix(e){var t;return t=this.modelMatrix,e=e,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this.shouldUpdate=!1,this}setPosition(e){var{x:t=this.position[0],y:r=this.position[1],z:e=this.position[2]}=e;return Ur(this.position,t,r,e),this.shouldUpdate=!0,this}setScale(e){var{x:t=this.scale[0],y:r=this.scale[1],z:e=this.scale[2]}=e;return Ur(this.scale,t,r,e),this.shouldUpdate=!0,this}setRotation(e){var{x:t=this.rotation[0],y:r=this.rotation[1],z:e=this.rotation[2]}=e;return Ur(this.rotation,t,r,e),this.shouldUpdate=!0,this}updateModelMatrix(){var e,t,r,n,s,i,o,a,u,c,d,l,h,f,m,p,g;return Lr(this.modelMatrix),f=this.modelMatrix,i=this.modelMatrix,h=this.position,l=h[0],m=h[1],c=h[2],i===f?(f[12]=i[0]*l+i[4]*m+i[8]*c+i[12],f[13]=i[1]*l+i[5]*m+i[9]*c+i[13],f[14]=i[2]*l+i[6]*m+i[10]*c+i[14],f[15]=i[3]*l+i[7]*m+i[11]*c+i[15]):(e=i[0],t=i[1],u=i[2],d=i[3],r=i[4],n=i[5],p=i[6],g=i[7],s=i[8],o=i[9],a=i[10],h=i[11],f[0]=e,f[1]=t,f[2]=u,f[3]=d,f[4]=r,f[5]=n,f[6]=p,f[7]=g,f[8]=s,f[9]=o,f[10]=a,f[11]=h,f[12]=e*l+r*m+s*c+i[12],f[13]=t*l+n*m+o*c+i[13],f[14]=u*l+p*m+a*c+i[14],f[15]=d*l+g*m+h*c+i[15]),o=this.modelMatrix,u=this.modelMatrix,p=this.rotation[0],a=Math.sin(p),f=Math.cos(p),d=u[4],l=u[5],g=u[6],m=u[7],h=u[8],c=u[9],i=u[10],p=u[11],u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=d*f+h*a,o[5]=l*f+c*a,o[6]=g*f+i*a,o[7]=m*f+p*a,o[8]=h*f-d*a,o[9]=c*f-l*a,o[10]=i*f-g*a,o[11]=p*f-m*a,u=this.modelMatrix,h=this.modelMatrix,d=this.rotation[1],c=Math.sin(d),l=Math.cos(d),i=h[0],g=h[1],o=h[2],p=h[3],f=h[8],m=h[9],a=h[10],d=h[11],h!==u&&(u[4]=h[4],u[5]=h[5],u[6]=h[6],u[7]=h[7],u[12]=h[12],u[13]=h[13],u[14]=h[14],u[15]=h[15]),u[0]=i*l-f*c,u[1]=g*l-m*c,u[2]=o*l-a*c,u[3]=p*l-d*c,u[8]=i*c+f*l,u[9]=g*c+m*l,u[10]=o*c+a*l,u[11]=p*c+d*l,h=this.modelMatrix,i=this.modelMatrix,f=this.rotation[2],g=Math.sin(f),m=Math.cos(f),o=i[0],a=i[1],u=i[2],p=i[3],c=i[4],d=i[5],l=i[6],f=i[7],i!==h&&(h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h[0]=o*m+c*g,h[1]=a*m+d*g,h[2]=u*m+l*g,h[3]=p*m+f*g,h[4]=c*m-o*g,h[5]=d*m-a*g,h[6]=l*m-u*g,h[7]=f*m-p*g,h=this.modelMatrix,f=this.modelMatrix,m=this.scale,p=m[0],g=m[1],m=m[2],h[0]=f[0]*p,h[1]=f[1]*p,h[2]=f[2]*p,h[3]=f[3]*p,h[4]=f[4]*g,h[5]=f[5]*g,h[6]=f[6]*g,h[7]=f[7]*g,h[8]=f[8]*m,h[9]=f[9]*m,h[10]=f[10]*m,h[11]=f[11]*m,h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15],this.shouldUpdate=!1,this}}const Br=(e,t,r)=>Math.min(Math.max(e,t),r);class kr{constructor(){this.value=0,this.damping=.5}addForce(e){this.value+=e}update(){return 1e-6<this.value*this.value?this.value*=this.damping:this.stop(),this.value}stop(){this.value=0}}class Fr{constructor(e,t=document.body,r=!1,n=1){this.target=Sr(),this.minDistance=0,this.maxDistance=1/0,this.isEnabled=!0,this.targetXDampedAction=new kr,this.targetYDampedAction=new kr,this.targetZDampedAction=new kr,this.targetThetaDampedAction=new kr,this.targetPhiDampedAction=new kr,this.targetRadiusDampedAction=new kr,this._isShiftDown=!1,this._rotateStart={x:9999,y:9999},this._rotateEnd={x:9999,y:9999},this._roatteDelta={x:9999,y:9999},this._zoomDistanceEnd=0,this._zoomDistance=0,this.state="",this.loopId=0,this._panStart={x:0,y:0},this._panDelta={x:0,y:0},this._panEnd={x:0,y:0},this._paused=!1,this._isDebug=!1,this.mouseWheelForce=1,this.mouseWheelForce=n,this.camera=e,this.domElement=t,this.isDamping=!1,this.dampingFactor=.25,this.isZoom=!0,this.zoomSpeed=1,this.isRotate=!0,this.rotateSpeed=1,this.isPan=!0,this.keyPanSpeed=7,this.enableKeys=!0,this.keys={LEFT:"37",UP:"38",RIGHT:"39",BOTTOM:"40",SHIFT:"16"},this.originTarget=Sr(),this.originPosition=Sr(),this.originPosition[0]=e.position[0],this.originPosition[1]=e.position[0],this.originPosition[2]=e.position[0];n=this.camera.position[0],t=this.camera.position[1],e=this.camera.position[2],n=Math.sqrt(n*n+t*t+e*e),t=Math.atan2(this.camera.position[0],this.camera.position[2]),e=Math.acos(Br(this.camera.position[1]/n,-1,1));this._spherical={radius:n,theta:t,phi:e},this._bindEvens(),this.setEventHandler(),this.startTick(),(this._isDebug=r)&&(this._outputEl=document.createElement("div"),this._outputEl.setAttribute("style",`
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 999;
      font-family: monospace;
      font-size: 14px;
      user-select: none;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 3px 6px;
    `),document.body.appendChild(this._outputEl))}lookAt([e,t,r]){return Ur(this.target,e,t,r),this}setEventHandler(){this.domElement.addEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.addEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.addEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.addEventListener("touchstart",this._touchStartHandler,!1),this.domElement.addEventListener("touchmove",this._touchMoveHandler,!1),window.addEventListener("keydown",this._onKeyDownHandler,!1),window.addEventListener("keyup",this._onKeyUpHandler,!1)}removeEventHandler(){this.domElement.removeEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.removeEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.removeEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1),this.domElement.removeEventListener("touchstart",this._touchStartHandler,!1),this.domElement.removeEventListener("touchmove",this._touchMoveHandler,!1),window.removeEventListener("keydown",this._onKeyDownHandler,!1),window.removeEventListener("keydown",this._onKeyUpHandler,!1)}startTick(){this.loopId=requestAnimationFrame(this.tick)}pause(){this._paused=!0}start(){this._paused=!1}tick(){var e,t,r;this._paused||(this.updateDampedAction(),this.updateCamera(),this._isDebug&&(e=Math.round(100*this.camera.position[0])/100,t=Math.round(100*this.camera.position[1])/100,r=Math.round(100*this.camera.position[2])/100,this._outputEl.textContent=`x: ${e} y: ${t} z: ${r}`)),this.loopId=requestAnimationFrame(this.tick)}updateDampedAction(){this.target[0]+=this.targetXDampedAction.update(),this.target[1]+=this.targetYDampedAction.update(),this.target[2]+=this.targetZDampedAction.update(),this._spherical.theta+=this.targetThetaDampedAction.update(),this._spherical.phi+=this.targetPhiDampedAction.update(),this._spherical.radius+=this.targetRadiusDampedAction.update()}updateCamera(){var e=this._spherical,t=Math.sin(e.phi)*e.radius;this.camera.position[0]=t*Math.sin(e.theta)+this.target[0],this.camera.position[1]=Math.cos(e.phi)*e.radius+this.target[1],this.camera.position[2]=t*Math.cos(e.theta)+this.target[2],this.camera.lookAtPosition[0]=this.target[0],this.camera.lookAtPosition[1]=this.target[1],this.camera.lookAtPosition[2]=this.target[2],this.camera.updateViewMatrix()}_bindEvens(){this.tick=this.tick.bind(this),this._contextMenuHandler=this._contextMenuHandler.bind(this),this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._touchStartHandler=this._touchStartHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._onKeyDownHandler=this._onKeyDownHandler.bind(this),this._onKeyUpHandler=this._onKeyUpHandler.bind(this)}_contextMenuHandler(e){this.isEnabled&&e.preventDefault()}_mouseDownHandler(e){this.isEnabled&&(0===e.button?(this.state="rotate",this._rotateStart={x:e.clientX,y:e.clientY}):(this.state="pan",this._panStart={x:e.clientX,y:e.clientY}),this.domElement.addEventListener("mousemove",this._mouseMoveHandler,!1),window.addEventListener("mouseup",this._mouseUpHandler,!1))}_mouseUpHandler(){this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1)}_mouseMoveHandler(e){this.isEnabled&&("rotate"===this.state?(this._rotateEnd={x:e.clientX,y:e.clientY},this._roatteDelta={x:this._rotateEnd.x-this._rotateStart.x,y:this._rotateEnd.y-this._rotateStart.y},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y}):"pan"===this.state&&(this._panEnd={x:e.clientX,y:e.clientY},this._panDelta={x:-.5*(this._panEnd.x-this._panStart.x),y:.5*(this._panEnd.y-this._panStart.y)},this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}))}_mouseWheelHandler(e){var t=this.mouseWheelForce;0<e.deltaY?this.targetRadiusDampedAction.addForce(t):this.targetRadiusDampedAction.addForce(-t)}_touchStartHandler(e){var t,r;switch(e.touches.length){case 1:this.state="rotate",this._rotateStart={x:e.touches[0].clientX,y:e.touches[0].clientY};break;case 2:this.state="zoom",t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistance=Math.sqrt(t*t+r*r);break;case 3:this.state="pan",this._panStart={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3}}}_touchMoveHandler(e){var t;switch(e.preventDefault(),e.touches.length){case 1:if("rotate"!==this.state)return;this._rotateEnd={x:e.touches[0].clientX,y:e.touches[0].clientY},this._roatteDelta={x:.5*(this._rotateEnd.x-this._rotateStart.x),y:.5*(this._rotateEnd.y-this._rotateStart.y)},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y};break;case 2:if("zoom"!==this.state)return;t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistanceEnd=Math.sqrt(t*t+r*r);var r=this._zoomDistanceEnd-this._zoomDistance,r=this._spherical.radius-(r*=1.5),r=Br(r,this.minDistance,this.maxDistance);this._zoomDistance=this._zoomDistanceEnd,this._spherical.radius=r;break;case 3:this._panEnd={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3},this._panDelta={x:this._panEnd.x-this._panStart.x,y:this._panEnd.y-this._panStart.y},this._panDelta.x*=-1,this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}}}_onKeyDownHandler(e){let t=0,r=0;switch(e.key){case this.keys.SHIFT:this._isShiftDown=!0;break;case this.keys.LEFT:t=-10;break;case this.keys.RIGHT:t=10;break;case this.keys.UP:r=10;break;case this.keys.BOTTOM:r=-10}this._isShiftDown?(this._roatteDelta={x:-t,y:r},this._updateRotateHandler()):(this._panDelta={x:t,y:r},this._updatePanHandler())}_onKeyUpHandler(e){e.key===this.keys.SHIFT&&(this._isShiftDown=!1)}_updatePanHandler(){var e,t,r,n,s=Sr(),i=Sr();const o=Sr();o[0]=this.target[0]-this.camera.position[0],o[1]=this.target[1]-this.camera.position[1],o[2]=this.target[2]-this.camera.position[2],e=o,t=o,r=t[0],n=t[1],a=t[2],0<(a=r*r+n*n+a*a)&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,Or(s,o,[0,1,0]),Or(i,s,o);var a=Math.max(this._spherical.radius/2e3,.001);this.targetXDampedAction.addForce((s[0]*this._panDelta.x+i[0]*this._panDelta.y)*a),this.targetYDampedAction.addForce((s[1]*this._panDelta.x+i[1]*this._panDelta.y)*a),this.targetZDampedAction.addForce((s[2]*this._panDelta.x+i[2]*this._panDelta.y)*a)}_updateRotateHandler(){this.targetThetaDampedAction.addForce(-this._roatteDelta.x/this.domElement.clientWidth),this.targetPhiDampedAction.addForce(-this._roatteDelta.y/this.domElement.clientHeight)}}class Cr{constructor(e,t,r,n){this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=jr(),this.viewMatrix=jr(),this.zoom=1,this.fieldOfView=e,this.aspect=t,this.near=r,this.far=n,this.updateProjectionMatrix()}setPosition({x:e=this.position[0],y:t=this.position[1],z:r=this.position[2]}){return this.position=[e,t,r],this}updateViewMatrix(){var e,t,r,n,s,i,o,a,u,c,d,l,h,f;return e=this.viewMatrix,t=this.position,r=this.lookAtPosition,n=Cr.UP_VECTOR,i=t[0],o=t[1],a=t[2],u=n[0],c=n[1],d=n[2],l=r[0],h=r[1],f=r[2],Math.abs(i-l)<1e-6&&Math.abs(o-h)<1e-6&&Math.abs(a-f)<1e-6?Lr(e):(s=i-l,t=o-h,n=a-f,l=c*(n*=r=1/Math.hypot(s,t,n))-d*(t*=r),h=d*(s*=r)-u*n,f=u*t-c*s,(r=Math.hypot(l,h,f))?(l*=r=1/r,h*=r,f*=r):f=h=l=0,d=t*f-n*h,u=n*l-s*f,c=s*h-t*l,(r=Math.hypot(d,u,c))?(d*=r=1/r,u*=r,c*=r):c=u=d=0,e[0]=l,e[1]=d,e[2]=s,e[3]=0,e[4]=h,e[5]=u,e[6]=t,e[7]=0,e[8]=f,e[9]=c,e[10]=n,e[11]=0,e[12]=-(l*i+h*o+f*a),e[13]=-(d*i+u*o+c*a),e[14]=-(s*i+t*o+n*a),e[15]=1),this}updateProjectionMatrix(){var e,t,r,n,s;return e=this.projectionMatrix,t=this.fieldOfView,r=this.aspect,n=this.near,s=this.far,t=1/Math.tan(t/2),e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(e[10]=(s+n)*(t=1/(n-s)),e[14]=2*s*n*t):(e[10]=-1,e[14]=-2*n),this}lookAt(e){return this.lookAtPosition=e,this.updateViewMatrix(),this}}Cr.UP_VECTOR=[0,1,0];e(void 0,void 0,void 0,function*(){var e=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter();const t=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",e=>{document.body.innerHTML+=t}),window.addEventListener("error",e=>{document.body.innerHTML+=t}),e||(document.body.innerHTML+=t)}),e(void 0,void 0,void 0,function*(){var e=yield async function(e,t,r){Array.isArray(t)||Ie(t)||(r=t,t=void 0);const n=Ee(r);let s=e;return"string"==typeof e&&(s=await n(e)),H(e)&&(s=await n(e)),ze(s,t,r)}(`${window.ASSETS_BASE_URL}Triangle.gltf`,Ar);const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const r=yield null===(o=navigator.gpu)||void 0===o?void 0:o.requestAdapter(),s=yield null===r||void 0===r?void 0:r.requestDevice(),i=t.getContext("webgpu");var n=i.getPreferredFormat(r);i.configure({device:s,format:n});var o=e.accessors[1].value;const a=s.createBuffer({size:o.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(a.getMappedRange()).set(o),a.unmap();const u=e.accessors[0].value,c=s.createBuffer({size:8*Math.ceil(u.byteLength/8),usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new(u instanceof Uint16Array?Uint16Array:Uint32Array)(c.getMappedRange()).set(u),c.unmap();const d=s.createRenderPipeline({vertex:{module:s.createShaderModule({code:"\n[[block]]\nstruct Transform {\n  projectionMatrix: mat4x4<f32>;\n  viewMatrix: mat4x4<f32>;\n  modelMatrix: mat4x4<f32>;\n};\n\n[[group(0), binding(0)]]\nvar<uniform> transforms: Transform;\n\nstruct Input {\n  [[location(0)]] position: vec4<f32>;\n};\n\nstruct Output {\n  [[builtin(position)]] Position: vec4<f32>;\n};\n\n[[stage(vertex)]]\nfn main (input: Input) -> Output {\n  var output: Output;\n\n  output.Position = transforms.projectionMatrix *\n                    transforms.viewMatrix *\n                    transforms.modelMatrix *\n                    input.position;\n\n  return output;\n}\n"}),entryPoint:"main",buffers:[{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]}]},fragment:{module:s.createShaderModule({code:"\n[[stage(fragment)]]\n\nfn main () -> [[location(0)]] vec4<f32> {\n  return vec4<f32>(1.0);\n}\n"}),entryPoint:"main",targets:[{format:n}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0},multisample:{count:4},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),l=s.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),h=s.createBindGroup({layout:d.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:l,offset:0,size:48*Float32Array.BYTES_PER_ELEMENT}}]}),f=new Cr(45*Math.PI/180,t.width/t.height,.1,100);f.setPosition({x:0,y:0,z:3}),f.lookAt([0,0,0]),f.updateProjectionMatrix(),f.updateViewMatrix(),new Fr(f);const m=new Rr,p=s.createTexture({size:[t.width,t.height,1],format:"depth24plus",sampleCount:4,usage:GPUTextureUsage.RENDER_ATTACHMENT}),g=s.createTexture({size:[t.width,t.height],sampleCount:4,format:n,usage:GPUTextureUsage.RENDER_ATTACHMENT});let y=g.createView();m.setPosition({x:-e.accessors[0].max[0]/4,y:-e.accessors[0].max[0]/4}).updateModelMatrix(),s.queue.writeBuffer(l,32*Float32Array.BYTES_PER_ELEMENT,m.modelMatrix),requestAnimationFrame(function e(t){requestAnimationFrame(e);const r=s.createCommandEncoder();const n=r.beginRenderPass({colorAttachments:[{view:y,resolveTarget:i.getCurrentTexture().createView(),loadValue:[.1,.1,.1,1],storeOp:"store"}],depthStencilAttachment:{view:p.createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}});s.queue.writeBuffer(l,0,f.projectionMatrix);s.queue.writeBuffer(l,16*Float32Array.BYTES_PER_ELEMENT,f.viewMatrix);n.setPipeline(d);n.setVertexBuffer(0,a);n.setIndexBuffer(c,u instanceof Uint16Array?"uint16":"uint32");n.setBindGroup(0,h);n.drawIndexed(u.length);n.endPass();s.queue.submit([r.finish()])})})}();
