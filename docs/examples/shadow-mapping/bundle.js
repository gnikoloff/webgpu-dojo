!function(){"use strict";function e(e,s,a,u){return new(a=a||Promise)(function(r,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}o((u=u.apply(e,s||[])).next())})}function l(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var t={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const r=t.global||t.self||t.window||{},n="object"!=typeof process||"[object process]"!==String(process)||process.browser;var i="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);i&&parseFloat(i[1]);const s="3.0.11";function c(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const a=o.global||o.self||o.window||{},u="object"!=typeof process||"[object process]"!==String(process)||process.browser,d="function"==typeof importScripts,h="undefined"!=typeof window&&void 0!==window.orientation;t="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t&&parseFloat(t[1]);class p{constructor(e,t){f(this,"name",void 0),f(this,"workerThread",void 0),f(this,"isRunning",void 0),f(this,"result",void 0),f(this,"_resolve",void 0),f(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){c(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){c(this.isRunning),this.isRunning=!1,this._reject(e)}}const m=new Map;function g(e){c(e.source&&!e.url||!e.source&&e.url);let t=m.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;e=`\
try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`;return _(e)}(e.url),m.set(e.url,t)),e.source&&(t=_(e.source),m.set(e.source,t))),c(t),t}function _(e){e=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(e)}function y(e){return e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const b=()=>{};class v{static isSupported(){return"undefined"!=typeof Worker}constructor(e){f(this,"name",void 0),f(this,"source",void 0),f(this,"url",void 0),f(this,"terminated",!1),f(this,"worker",void 0),f(this,"onMessage",void 0),f(this,"onError",void 0),f(this,"_loadableURL","");var{name:t,source:r,url:e}=e;c(r||e),this.name=t,this.source=r,this.url=e,this.onMessage=b,this.onError=e=>{},this.worker=this._createBrowserWorker()}destroy(){this.onMessage=b,this.onError=b,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||function e(t,r=!0,n){const i=n||new Set;if(t)if(y(t))i.add(t);else if(y(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)&&r&&"object"==typeof t)for(const o in t)e(t[o],r,i);return void 0===n?Array.from(i):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=g({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}}class w{constructor(e){f(this,"name","unnamed"),f(this,"source",void 0),f(this,"url",void 0),f(this,"maxConcurrency",1),f(this,"maxMobileConcurrency",1),f(this,"onDebug",()=>{}),f(this,"reuseWorkers",!0),f(this,"props",{}),f(this,"jobQueue",[]),f(this,"idleQueue",[]),f(this,"count",0),f(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(t,r=(e,t,r)=>e.done(r),n=(e,t)=>e.error(t)){var e=new Promise(e=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:e}),this));return this._startQueuedJob(),e}async _startQueuedJob(){if(this.jobQueue.length){const e=this._getAvailableWorker();if(e){const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new p(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(0<this.idleQueue.length)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new v({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return h?this.maxMobileConcurrency:this.maxConcurrency}}const x={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class E{static isSupported(){return v.isSupported()}static getWorkerFarm(e={}){return E._workerFarm=E._workerFarm||new E({}),E._workerFarm.setProps(e),E._workerFarm}constructor(e){f(this,"props",void 0),f(this,"workerPools",new Map),this.props={...x},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){var{name:t,source:r,url:e}=e;let n=this.workerPools.get(t);return n||(n=new w({name:t,source:r,url:e}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}f(E,"_workerFarm",void 0);const A="latest";const T="3.0.11",S={};async function M(e,t=null,r={}){return t&&(e=function(e,t,r){if(e.startsWith("http"))return e;var n=r.modules||{};if(n[e])return n[e];if(!u)return`modules/${t}/dist/libs/${e}`;if(r.CDN)return c(r.CDN.startsWith("http")),`${r.CDN}/${t}@${T}/dist/libs/${e}`;if(d)return`../src/libs/${e}`;return`modules/${t}/src/libs/${e}`}(e,t,r)),S[e]=S[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return t.arrayBuffer()}if(!u)return;if(d)return importScripts(e);const t=await fetch(e),r=await t.text();return function(t,e){if(!u)return;if(d)return eval.call(a,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}(r,e)}(e),S[e]}async function O(e,t,r,n,i){var o=e.id,e=function(t,r={}){var e=r[t.id]||{},n=`${t.id}-worker.js`;let i=e.workerUrl;if("test"===r._workerType&&(i=`modules/${t.module}/dist/${n}`),!i){let e=t.version;"latest"===e&&(e=A);r=e?`@${e}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${r}/dist/${n}`}return c(i),i}(e,r);const s=E.getWorkerFarm(r),a=s.getWorkerPool({name:o,url:e});r=JSON.parse(JSON.stringify(r));const u=await a.startJob("process-on-worker",async function(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(n.error);break;case"process":var{id:i,input:o,options:s}=n;try{var a=await e(o,s);t.postMessage("done",{id:i,result:a})}catch(e){a=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:i,error:a})}}}.bind(null,i));return u.postMessage("process",{input:t,options:r}),(await u.result).result}function C(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let i="";for(let e=0;e<r;e++)i+=String.fromCharCode(n.getUint8(t+e));return i}function k(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${r=t,t=5,"string"==typeof r?r.slice(0,t):ArrayBuffer.isView(r)?C(r.buffer,r.byteOffset,t):r instanceof ArrayBuffer?C(r,0,t):""}"`)}var r}function I(e){if(void 0,e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function B(e,t,r){t=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(t).buffer}function L(e,t){return l(0<=e),l(0<t),e+(t-1)&~(t-1)}async function F(e){const t=[];for await(const r of e)t.push(r);return function(...e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e);e=t.reduce((e,t)=>e+t.byteLength,0);const r=new Uint8Array(e);let n=0;for(const i of t)r.set(i,n),n+=i.byteLength;return r.buffer}(...t)}let U="";const P={};const R=e=>"function"==typeof e,j=e=>null!==e&&"object"==typeof e,D=e=>j(e)&&e.constructor==={}.constructor,N=e=>e&&"function"==typeof e[Symbol.iterator],V=e=>e&&"function"==typeof e[Symbol.asyncIterator],H=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,z=e=>"undefined"!=typeof Blob&&e instanceof Blob,$=e=>e&&"object"==typeof e&&e.isBuffer,G=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||j(e)&&R(e.tee)&&R(e.cancel)&&R(e.getReader))(e)||(e=>j(e)&&R(e.read)&&R(e.pipe)&&"boolean"==typeof e.readable)(e),W=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Y=/^([-\w.]+\/[-\w.+]+)/;function X(e){e=W.exec(e);return e?e[1]:""}const q=/\?.*/;function K(e){if(H(e)){var t=Q(e.url||""),r=e.headers.get("content-type")||"";return{url:t,type:(n=r,((r=Y.exec(n))?r[1]:n)||X(t))}}var n;return z(e)?{url:Q(e.name||""),type:e.type||""}:"string"==typeof e?{url:Q(e),type:X(e)}:{url:"",type:""}}function Q(e){return e.replace(q,"")}async function J(e){if(H(e))return e;const t={};var r=(n=e,H(n)?n.headers["content-length"]||-1:z(n)?n.size:"string"==typeof n?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1);0<=r&&(t["content-length"]=String(r));var{url:n,type:r}=K(e);r&&(t["content-type"]=r);r=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return new Promise(r=>{const e=new FileReader;e.onload=e=>{var t;return r(null==e||null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(t)})}if(e instanceof ArrayBuffer)return`data:base64,${function(e){let t="";var r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5))}`;return null}(e);r&&(t["x-first-bytes"]=r),"string"==typeof e&&(e=(new TextEncoder).encode(e));e=new Response(e,{headers:t});return Object.defineProperty(e,"url",{value:n}),e}async function Z(e){if(!e.ok){e=await async function(t){let r=`Failed to fetch resource ${t.url} (${t.status}): `;try{const n=t.headers.get("Content-Type");let e=t.statusText;n.includes("application/json")&&(e+=` ${await t.text()}`),r+=e,r=60<r.length?`${r.slice(60)}...`:r}catch(e){}return r}(e);throw new Error(e)}}async function ee(t,r){if("string"!=typeof t)return J(t);{t=function(e){for(const r in P){var t;e.startsWith(r)&&(t=P[r],e=e.replace(r,t))}return e=!e.startsWith("http://")&&!e.startsWith("https://")?`${U}${e}`:e}(t);let e=r;return null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(e=r.fetch),fetch(t,e)}}i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process};const te=i.window||i.self||i.global,re=i.process||{},ne="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",ie=!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;var t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;const r=e||t;return!!(r&&0<=r.indexOf("Electron"))}();class oe{constructor(e,t,r="sessionStorage"){this.storage=function(e){try{const r=window[e];var t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch(e){return null}}(r),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){return Object.assign(this.config,e),this.storage&&(e=JSON.stringify(this.config),this.storage.setItem(this.id,e)),this}_loadConfiguration(){let e={};var t;return this.storage&&(t=this.storage.getItem(this.id),e=t?JSON.parse(t):{}),Object.assign(this.config,e),this}}const se={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function ae(e){return"string"==typeof e?se[e.toUpperCase()]||se.WHITE:e}function ue(e,t){if(!e)throw new Error(t||"Assertion failed")}function ce(){let e;var t;return e=ie&&te.performance?te.performance.now():re.hrtime?1e3*(t=re.hrtime())[0]+t[1]/1e6:Date.now(),e}const le={debug:ie&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},de={enabled:!0,level:0};function he(){}const fe={},pe={once:!0};class me{constructor({id:e}={id:""}){this.id=e,this.VERSION=ne,this._startTs=ce(),this._deltaTs=ce(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new oe("__probe-".concat(this.id,"__"),de),this.userData={},this.timeStamp("".concat(this.id," started")),function(e,t=["constructor"]){var r=Object.getPrototypeOf(e);for(const n of Object.getOwnPropertyNames(r))"function"==typeof e[n]&&(t.find(e=>n===e)||(e[n]=e[n].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ce()-this._startTs).toPrecision(10))}getDelta(){return Number((ce()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){ue(e,t)}warn(e){return this._getLogFunction(0,e,le.warn,arguments,pe)}error(e){return this._getLogFunction(0,e,le.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,le.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,le.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,le.debug||le.info,arguments,pe)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||he,r&&[r],{tag:function(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}(t)}):he}image({logLevel:e,priority:t,image:r,message:n="",scale:i=1}){return this._shouldLog(e||t)?(ie?function({image:e,message:o="",scale:s=1}){if("string"==typeof e){const a=new Image;return a.onload=()=>{var e,t,r,n,i;e=a,t=o,r=s,n=600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29"),e.width>n&&(r=Math.min(r,n/e.width)),n=e.width*r,r=e.height*r,["font-size:1px;","padding:".concat(Math.floor(r/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(r,"px;"),"background:url(".concat(i,");"),"background-size:".concat(n,"px ").concat(r,"px;"),"color:transparent;"].join(""),"".concat(t," %c+")},a.src=e,he}const t=e.nodeName||"";if("img"===t.toLowerCase())return he;if("canvas"!==t.toLowerCase())return he;{const r=new Image;return r.onload=()=>{},r.src=e.toDataURL(),he}}:function({image:e,scale:t=1}){let r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return()=>r(e,{fit:"box",width:"".concat(Math.round(80*t),"%")}).then(e=>{});return he})({image:r,message:n,scale:i}):he}settings(){}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time||console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd||console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||he)}group(e,t,r={collapsed:!1}){var{collapsed:t}=r=_e({logLevel:e,message:t,opts:r});return r.method=(t?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||he)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ge(e)}_getLogFunction(e,t,r,n=[],i){if(this._shouldLog(e)){i=_e({logLevel:e,message:t,args:n,opts:i}),ue(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=ce();n=i.tag||i.message;if(i.once){if(fe[n])return he;fe[n]=ce()}return t=function(e,t,r){{var n;"string"==typeof t&&(n=r.time?function(e,t=8){return t=Math.max(t-e.length,0),"".concat(" ".repeat(t)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(r.total)):"",t=function(e,t,r){return ie||"string"!=typeof e||(t&&(t=ae(t),e="[".concat(t,"m").concat(e,"[39m")),r&&(t=ae(r),e="[".concat(r+10,"m").concat(e,"[49m"))),e}(t=(r.time?"".concat(e,": ").concat(n,"  "):"".concat(e,": ")).concat(t),r.color,r.background))}return t}(this.id,i.message,i),r.bind(console,t,...i.args)}return he}}function ge(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return ue(Number.isFinite(t)&&0<=t),t}function _e(e){var{logLevel:t,message:r}=e;e.logLevel=ge(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(e.args=n,typeof t){case"string":case"function":void 0!==r&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var i=typeof e.message;return ue("string"==i||"object"==i),Object.assign(e,e.opts)}me.VERSION=ne;const ye=new me({id:"loaders.gl"});class be{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const ve={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){f(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},we={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xe(){r.loaders=r.loaders||{};const{loaders:e}=r;return e._state=e._state||{},e._state}const Ee=()=>{const e=xe();return e.globalOptions=e.globalOptions||{...ve},e.globalOptions};function Ae(e,t,r,n){return r=r||[],function(e,t){Se(e,null,ve,we,t);for(const o of t){var r=e&&e[o.id]||{},n=o.options&&o.options[o.id]||{},i=o.deprecatedOptions&&o.deprecatedOptions[o.id]||{};Se(r,o.id,n,i,t)}}(e,r=Array.isArray(r)?r:[r]),function(e,t,r){const n=e.options||{},i={...n};(function(e,t){!t||"baseUri"in e||(e.baseUri=t)})(i,r),null===i.log&&(i.log=new be);return Me(i,Ee()),Me(i,t),i}(t,e,n)}function Te(e,t){var r=Ee();const n=e||r;return"function"==typeof n.fetch?n.fetch:j(n.fetch)?e=>ee(e,n):null!=t&&t.fetch?null==t?void 0:t.fetch:ee}function Se(e,t,r,n,i){var o=t||"Top level",s=t?`${t}.`:"";for(const l in e){var a=!t&&j(e[l]),u="baseUri"===l&&!t,c="workerUrl"===l&&t;l in r||u||c||(l in n?ye.warn(`${o} loader option \'${s}${l}\' no longer supported, use \'${n[l]}\'`)():a||(a=function(e,t){const r=e.toLowerCase();let n="";for(const i of t)for(const o in i.options){if(e===o)return`Did you mean \'${i.id}.${o}\'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean \'${i.id}.${o}\'?`)}return n}(l,i),ye.warn(`${o} loader option \'${s}${l}\' not recognized. ${a}`)()))}}function Me(e,t){for(const n in t){var r;n in t&&(r=t[n],D(r)&&D(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n])}}function Oe(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===e||void 0===e?void 0:e.extensions))}function Ce(e){var t;return l(e,"null loader"),l(Oe(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(null!==e&&void 0!==e&&e.parseTextSync||null!==e&&void 0!==e&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const ke=()=>{const e=xe();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const Ie=/\.([^.]+)$/;function Be(e,t=[],r,n){if(!Le(e))return null;if(t&&!Array.isArray(t))return Ce(t);let i=[];t&&(i=i.concat(t)),null!=r&&r.ignoreRegisteredLoaders||i.push(...ke()),function(e){for(const t of e)Ce(t)}(i);n=function(e,t,r,n){var{url:i,type:o}=K(e),n=i||(null==n?void 0:n.url);let s=null;null!=r&&r.mimeType&&(s=Ue(t,null==r?void 0:r.mimeType));return s=s||function(e,t){t=t&&Ie.exec(t),t=t&&t[1];return t?function(e,t){t=t.toLowerCase();for(const r of e)for(const n of r.extensions)if(n.toLowerCase()===t)return r;return null}(e,t):null}(t,n),s=s||Ue(t,o),s=s||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(function(t,e){if(e.testText)return e.testText(t);const r=Array.isArray(e.tests)?e.tests:[e.tests];return r.some(e=>t.startsWith(e))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(Pe(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer)if(Pe(t,0,r))return r;return null}(t,e),s=s||Ue(t,null==r?void 0:r.fallbackMimeType),s}(e,i,r,n);if(!(n||null!=r&&r.nothrow))throw new Error(Fe(e));return n}function Le(e){return!(e instanceof Response&&204===e.status)}function Fe(e){var{url:t,type:r}=K(e);let n="No valid loader found";return e&&(n+=` data: "${function(e,t=5){{if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Re(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return Re(e,0,t)}return""}(e)}", contentType: "${r}"`),t&&(n+=` url: ${t}`),n}function Ue(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t===`application/x.${r.id}`)return r}return null}function Pe(t,r,n){const e=Array.isArray(n.tests)?n.tests:[n.tests];return e.some(e=>function(e,t,r,n){if(n instanceof ArrayBuffer)return function(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;var n=new Uint8Array(e),i=new Uint8Array(t);for(let e=0;e<n.length;++e)if(n[e]!==i[e])return!1;return!0}(n,e,n.byteLength);switch(typeof n){case"function":return n(e,r);case"string":var i=Re(e,t,n.length);return n===i;default:return!1}}(t,r,n,e))}function Re(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let i="";for(let e=0;e<r;e++)i+=String.fromCharCode(n.getUint8(t+e));return i}const je=262144;const De=262144;const Ne=1048576;function Ve(e,t){return n?async function*(e,t){const r=e.getReader();let n;try{for(;;){var i=n||r.read();null!=t&&t._streamReadAhead&&(n=r.read());var{done:o,value:s}=await i;if(o)return;yield I(s)}}catch(e){r.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield I(t)}(e)}function He(e,t){if("string"==typeof e)return function*(e,t){var r=(null==t?void 0:t.chunkSize)||je;let n=0;const i=new TextEncoder;for(;n<e.length;){var o=Math.min(e.length-n,r),s=e.slice(n,n+o);n+=o,yield i.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){var{chunkSize:r=De}=t;let n=0;for(;n<e.byteLength;){var i=Math.min(e.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(e,n,i);const a=new Uint8Array(o);a.set(s),n+=i,yield o}}(e,t);if(z(e))return async function*(e,t){var r=(null==t?void 0:t.chunkSize)||Ne;let n=0;for(;n<e.size;){var i=n+r,o=await e.slice(n,i).arrayBuffer();n=i,yield o}}(e,t);if(G(e))return Ve(e,t);if(H(e))return Ve(e.body,t);throw new Error("makeIterator")}const ze="Cannot convert supplied data type";async function $e(e,t,r){var n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(t,r){if(r.text&&"string"==typeof t)return t;if((t=$(t)?t.buffer:t)instanceof ArrayBuffer){var e=t;if(!r.text||r.binary)return e;{const n=new TextDecoder("utf8");return n.decode(e)}}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){const i=new TextDecoder("utf8");return i.decode(t)}let e=t.buffer;r=t.byteLength||t.length;return 0===t.byteOffset&&r===e.byteLength||(e=e.slice(t.byteOffset,t.byteOffset+r)),e}throw new Error(ze)}(e,t);if(z(e)&&(e=await J(e)),H(e)){const i=e;return await Z(i),t.binary?await i.arrayBuffer():await i.text()}if(G(e)&&(e=He(e,r)),N(e)||V(e))return F(e);throw new Error(ze)}async function Ge(e,t,r,n){c(!n||"object"==typeof n),!t||Array.isArray(t)||Oe(t)||(r=t,t=n=void 0),r=r||{};var{url:i}=K(e=await e),o=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;return e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders&&(t=Array.isArray(t.loaders)?t.loaders:[t.loaders],r=r?[...r,...t]:t),r&&r.length?r:null}(t,n),t=await async function(e,t=[],r,n){if(!Le(e))return null;let i=Be(e,t,{...r,nothrow:!0},n);if(i)return i;if(z(e)&&(e=await e.slice(0,10).arrayBuffer(),i=Be(e,t,r,n)),!(i||null!=r&&r.nothrow))throw new Error(Fe(e));return i}(e,o,r);return t?async function(e,t,r,n){if(function(e,t=s){c(e,"no worker provided"),e=e.version}(e),t=await $e(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,n,e);if(function(e,t){return E.isSupported()&&(e.worker&&null!=t&&t.worker)}(e,r))return O(e,t,r,0,Ge);if(e.parseText&&"string"==typeof t)return e.parseText(t,r,n,e);if(e.parse)return e.parse(t,r,n,e);throw c(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(t,e,r=Ae(r,t,o,i),n=function(e,t,r=null){if(r)return r;const n={fetch:Te(t,e),...e};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:i,parse:Ge,loaders:o},r,n)):null}function We(e,t){if(!e)throw new Error(t)}o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};const Ye=o.global||o.self||o.window;t="object"!=typeof process||"[object process]"!==String(process)||process.browser,i="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);i&&parseFloat(i[1]);var{_parseImageNode:o}=Ye;const Xe="undefined"!=typeof Image,qe="undefined"!=typeof ImageBitmap;i=Boolean(o);const Ke=!!t||i;function Qe(e){e=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!e)throw new Error("Not an image");return e}const Je=/^data:image\/svg\+xml/,Ze=/\.svg((\?|#).*)?$/;function et(e){return e&&(Je.test(e)||Ze.test(e))}function tt(e,t){if(et(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function rt(e,t,r){e=function(t,e){if(et(e)){const r=new TextDecoder;let e=r.decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return tt(t,e)}(e,r);const n=self.URL||self.webkitURL;r="string"!=typeof e&&n.createObjectURL(e);try{return await async function(r,e){const n=new Image;if(n.src=r,e.image&&e.image.decode&&n.decode)return await n.decode(),n;return new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>t(new Error(`Could not load image ${r}: ${e}`))}catch(e){t(e)}})}(r||e,t)}finally{r&&n.revokeObjectURL(r)}}const nt={};let it=!0;async function ot(e,t,r){let n;n=et(r)?await rt(e,t,r):tt(e,r);t=t&&t.imagebitmap;return async function(e,t=null){!function(e){for(const t in e||nt)return!1;return!0}(t)&&it||(t=null);if(t)try{return createImageBitmap(e,t)}catch(e){it=!1}return createImageBitmap(e)}(n,t)}const st=!1,at=!0;function ut(e){e=ct(e);return function(e){const t=ct(e),r=24<=t.byteLength&&2303741511===t.getUint32(0,st);return r?{mimeType:"image/png",width:t.getUint32(16,st),height:t.getUint32(20,st)}:null}(e)||function(e){const t=ct(e),r=3<=t.byteLength&&65496===t.getUint16(0,st)&&255===t.getUint8(2);if(!r)return null;const{tableMarkers:n,sofMarkers:i}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let o=2;for(;o+9<t.byteLength;){var s=t.getUint16(o,st);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(o+5,st),width:t.getUint16(o+7,st)};if(!n.has(s))return null;o+=2,o+=t.getUint16(o,st)}return null}(e)||function(e){const t=ct(e),r=10<=t.byteLength&&1195984440===t.getUint32(0,st);return r?{mimeType:"image/gif",width:t.getUint16(6,at),height:t.getUint16(8,at)}:null}(e)||function(e){const t=ct(e),r=14<=t.byteLength&&16973===t.getUint16(0,st)&&t.getUint32(2,at)===t.byteLength;return r?{mimeType:"image/bmp",width:t.getUint32(18,at),height:t.getUint32(22,at)}:null}(e)}function ct(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const lt={id:"image",module:"images",name:"Images",version:"3.0.11",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,r){var n=((t=t||{}).image||{}).type||"auto",{url:i}=r||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(qe)return"imagebitmap";if(Xe)return"image";if(Ke)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return qe||Xe||Ke;case"imagebitmap":return qe;case"image":return Xe;case"data":return Ke;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":o=await ot(e,t,i);break;case"image":o=await rt(e,t,i);break;case"data":o=await function(e,t){var{mimeType:r}=ut(e)||{};const{_parseImageNode:n}=Ye;return We(n),n(e,r,t)}(e,t);break;default:We(!1)}return"data"===n&&(o=function(e){switch(Qe(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(ut(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};function dt(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function ht(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return r.substr(0,r.lastIndexOf("/")+1)+e}o={name:"Draco",id:"draco",module:"draco",version:"3.0.11",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class ft{constructor(e,t){f(this,"fields",void 0),f(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(e)),function(e){const t={};for(const r of e)t[r.name],t[r.name]=!0}(e),this.fields=e,this.metadata=t||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...e){const t=Object.create(null);for(const r of e)t[r]=!0;e=this.fields.filter(e=>t[e.name]);return new ft(e,this.metadata)}selectAt(...e){e=e.map(e=>this.fields[e]).filter(Boolean);return new ft(e,this.metadata)}assign(e){let t,r=this.metadata;var n;e instanceof ft?(n=e,t=n.fields,r=pt(pt(new Map,this.metadata),n.metadata)):t=e;const i=Object.create(null);for(const o of this.fields)i[o.name]=o;for(const s of t)i[s.name]=s;e=Object.values(i);return new ft(e,r)}}function pt(e,t){return new Map([...e||new Map,...t||new Map])}class mt{constructor(e,t,r=!1,n=new Map){f(this,"name",void 0),f(this,"type",void 0),f(this,"nullable",void 0),f(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new mt(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}}let gt;(t=gt=gt||{})[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth";class _t{static isNull(e){return e&&e.typeId===gt.Null}static isInt(e){return e&&e.typeId===gt.Int}static isFloat(e){return e&&e.typeId===gt.Float}static isBinary(e){return e&&e.typeId===gt.Binary}static isUtf8(e){return e&&e.typeId===gt.Utf8}static isBool(e){return e&&e.typeId===gt.Bool}static isDecimal(e){return e&&e.typeId===gt.Decimal}static isDate(e){return e&&e.typeId===gt.Date}static isTime(e){return e&&e.typeId===gt.Time}static isTimestamp(e){return e&&e.typeId===gt.Timestamp}static isInterval(e){return e&&e.typeId===gt.Interval}static isList(e){return e&&e.typeId===gt.List}static isStruct(e){return e&&e.typeId===gt.Struct}static isUnion(e){return e&&e.typeId===gt.Union}static isFixedSizeBinary(e){return e&&e.typeId===gt.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===gt.FixedSizeList}static isMap(e){return e&&e.typeId===gt.Map}static isDictionary(e){return e&&e.typeId===gt.Dictionary}get typeId(){return gt.NONE}compareTo(e){return this===e}}class yt extends _t{constructor(e,t){super(),f(this,"isSigned",void 0),f(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return gt.Int}get[Symbol.toStringTag](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}class bt extends yt{constructor(){super(!0,8)}}class vt extends yt{constructor(){super(!0,16)}}class wt extends yt{constructor(){super(!0,32)}}class xt extends yt{constructor(){super(!1,8)}}class Et extends yt{constructor(){super(!1,16)}}class At extends yt{constructor(){super(!1,32)}}const Tt={HALF:16,SINGLE:32,DOUBLE:64};class St extends _t{constructor(e){super(),f(this,"precision",void 0),this.precision=e}get typeId(){return gt.Float}get[Symbol.toStringTag](){return"Float"}toString(){return`Float${this.precision}`}}class Mt extends St{constructor(){super(Tt.SINGLE)}}class Ot extends St{constructor(){super(Tt.DOUBLE)}}class Ct extends _t{constructor(e,t){super(),f(this,"listSize",void 0),f(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return gt.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Symbol.toStringTag](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}function kt(e,t,r){var n=Bt(t.metadata);const i=[];var o=function(e){const t={};for(const n in e){var r=e[n];t[r.name||"undefined"]=r}return t}(t.attributes);for(const a in e){var s=e[a],s=It(a,s,o[a]);i.push(s)}return r&&(r=It("indices",r),i.push(r)),new ft(i,n)}function It(e,t,r){var n=r?Bt(r.metadata):void 0,r=function(e){switch(e.constructor){case Int8Array:return new bt;case Uint8Array:return new xt;case Int16Array:return new vt;case Uint16Array:return new Et;case Int32Array:return new wt;case Uint32Array:return new At;case Float32Array:return new Mt;case Float64Array:return new Ot;default:throw new Error("array type not supported")}}(t.value);return new mt(e,new Ct(t.size,new mt("value",r)),!1,n)}function Bt(e){const t=new Map;for(const r in e)t.set(`${r}.string`,JSON.stringify(e[r]));return t}const Lt={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ft={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Ut{constructor(e){f(this,"draco",void 0),f(this,"decoder",void 0),f(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);t=this.decoder.GetEncodedGeometryType(n);const i=new(t===this.draco.TRIANGULAR_MESH?this.draco.Mesh:this.draco.PointCloud);try{let e;switch(t){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(n,i);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(n,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!i.ptr){var o=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(o)}var s=this._getDracoLoaderData(i,t,r),a=this._getMeshData(i,s,r),u=function(e){let t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;var a=e.POSITION?e.POSITION.value:[],u=a&&a.length;for(let e=0;e<u;e+=3){var c=a[e],l=a[e+1],d=a[e+2];t=c<t?c:t,r=l<r?l:r,n=d<n?d:n,i=c>i?c:i,o=l>o?l:o,s=d>s?d:s}return[[t,r,n],[i,o,s]]}(a.attributes),c=kt(a.attributes,s,a.indices);return{loader:"draco",loaderData:s,header:{vertexCount:i.num_points(),boundingBox:u},...a,schema:c}}finally{this.draco.destroy(n),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,t,r){var n=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:r}}_getDracoAttributes(t,r){const n={};for(let e=0;e<t.num_attributes();e++){const o=this.decoder.GetAttribute(t,e);var i=this._getAttributeMetadata(t,e);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:e,metadata:i};i=this._getQuantizationTransform(o,r);i&&(n[o.unique_id()].quantization_transform=i);i=this._getOctahedronTransform(o,r);i&&(n[o.unique_id()].octahedron_transform=i)}return n}_getMeshData(e,t,r){var n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const a of Object.values(e.attributes)){var i=this._deduceAttributeName(a,r);a.name=i;var{value:o,size:s}=this._getAttributeValues(t,a);n[i]={value:o,size:s,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}return n}_getTriangleListIndices(e){var t=3*e.num_faces(),r=4*t,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(t){const r=t.size(),n=new Int32Array(r);for(let e=0;e<r;e++)n[e]=t.GetValue(e);return n}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=Ft[t.data_type];var n=t.num_components,i=e.num_points()*n,o=i*r.BYTES_PER_ELEMENT,s=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,r);let a;var u=this.draco._malloc(o);try{var c=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,c,s,o,u),a=new r(this.draco.HEAPF32.buffer,u,i).slice()}finally{this.draco._free(u)}return{value:a,size:n}}_deduceAttributeName(e,t){var r,n,i=e.unique_id;for([r,n]of Object.entries(t.extraAttributes||{}))if(n===i)return r;var o=e.attribute_type;for(const s in Lt)if(this.draco[s]===o)return Lt[s];t=t.attributeNameEntry||"name";return e.metadata[t]?e.metadata[t].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){e=this.decoder.GetMetadata(e);return this._getDracoMetadata(e)}_getAttributeMetadata(e,t){t=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(t)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={};var n=this.metadataQuerier.NumEntries(t);for(let e=0;e<n;e++){var i=this.metadataQuerier.GetEntryName(t,e);r[i]=this._getDracoMetadataField(t,i)}return r}_getDracoMetadataField(e,t){var r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);var n=function(t){const r=t.size(),n=new Int32Array(r);for(let e=0;e<r;e++)n[e]=t.GetValue(e);return n}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){var{quantizedAttributes:t=[],octahedronAttributes:e=[]}=e;for(const r of[...t,...e])this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits(),range:n.range(),min_values:new Float32Array([1,2,3]).map(e=>n.min_value(e))}}finally{this.draco.destroy(n)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t;t=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(t)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits()}}finally{this.draco.destroy(n)}}return null}}const Pt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.js",Rt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_wasm_wrapper.js",jt="https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.wasm";let Dt;async function Nt(e){const t=e.modules||{};return Dt=t.draco3d?Dt||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Dt||async function(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await M(Pt,"draco",e);break;case"wasm":default:[t,r]=await Promise.all([await M(Rt,"draco",e),await M(jt,"draco",e)])}return t=t||globalThis.DracoDecoderModule,function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise(t=>{e({...r,onModuleLoaded:e=>t({draco:e})})})}(t,r)}(e),Dt}const Vt={...o,parse:async function(e,t){const{draco:r}=await Nt(t),n=new Ut(r);try{return n.parseSync(e,null==t?void 0:t.draco)}finally{n.destroy()}}};const Ht=["SCALAR","VEC2","VEC3","VEC4"];i=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]];const zt=new Map(i),$t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Yt(e){return Ht[e-1]||Ht[0]}function Xt(e){e=zt.get(e.constructor);if(!e)throw new Error("Illegal typed array");return e}function qt(e,t){var r=Wt[e.componentType],n=$t[e.type],i=Gt[e.componentType],o=e.count*n,i=e.count*n*i;return dt(0<=i&&i<=t.byteLength),{ArrayType:r,length:o,byteLength:i}}const Kt={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Qt{constructor(e){f(this,"gltf",void 0),f(this,"sourceBuffers",void 0),f(this,"byteLength",void 0),this.gltf=e||{json:{...Kt},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(t){var e=this.getUsedExtensions().find(e=>e===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;var r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){var t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];dt(r);t=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,t,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data;const{ArrayType:n,length:i}=qt(e,t);e=t.byteOffset+e.byteOffset;return new n(r,e,i)}getTypedArrayForImageData(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,e=t.byteOffset||0;return new Uint8Array(r,e,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{};e=r[t];return delete r[t],e}addExtension(e,t={}){return dt(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return dt(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){var{nodeIndices:e}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(e){var{meshIndex:t,matrix:e}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return e&&(r.matrix=e),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){var{attributes:t,indices:r,material:n,mode:e=4}=e;const i={primitives:[{attributes:this._addAttributes(t),mode:e}]};return r&&(r=this._addIndices(r),i.primitives[0].indices=r),Number.isFinite(n)&&(i.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addPointCloud(e){e={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(e,t){var r=ut(e),r=t||(null==r?void 0:r.mimeType),r={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){var t=e.byteLength;dt(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);e={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=L(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(e),this.json.bufferViews.length-1}addAccessor(e,t){t={bufferView:e,type:Yt(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(t),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){var r=this.addBufferView(e);let n={min:t.min,max:t.max};n.min&&n.max||(n=this._getAccessorMinMax(e,t.size));e={size:t.size,componentType:Xt(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(e,t))}addTexture(e){var{imageIndex:e}=e,e={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(e),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];var r=this.byteLength,n=new ArrayBuffer(r),i=new Uint8Array(n);let o=0;for(const s of this.sourceBuffers||[])o=function(e,t,r){let n;var i,o;return n=e instanceof ArrayBuffer?new Uint8Array(e):(i=e.byteOffset,o=e.byteLength,new Uint8Array(e.buffer||e.arrayBuffer,i,o)),t.set(n,r),r+L(n.byteLength,4)}(s,i,o);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){var n=e.indexOf(t);-1<n?e.splice(n,1):r=!1}}_addAttributes(e={}){const t={};for(const i in e){var r=e[i],n=this._getGltfAttributeName(i),r=this.addBinaryBuffer(r.value,r);t[n]=r}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(r,n){const i={min:null,max:null};if(r.length<n)return i;i.min=[],i.max=[];for(const e of r.subarray(0,n))i.min.push(e),i.max.push(e);for(let t=n;t<r.length;t+=n)for(let e=0;e<n;e++)i.min[0+e]=Math.min(i.min[0+e],r[t+e]),i.max[0+e]=Math.max(i.max[0+e],r[t+e]);return i}}const Jt="KHR_binary_glTF",Zt="KHR_draco_mesh_compression",er="KHR_lights_punctual",tr="KHR_materials_unlit",rr="KHR_techniques_webgl";function nr(e){var{buffer:t,size:r,count:e}=function(e){let t=e,r=1,n=0;e&&e.value&&(t=e.value,r=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,r=!1){if(!e)return null;if(Array.isArray(e))return new t(e);return!r||e instanceof t?e:new t(e)}(t,Float32Array)),n=t.length/r);return{buffer:t,size:r,count:n}}(e);return{value:t,size:r,byteOffset:0,count:e,type:Yt(r),componentType:Xt(t)}}const ir={KHR_draco_mesh_compression:Object.freeze({__proto__:null,decode:async function(e,t,r){var n;if(null!=t&&null!==(n=t.gltf)&&void 0!==n&&n.decompressMeshes){const i=new Qt(e),o=[];for(const s of function*(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}(i))i.getObjectExtension(s,Zt)&&o.push(async function(e,t,r,n){var i=e.getObjectExtension(t,Zt);if(i){i=e.getTypedArrayForBufferView(i.bufferView),i=B(i.buffer,i.byteOffset);const{parse:u}=n,c={...r};delete c["3d-tiles"];var o,s,a,i=await u(i,Vt,c,n),n=function(e){const t={};for(const n in e){var r=e[n];"indices"!==n&&(r=nr(r),t[n]=r)}return t}(i.attributes);for([o,s]of Object.entries(n))o in t.attributes&&(a=t.attributes[o],null!=(a=e.getAccessor(a))&&a.min&&null!=a&&a.max&&(s.min=a.min,s.max=a.max));t.attributes=n,i.indices&&(t.indices=nr(i.indices)),function(e){if(!e.attributes&&0<Object.keys(e.attributes).length)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}}(i,s,t,r));await Promise.all(o),i.removeExtension(Zt)}},encode:function(e,t=0){const r=new Qt(e);for(const n of r.json.meshes||[])!function(e,t=4,r,n){var i;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var o=r.DracoWriter.encodeSync({attributes:e}),e=null==n||null===(i=n.parseSync)||void 0===i?void 0:i.call(n,{attributes:e}),e=r._addFauxAttributes(e.attributes),o=r.addBufferView(o),e={primitives:[{attributes:e,mode:t,extensions:{[Zt]:{bufferView:o,attributes:e}}}]}}(n),r.addRequiredExtension(Zt)}}),KHR_materials_unlit:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:e}=t;t.removeExtension(tr);for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,tr)},encode:function(e){const t=new Qt(e);var{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,tr,{}),t.addExtension(tr))}}),KHR_lights_punctual:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;(e=t.getExtension(er))&&(t.json.lights=e.lights,t.removeExtension(er));for(const i of r.nodes||[]){var n=t.getObjectExtension(i,er);n&&(i.light=n.light),t.removeObjectExtension(i,er)}},encode:async function(e){const t=new Qt(e),{json:r}=t;if(r.lights){const i=t.addExtension(er);dt(!i.lights),i.lights=r.lights,delete r.lights}if(t.json.lights){for(const o of t.json.lights){var n=o.node;t.addObjectExtension(n,er,o)}delete t.json.lights}}}),KHR_techniques_webgl:Object.freeze({__proto__:null,decode:async function(e){const t=new Qt(e);var{json:r}=t;if(e=t.getExtension(rr)){var n=function(e,t){const{programs:r=[],shaders:n=[],techniques:i=[]}=e,o=new TextDecoder;return n.forEach(e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=o.decode(t.getTypedArrayForBufferView(e.bufferView))}),r.forEach(e=>{e.fragmentShader=n[e.fragmentShader],e.vertexShader=n[e.vertexShader]}),i.forEach(e=>{e.program=r[e.program]}),i}(e,t);for(const o of r.materials||[]){var i=t.getObjectExtension(o,rr);i&&(o.technique=Object.assign({},i,n[i.technique]),o.technique.values=function(t,r){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(e=>{!t.uniforms[e].value||e in n||(n[e]=t.uniforms[e].value)}),Object.keys(n).forEach(e=>{"object"==typeof n[e]&&void 0!==n[e].index&&(n[e].texture=r.getTexture(n[e].index))}),n}(o.technique,t)),t.removeObjectExtension(o,rr)}t.removeExtension(rr)}},encode:async function(e,t){}})};const or={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},sr={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class ar{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(e,t){this.json=e.json;var r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e){const t=new Qt(e),{json:r}=t;for(const i of r.images||[]){var n=t.removeObjectExtension(i,Jt);n&&Object.assign(i,n)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(Jt)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in or)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){var r=e[t];if(r&&!Array.isArray(r)){e[t]=[];for(const i in r){const o=r[i];o.id=o.id||i;var n=e[t].length;e[t].push(o),this.idToIndexMap[t][i]=n}}}_convertObjectIdsToArrayIndices(e){for(const t in or)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const n of e.meshes)this._convertMeshIds(n);for(const i of e.nodes)this._convertNodeIds(i);for(const o of e.scenes)this._convertSceneIds(o)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:i}=t;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(e=>this._convertIdToIndex(e,"node"))),e.meshes&&(e.meshes=e.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(e,t){e[t]||(e[t]=[]);for(const n of e[t])for(const i in n){var r=n[i],r=this._convertIdToIndex(r,i);n[i]=r}}_convertIdToIndex(e,t){var r=sr[t];if(r in this.idToIndexMap){r=this.idToIndexMap[r][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values&&r.values.tex;var t=e.textures.findIndex(e=>e.id===n);-1!==t&&(r.pbrMetallicRoughness.baseColorTexture={index:t})}}}const ur={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cr={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};t={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986};const lr={magFilter:t.TEXTURE_MAG_FILTER,minFilter:t.TEXTURE_MIN_FILTER,wrapS:t.TEXTURE_WRAP_S,wrapT:t.TEXTURE_WRAP_T},dr={[t.TEXTURE_MAG_FILTER]:t.LINEAR,[t.TEXTURE_MIN_FILTER]:t.NEAREST_MIPMAP_LINEAR,[t.TEXTURE_WRAP_S]:t.REPEAT,[t.TEXTURE_WRAP_]:t.REPEAT};class hr{postProcess(e,t={}){var{json:r,buffers:n=[],images:i=[],baseUri:e=""}=e;return dt(r),this.baseUri=e,this.json=r,this.buffers=n,this.images=i,this._resolveTree(this.json,t),this.json}_resolveTree(e,t=0){e.bufferViews&&(e.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(e.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(e.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(e.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(e.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(e.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(e.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(e.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t))),e.skins&&(e.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(e.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return"object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map(e=>this.getNode(e)),e}_resolveNode(e,t){return e.id=e.id||`node-${t}`,e.children&&(e.children=e.children.map(e=>this.getNode(e))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce((e,t)=>{t=this.getMesh(t);return e.id=t.id,e.primitives=e.primitives.concat(t.primitives),e},{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||`skin-${t}`,e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||`mesh-${t}`,e.primitives&&(e.primitives=e.primitives.map(e=>{var t=(e={...e}).attributes;e.attributes={};for(const r in t)e.attributes[r]=this.getAccessor(t[r]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e})),e}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(t=e.componentType,cr[t]),e.components=(t=e.type,ur[t]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:i}=qt(e,e.bufferView);t=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset,t=r.arrayBuffer.slice(t,t+i);e.value=new n(t)}return e}_resolveTexture(e,t){return e.id=e.id||`texture-${t}`,e.sampler="sampler"in e?this.getSampler(e.sampler):dr,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const n in e){var r=this._enumSamplerParameter(n);void 0!==r&&(e.parameters[r]=e[n])}return e}_enumSamplerParameter(e){return lr[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));t=this.images[t];return t&&(e.image=t),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;var r=e.buffer;e.buffer=this.buffers[r];t=this.buffers[r].arrayBuffer;let n=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(n+=e.byteOffset),e.data=new Uint8Array(t,n,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e.perspective,e.orthographic,e}}const fr=1735152710,pr=12,mr=8,gr=1313821514,_r=5130562,yr=0,br=1,vr=0,wr=!0;function xr(e,t,r=0){const n=new DataView(t);var i,o,s,a,t=(u=n,c=r+0,`\
${String.fromCharCode(u.getUint8(c+0))}\
${String.fromCharCode(u.getUint8(c+1))}\
${String.fromCharCode(u.getUint8(c+2))}\
${String.fromCharCode(u.getUint8(c+3))}`),u=n.getUint32(r+4,wr),c=n.getUint32(r+8,wr);switch(Object.assign(e,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:t,version:u,json:{},binChunks:[]}),r+=pr,e.version){case 1:return function(e,t,r){l(e.header.byteLength>pr+mr);var n=t.getUint32(r+0,wr),i=t.getUint32(r+4,wr);return r+=mr,l(i===vr),Er(e,t,r,n),r+=n,r+=Ar(e,t,r,e.header.byteLength)}(e,n,r);case 2:return i=e,o=n,s=r,a={},l(i.header.byteLength>pr+mr),function(e,t,r,n){for(;r+8<=e.header.byteLength;){var i=t.getUint32(r+0,wr),o=t.getUint32(r+4,wr);switch(r+=mr,o){case gr:Er(e,t,r,i);break;case _r:Ar(e,t,r,i);break;case yr:n.strict||Er(e,t,r,i);break;case br:n.strict||Ar(e,t,r,i)}r+=L(i,4)}}(i,o,s,a),s+i.header.byteLength;default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}function Er(e,t,r,n){r=new Uint8Array(t.buffer,r,n);const i=new TextDecoder("utf8");r=i.decode(r);return e.json=JSON.parse(r),L(n,4)}function Ar(e,t,r,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),L(n,4)}async function Tr(e,t,r=0,n,i){var o,s,a,u;!function(e,t,r,n){n.uri&&(e.baseUri=n.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,r={}){const n=new DataView(e);var{magic:r=fr}=r;return(t=n.getUint32(t,!1))===r||t===fr}(t,r,n)){const s=new TextDecoder;t=s.decode(t)}"string"==typeof t?e.json=k(t):t instanceof ArrayBuffer?(r=xr(i={},t,r,n.glb),dt("glTF"===i.type,`Invalid GLB magic string ${i.type}`),e._glb=i,e.json=i.json):dt(!1,"GLTF: must be ArrayBuffer or string");var i=e.json.buffers||[];e.buffers=new Array(i.length).fill(null),e._glb&&e._glb.header.hasBinChunk&&({binChunks:o}=e._glb,e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength});var o=e.json.images||[];e.images=new Array(o.length).fill({})}(e,t,r,n),r=e,a={normalize:null==n||null===(a=n.gltf)||void 0===a?void 0:a.normalize},(new ar).normalize(r,a);const c=[];if(null!=n&&null!==(o=n.gltf)&&void 0!==o&&o.loadBuffers&&e.json.buffers&&await async function(t,r,n){for(let e=0;e<t.json.buffers.length;++e){const a=t.json.buffers[e];var i,o,s;a.uri&&({fetch:s}=n,dt(s),s=ht(a.uri,r),s=await(null==n||null===(i=n.fetch)||void 0===i?void 0:i.call(n,s)),s=await(null==s||null===(o=s.arrayBuffer)||void 0===o?void 0:o.call(s)),t.buffers[e]={arrayBuffer:s,byteOffset:0,byteLength:s.byteLength},delete a.uri)}}(e,n,i),null!=n&&null!==(s=n.gltf)&&void 0!==s&&s.loadImages){const l=async function(t,r,n){const i=t.json.images||[],o=[];for(let e=0;e<i.length;++e)o.push(async function(e,t,r,n,i){const{fetch:o,parse:s}=i;let a;if(t.uri){n=ht(t.uri,n);const u=await o(n);a=await u.arrayBuffer()}Number.isFinite(t.bufferView)&&(t=function(e,t,r){return dt(e=e.bufferViews[r]),dt(r=t[e.buffer]),t=(e.byteOffset||0)+r.byteOffset,new Uint8Array(r.arrayBuffer,t,e.byteLength)}(e.json,e.buffers,t.bufferView),a=B(t.buffer,t.byteOffset,t.byteLength));dt(a,"glTF image has no data");i=await s(a,lt,{},i);e.images[r]=i}(t,i[e],e,r,n));return Promise.all(o)}(e,n,i);c.push(l)}const l=async function(e,t={},r){for(const o in ir){var n,i=(null==t||null===(n=t.gltf)||void 0===n?void 0:n.excludeExtensions)||{};if(!(o in i&&!i[o])){const s=ir[o];await s.decode(e,t,r)}}}(e,n,i);return c.push(l),await Promise.all(c),null!=n&&null!==(u=n.gltf)&&void 0!==u&&u.postProcess?(u=e,n=n,(new hr).postProcess(u,n)):e}const Sr={name:"glTF",id:"gltf",module:"gltf",version:"3.0.11",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},r){(t={...Sr.options,...t}).gltf={...Sr.options.gltf,...t.gltf};var{byteOffset:n=0}=t;return Tr({},e,n,t,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};var Mr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Or={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Cr(e){var t,r,n,i,o,s,a=[],u=1;return"string"==typeof e?Mr[e]?(a=Mr[e].slice(),o="rgb"):"transparent"===e?(o="rgb",a=[u=0,0,0]):/^#[A-Fa-f0-9]+$/.test(e)?(i=e.slice(1),u=1,(s=i.length)<=4?(a=[parseInt(i[0]+i[0],16),parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16)],4===s&&(u=parseInt(i[3]+i[3],16)/255)):(a=[parseInt(i[0]+i[1],16),parseInt(i[2]+i[3],16),parseInt(i[4]+i[5],16)],8===s&&(u=parseInt(i[6]+i[7],16)/255)),a[0]||(a[0]=0),a[1]||(a[1]=0),a[2]||(a[2]=0),o="rgb"):(t=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(e))?(n="rgb"===(r=t[1]),o=i=r.replace(/a$/,""),s="cmyk"===i?4:"gray"===i?1:3,a=t[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(e,t){if(/%$/.test(e))return t===s?parseFloat(e)/100:"rgb"===i?255*parseFloat(e)/100:parseFloat(e);if("h"===i[t]){if(/deg$/.test(e))return parseFloat(e);if(void 0!==Or[e])return Or[e]}return parseFloat(e)}),r===i&&a.push(1),u=n||void 0===a[s]?1:a[s],a=a.slice(0,s)):10<e.length&&/[0-9](?:\s|\/)/.test(e)&&(a=e.match(/([0-9]+)/g).map(function(e){return parseFloat(e)}),o=e.match(/([a-z])/gi).join("").toLowerCase()):isNaN(e)?Array.isArray(e)||e.length?(a=[e[0],e[1],e[2]],o="rgb",u=4===e.length?e[3]:1):e instanceof Object&&(a=null!=e.r||null!=e.red||null!=e.R?(o="rgb",[e.r||e.red||e.R||0,e.g||e.green||e.G||0,e.b||e.blue||e.B||0]):(o="hsl",[e.h||e.hue||e.H||0,e.s||e.saturation||e.S||0,e.l||e.lightness||e.L||e.b||e.brightness]),u=e.a||e.alpha||e.opacity||1,null!=e.opacity&&(u/=100)):(o="rgb",a=[e>>>16,(65280&e)>>>8,255&e]),{space:o,values:a,alpha:u}}function kr(e,t){var r=e.__state.conversionName.toString(),n=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),s=e.a,a=Math.round(e.h),u=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===r||"SIX_CHAR_HEX"===r){for(var l=e.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===r?"rgb("+n+","+i+","+o+")":"CSS_RGBA"===r?"rgba("+n+","+i+","+o+","+s+")":"HEX"===r?"0x"+e.hex.toString(16):"RGB_ARRAY"===r?"["+n+","+i+","+o+"]":"RGBA_ARRAY"===r?"["+n+","+i+","+o+","+s+"]":"RGB_OBJ"===r?"{r:"+n+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===r?"{r:"+n+",g:"+i+",b:"+o+",a:"+s+"}":"HSV_OBJ"===r?"{h:"+a+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===r?"{h:"+a+",s:"+u+",v:"+c+",a:"+s+"}":"unknown format"}var Ir,Br=Array.prototype.forEach,Lr=Array.prototype.slice,Fr={BREAK:{},extend:function(r){return this.each(Lr.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(r[e]=t[e])}.bind(this))},this),r},defaults:function(r){return this.each(Lr.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(r[e])&&(r[e]=t[e])}.bind(this))},this),r},compose:function(){var r=Lr.call(arguments);return function(){for(var e=Lr.call(arguments),t=r.length-1;0<=t;t--)e=[r[t].apply(this,e)];return e[0]}},each:function(e,t,r){if(e)if(Br&&e.forEach&&e.forEach===Br)e.forEach(t,r);else if(e.length===e.length+0){for(var n=void 0,n=0,i=e.length;n<i;n++)if(n in e&&t.call(r,e[n],n)===this.BREAK)return}else for(var o in e)if(t.call(r,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(n,i,o){var s=void 0;return function(){var e=this,t=arguments;var r=o||!s;clearTimeout(s),s=setTimeout(function(){s=null,o||n.apply(e,t)},i),r&&n.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():Lr.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Ir=function(e){return isNaN(e)},Ur.toString=function(){return Ir.toString()},Ur),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}};function Ur(e){return Ir.apply(this,arguments)}var Pr,Rr=[{litmus:Fr.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:kr},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:kr},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:kr},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:kr}}},{litmus:Fr.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Fr.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Fr.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Fr.isNumber(e.r)&&Fr.isNumber(e.g)&&Fr.isNumber(e.b)&&Fr.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Fr.isNumber(e.r)&&Fr.isNumber(e.g)&&Fr.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Fr.isNumber(e.h)&&Fr.isNumber(e.s)&&Fr.isNumber(e.v)&&Fr.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Fr.isNumber(e.h)&&Fr.isNumber(e.s)&&Fr.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],jr=void 0,Dr=void 0,Nr=function(){Dr=!1;var r=1<arguments.length?Fr.toArray(arguments):arguments[0];return Fr.each(Rr,function(e){if(e.litmus(r))return Fr.each(e.conversions,function(e,t){if(jr=e.read(r),!1===Dr&&!1!==jr)return(Dr=jr).conversionName=t,jr.conversion=e,Fr.BREAK}),Fr.BREAK}),Dr},Vr={hsv_to_rgb:function(e,t,r){var n=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=r*(1-t),e=r*(1-i*t),t=r*(1-(1-i)*t),n=[[r,t,o],[e,r,o],[o,r,t],[o,e,r],[t,o,r],[r,o,e]][n];return{r:255*n[0],g:255*n[1],b:255*n[2]}},rgb_to_hsv:function(e,t,r){var n=Math.min(e,t,r),i=Math.max(e,t,r),o=i-n,n=void 0;return 0===i?{h:NaN,s:0,v:0}:(n=e===i?(t-r)/o:t===i?2+(r-e)/o:4+(e-t)/o,(n/=6)<0&&(n+=1),{h:360*n,s:o/i,v:i/255})},rgb_to_hex:function(e,t,r){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(Pr=8*t)|e&~(255<<Pr)}},Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zr=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(e,t,r){return t&&$r(e.prototype,t),r&&$r(e,r),e};function $r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gr(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0!==n){if("value"in n)return n.value;n=n.get;return void 0!==n?n.call(r):void 0}if(null!==(e=Object.getPrototypeOf(e)))return Gr(e,t,r)}var i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Wr=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Yr=(o(Xr,[{key:"toString",value:function(){return kr(this)}},{key:"toHexString",value:function(){return kr(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),Xr);function Xr(){if(zr(this,Xr),this.__state=Nr.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function qr(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Yr.recalculateRGB(this,t,r),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Yr.recalculateRGB(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function Kr(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Yr.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Yr.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Yr.recalculateRGB=function(e,t,r){if("HEX"===e.__state.space)e.__state[t]=Vr.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Fr.extend(e.__state,Vr.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Yr.recalculateHSV=function(e){var t=Vr.rgb_to_hsv(e.r,e.g,e.b);Fr.extend(e.__state,{s:t.s,v:t.v}),Fr.isNaN(t.h)?Fr.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Yr.COMPONENTS=["r","g","b","h","s","v","hex","a"],qr(Yr.prototype,"r",2),qr(Yr.prototype,"g",1),qr(Yr.prototype,"b",0),Kr(Yr.prototype,"h"),Kr(Yr.prototype,"s"),Kr(Yr.prototype,"v"),Object.defineProperty(Yr.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Yr.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=Vr.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Qr=(o(Jr,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),Jr);function Jr(e,t){zr(this,Jr),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var Zr={};Fr.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){Fr.each(e,function(e){Zr[e]=t})});var en=/(\d+(\.\d+)?)px/;function tn(e){if("0"===e||Fr.isUndefined(e))return 0;e=e.match(en);return Fr.isNull(e)?0:parseFloat(e[1])}var rn={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){Fr.isUndefined(t)&&(t=!0),Fr.isUndefined(r)&&(r=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,n){var i=r||{},r=Zr[t];if(!r)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(r);switch(r){case"MouseEvents":var s=i.x||i.clientX||0,a=i.y||i.clientY||0;o.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,a,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":a=o.initKeyboardEvent||o.initKeyEvent;Fr.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),a(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:o.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Fr.defaults(o,n),e.dispatchEvent(o)},bind:function(e,t,r,n){return e.addEventListener?e.addEventListener(t,r,n||!1):e.attachEvent&&e.attachEvent("on"+t,r),rn},unbind:function(e,t,r,n){return e.removeEventListener?e.removeEventListener(t,r,n||!1):e.detachEvent&&e.detachEvent("on"+t,r),rn},addClass:function(e,t){var r;return void 0===e.className?e.className=t:e.className===t||-1===(r=e.className.split(/ +/)).indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),rn},removeClass:function(e,t){var r;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(r=e.className.split(/ +/)).indexOf(t))&&(r.splice(t,1),e.className=r.join(" ")):e.className=void 0,rn},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return tn(e["border-left-width"])+tn(e["border-right-width"])+tn(e["padding-left"])+tn(e["padding-right"])+tn(e.width)},getHeight:function(e){e=getComputedStyle(e);return tn(e["border-top-width"])+tn(e["border-bottom-width"])+tn(e["padding-top"])+tn(e["padding-bottom"])+tn(e.height)},getOffset:function(e){var t=e,r={left:0,top:0};if(t.offsetParent)for(;r.left+=t.offsetLeft,r.top+=t.offsetTop,t=t.offsetParent;);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},nn=(i(on,Qr),o(on,[{key:"setValue",value:function(e){e=Gr(on.prototype.__proto__||Object.getPrototypeOf(on.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Gr(on.prototype.__proto__||Object.getPrototypeOf(on.prototype),"updateDisplay",this).call(this)}}]),on);function on(e,t){zr(this,on);var t=Wr(this,(on.__proto__||Object.getPrototypeOf(on)).call(this,e,t)),r=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),rn.bind(t.__checkbox,"change",function(){r.setValue(!r.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var sn=(i(an,Qr),o(an,[{key:"setValue",value:function(e){e=Gr(an.prototype.__proto__||Object.getPrototypeOf(an.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return rn.isActive(this.__select)?this:(this.__select.value=this.getValue(),Gr(an.prototype.__proto__||Object.getPrototypeOf(an.prototype),"updateDisplay",this).call(this))}}]),an);function an(e,t,r){zr(this,an);var n,t=Wr(this,(an.__proto__||Object.getPrototypeOf(an)).call(this,e,t)),r=r,i=t;return t.__select=document.createElement("select"),Fr.isArray(r)&&(n={},Fr.each(r,function(e){n[e]=e}),r=n),Fr.each(r,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),i.__select.appendChild(r)}),t.updateDisplay(),rn.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var un=(i(cn,Qr),o(cn,[{key:"updateDisplay",value:function(){return rn.isActive(this.__input)||(this.__input.value=this.getValue()),Gr(cn.prototype.__proto__||Object.getPrototypeOf(cn.prototype),"updateDisplay",this).call(this)}}]),cn);function cn(e,t){zr(this,cn);var t=Wr(this,(cn.__proto__||Object.getPrototypeOf(cn)).call(this,e,t)),r=t;function n(){r.setValue(r.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),rn.bind(t.__input,"keyup",n),rn.bind(t.__input,"change",n),rn.bind(t.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),rn.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function ln(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}i(dn,Qr),o(dn,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Gr(dn.prototype.__proto__||Object.getPrototypeOf(dn.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=ln(e),this}}]),t=dn;function dn(e,t,r){zr(this,dn);t=Wr(this,(dn.__proto__||Object.getPrototypeOf(dn)).call(this,e,t)),r=r||{};return t.__min=r.min,t.__max=r.max,t.__step=r.step,Fr.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=ln(t.__impliedStep),t}var hn=(i(fn,t),o(fn,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Gr(fn.prototype.__proto__||Object.getPrototypeOf(fn.prototype),"updateDisplay",this).call(this)}}]),fn);function fn(e,t,r){zr(this,fn);r=Wr(this,(fn.__proto__||Object.getPrototypeOf(fn)).call(this,e,t,r));r.__truncationSuspended=!1;var n=r,i=void 0;function o(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function s(e){var t=i-e.clientY;n.setValue(n.getValue()+t*n.__impliedStep),i=e.clientY}function a(){rn.unbind(window,"mousemove",s),rn.unbind(window,"mouseup",a),o()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),rn.bind(r.__input,"change",function(){var e=parseFloat(n.__input.value);Fr.isNaN(e)||n.setValue(e)}),rn.bind(r.__input,"blur",function(){o()}),rn.bind(r.__input,"mousedown",function(e){rn.bind(window,"mousemove",s),rn.bind(window,"mouseup",a),i=e.clientY}),rn.bind(r.__input,"keydown",function(e){13===e.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,o())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}function pn(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}var mn=(i(gn,t),o(gn,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Gr(gn.prototype.__proto__||Object.getPrototypeOf(gn.prototype),"updateDisplay",this).call(this)}}]),gn);function gn(e,t,r,n,i){zr(this,gn);var i=Wr(this,(gn.__proto__||Object.getPrototypeOf(gn)).call(this,e,t,{min:r,max:n,step:i})),o=i;function s(e){e.preventDefault();var t=o.__background.getBoundingClientRect();return o.setValue(pn(e.clientX,t.left,t.right,o.__min,o.__max)),!1}function a(){rn.unbind(window,"mousemove",s),rn.unbind(window,"mouseup",a),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function u(e){var t=e.touches[0].clientX,e=o.__background.getBoundingClientRect();o.setValue(pn(t,e.left,e.right,o.__min,o.__max))}function c(){rn.unbind(window,"touchmove",u),rn.unbind(window,"touchend",c),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),rn.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),rn.bind(window,"mousemove",s),rn.bind(window,"mouseup",a),s(e)}),rn.bind(i.__background,"touchstart",function(e){1===e.touches.length&&(rn.bind(window,"touchmove",u),rn.bind(window,"touchend",c),u(e))}),rn.addClass(i.__background,"slider"),rn.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var _n=(i(yn,Qr),o(yn,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),yn);function yn(e,t,r){zr(this,yn);var t=Wr(this,(yn.__proto__||Object.getPrototypeOf(yn)).call(this,e,t)),n=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===r?"Fire":r,rn.bind(t.__button,"click",function(e){return e.preventDefault(),n.fire(),!1}),rn.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var bn=(i(vn,Qr),o(vn,[{key:"updateDisplay",value:function(){var t,r=Nr(this.getValue());!1!==r&&(t=!1,Fr.each(Yr.COMPONENTS,function(e){if(!Fr.isUndefined(r[e])&&!Fr.isUndefined(this.__color.__state[e])&&r[e]!==this.__color.__state[e])return t=!0,{}},this),t&&Fr.extend(this.__color.__state,r)),Fr.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,n=255-e;Fr.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,xn(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Fr.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),vn);function vn(e,t){zr(this,vn);var r=Wr(this,(vn.__proto__||Object.getPrototypeOf(vn)).call(this,e,t));r.__color=new Yr(r.getValue()),r.__temp=new Yr(0);var n=r;r.domElement=document.createElement("div"),rn.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",rn.bind(r.__input,"keydown",function(e){13===e.keyCode&&u.call(this)}),rn.bind(r.__input,"blur",u),rn.bind(r.__selector,"mousedown",function(){rn.addClass(this,"drag").bind(window,"mouseup",function(){rn.removeClass(n.__selector,"drag")})}),rn.bind(r.__selector,"touchstart",function(){rn.addClass(this,"drag").bind(window,"touchend",function(){rn.removeClass(n.__selector,"drag")})});e=document.createElement("div");function i(e){l(e),rn.bind(window,"mousemove",l),rn.bind(window,"touchmove",l),rn.bind(window,"mouseup",s),rn.bind(window,"touchend",s)}function o(e){d(e),rn.bind(window,"mousemove",d),rn.bind(window,"touchmove",d),rn.bind(window,"mouseup",a),rn.bind(window,"touchend",a)}function s(){rn.unbind(window,"mousemove",l),rn.unbind(window,"touchmove",l),rn.unbind(window,"mouseup",s),rn.unbind(window,"touchend",s),c()}function a(){rn.unbind(window,"mousemove",d),rn.unbind(window,"touchmove",d),rn.unbind(window,"mouseup",a),rn.unbind(window,"touchend",a),c()}function u(){var e=Nr(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function c(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function l(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),r=e.touches&&e.touches[0]||e,e=r.clientX,r=r.clientY,e=(e-t.left)/(t.right-t.left),t=1-(r-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),n.__color.v=t,n.__color.s=e,n.setValue(n.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),n.__color.h=360*t,n.setValue(n.__color.toOriginal()),!1}return Fr.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Fr.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Fr.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Fr.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Fr.extend(e.style,{width:"100%",height:"100%",background:"none"}),xn(e,"top","rgba(0,0,0,0)","#000"),Fr.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=r.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Fr.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),rn.bind(r.__saturation_field,"mousedown",i),rn.bind(r.__saturation_field,"touchstart",i),rn.bind(r.__field_knob,"mousedown",i),rn.bind(r.__field_knob,"touchstart",i),rn.bind(r.__hue_field,"mousedown",o),rn.bind(r.__hue_field,"touchstart",o),r.__saturation_field.appendChild(e),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}var wn=["-moz-","-o-","-webkit-","-ms-",""];function xn(t,r,n,i){t.style.background="",Fr.each(wn,function(e){t.style.cssText+="background: "+e+"linear-gradient("+r+", "+n+" 0%, "+i+" 100%); "})}var i=function(e,t){var r=t||document,t=document.createElement("style");t.type="text/css",t.innerHTML=e;r=r.getElementsByTagName("head")[0];try{r.appendChild(t)}catch(e){}},En=function(e,t){var r=e[t];return Fr.isArray(arguments[2])||Fr.isObject(arguments[2])?new sn(e,t,arguments[2]):Fr.isNumber(r)?Fr.isNumber(arguments[2])&&Fr.isNumber(arguments[3])?Fr.isNumber(arguments[4])?new mn(e,t,arguments[2],arguments[3],arguments[4]):new mn(e,t,arguments[2],arguments[3]):Fr.isNumber(arguments[4])?new hn(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new hn(e,t,{min:arguments[2],max:arguments[3]}):Fr.isString(r)?new un(e,t):Fr.isFunction(r)?new _n(e,t,""):Fr.isBoolean(r)?new nn(e,t):null};var An=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Tn=(o(Sn,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Fr.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",rn.unbind(t.domElement,"webkitTransitionEnd",e),rn.unbind(t.domElement,"transitionend",e),rn.unbind(t.domElement,"oTransitionEnd",e)}var t=this;rn.bind(this.domElement,"webkitTransitionEnd",e),rn.bind(this.domElement,"transitionend",e),rn.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-rn.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-rn.getHeight(this.domElement)/2+"px"}}]),Sn);function Sn(){zr(this,Sn),this.backgroundElement=document.createElement("div"),Fr.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),rn.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Fr.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;rn.bind(this.backgroundElement,"click",function(){e.hide()})}i(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Mn="Default",On=function(){try{return!!window.localStorage}catch(e){return!1}}(),Cn=void 0,kn=!0,In=void 0,Bn=!1,Ln=[],Fn=function t(e){var r=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),rn.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=Fr.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=Fr.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),Fr.isUndefined(n.load)?n.load={preset:Mn}:n.preset&&(n.load.preset=n.preset),Fr.isUndefined(n.parent)&&n.hideable&&Ln.push(this),n.resizable=Fr.isUndefined(n.parent)&&n.resizable,n.autoPlace&&Fr.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,o,s,a,u=On&&"true"===localStorage.getItem(Nn(0,"isLocal")),c=void 0,l=void 0;function d(e){return e.preventDefault(),o.width+=s-e.clientX,o.onResize(),s=e.clientX,!1}function h(){rn.removeClass(o.__closeButton,Fn.CLASS_DRAG),rn.unbind(window,"mousemove",d),rn.unbind(window,"mouseup",h)}function f(e){return e.preventDefault(),s=e.clientX,rn.addClass(o.__closeButton,Fn.CLASS_DRAG),rn.bind(window,"mousemove",d),rn.bind(window,"mouseup",h),!1}Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return(r.parent?r.getRoot():n.load).preset},set:function(e){r.parent?r.getRoot().preset=e:n.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),r.revert()}},width:{get:function(){return n.width},set:function(e){n.width=e,zn(r,e)}},name:{get:function(){return n.name},set:function(e){n.name=e,l&&(l.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?rn.addClass(r.__ul,t.CLASS_CLOSED):rn.removeClass(r.__ul,t.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return u},set:function(e){On&&((u=e)?rn.bind(window,"unload",c):rn.unbind(window,"unload",c),localStorage.setItem(Nn(0,"isLocal"),e))}}}),Fr.isUndefined(n.parent)?(this.closed=n.closed||!1,rn.addClass(this.domElement,t.CLASS_MAIN),rn.makeSelectable(this.domElement,!1),On&&u&&(r.useLocalStorage=!0,(i=localStorage.getItem(Nn(0,"gui")))&&(n.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,rn.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(rn.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(rn.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),rn.bind(this.__closeButton,"click",function(){r.closed=!r.closed})):(void 0===n.closed&&(n.closed=!0),i=document.createTextNode(n.name),rn.addClass(i,"controller-name"),l=Un(r,i),rn.addClass(this.__ul,t.CLASS_CLOSED),rn.addClass(l,"title"),rn.bind(l,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),n.closed||(this.closed=!1)),n.autoPlace&&(Fr.isUndefined(n.parent)&&(kn&&(In=document.createElement("div"),rn.addClass(In,"dg"),rn.addClass(In,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(In),kn=!1),In.appendChild(this.domElement),rn.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||zn(r,n.width)),this.__resizeHandler=function(){r.onResizeDebounced()},rn.bind(window,"resize",this.__resizeHandler),rn.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),rn.bind(this.__ul,"transitionend",this.__resizeHandler),rn.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&(s=void 0,(o=this).__resize_handle=document.createElement("div"),Fr.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),rn.bind(o.__resize_handle,"mousedown",f),rn.bind(o.__closeButton,"mousedown",f),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)),c=function(){On&&"true"===localStorage.getItem(Nn(0,"isLocal"))&&localStorage.setItem(Nn(0,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=c,n.parent||((a=r.getRoot()).width+=1,Fr.defer(function(){--a.width}))};function Un(e,t,r){var n=document.createElement("li");return t&&n.appendChild(t),r?e.__ul.insertBefore(n,r):e.__ul.appendChild(n),e.onResize(),n}function Pn(e){rn.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&rn.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Rn(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function jn(e,t){var r=e.getRoot(),n=r.__rememberedObjects.indexOf(t.object);if(-1!==n){var i=r.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(r.__rememberedObjectIndecesToControllers[n]=i={}),i[t.property]=t,r.load&&r.load.remembered){i=r.load.remembered,r=void 0;if(i[e.preset])r=i[e.preset];else{if(!i[Mn])return;r=i[Mn]}r[n]&&void 0!==r[n][t.property]&&(n=r[n][t.property],t.initialValue=n,t.setValue(n))}}}function Dn(e,t,r,n){if(void 0===t[r])throw new Error('Object "'+t+'" has no property "'+r+'"');var i=void 0;i=n.color?new bn(t,r):(o=[t,r].concat(n.factoryArgs),En.apply(e,o)),n.before instanceof Qr&&(n.before=n.before.__li),jn(e,i),rn.addClass(i.domElement,"c");r=document.createElement("span");rn.addClass(r,"property-name"),r.innerHTML=i.property;var o=document.createElement("div");o.appendChild(r),o.appendChild(i.domElement);var s,a,u,c,n=Un(e,o,n.before);return rn.addClass(n,Fn.CLASS_CONTROLLER_ROW),i instanceof bn?rn.addClass(n,"color"):rn.addClass(n,Hr(i.getValue())),s=e,a=n,(u=i).__li=a,u.__gui=s,Fr.extend(u,{options:function(e){if(1<arguments.length){var t=u.__li.nextElementSibling;return u.remove(),Dn(s,u.object,u.property,{before:t,factoryArgs:[Fr.toArray(arguments)]})}if(Fr.isArray(e)||Fr.isObject(e)){t=u.__li.nextElementSibling;return u.remove(),Dn(s,u.object,u.property,{before:t,factoryArgs:[e]})}},name:function(e){return u.__li.firstElementChild.firstElementChild.innerHTML=e,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof mn?(c=new hn(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step}),Fr.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=u[e],r=c[e];u[e]=c[e]=function(){var e=Array.prototype.slice.call(arguments);return r.apply(c,e),t.apply(u,e)}}),rn.addClass(a,"has-slider"),u.domElement.insertBefore(c.domElement,u.domElement.firstElementChild)):u instanceof hn?(n=function(e){if(Fr.isNumber(u.__min)&&Fr.isNumber(u.__max)){var t=u.__li.firstElementChild.firstElementChild.innerHTML,r=-1<u.__gui.__listening.indexOf(u);u.remove();var n=Dn(s,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]});return n.name(t),r&&n.listen(),n}return e},u.min=Fr.compose(n,u.min),u.max=Fr.compose(n,u.max)):u instanceof nn?(rn.bind(a,"click",function(){rn.fakeEvent(u.__checkbox,"click")}),rn.bind(u.__checkbox,"click",function(e){e.stopPropagation()})):u instanceof _n?(rn.bind(a,"click",function(){rn.fakeEvent(u.__button,"click")}),rn.bind(a,"mouseover",function(){rn.addClass(u.__button,"hover")}),rn.bind(a,"mouseout",function(){rn.removeClass(u.__button,"hover")})):u instanceof bn&&(rn.addClass(a,"color"),u.updateDisplay=Fr.compose(function(e){return a.style.borderLeftColor=u.__color.toString(),e},u.updateDisplay),u.updateDisplay()),u.setValue=Fr.compose(function(e){return s.getRoot().__preset_select&&u.isModified()&&Rn(s.getRoot(),!0),e},u.setValue),e.__controllers.push(i),i}function Nn(e,t){return document.location.href+"."+t}function Vn(e,t,r){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Hn(e,t){t.style.display=e.useLocalStorage?"block":"none"}function zn(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function $n(i,o){var s={};return Fr.each(i.__rememberedObjects,function(e,t){var r={},n=i.__rememberedObjectIndecesToControllers[t];Fr.each(n,function(e,t){r[t]=o?e.initialValue:e.getValue()}),s[t]=r}),s}Fn.toggleHide=function(){Bn=!Bn,Fr.each(Ln,function(e){e.domElement.style.display=Bn?"none":""})},Fn.CLASS_AUTO_PLACE="a",Fn.CLASS_AUTO_PLACE_CONTAINER="ac",Fn.CLASS_MAIN="main",Fn.CLASS_CONTROLLER_ROW="cr",Fn.CLASS_TOO_TALL="taller-than-window",Fn.CLASS_CLOSED="closed",Fn.CLASS_CLOSE_BUTTON="close-button",Fn.CLASS_CLOSE_TOP="close-top",Fn.CLASS_CLOSE_BOTTOM="close-bottom",Fn.CLASS_DRAG="drag",Fn.DEFAULT_WIDTH=245,Fn.TEXT_CLOSED="Close Controls",Fn.TEXT_OPEN="Open Controls",Fn._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Fn.toggleHide()},rn.bind(window,"keydown",Fn._keydownHandler,!1),Fr.extend(Fn.prototype,{add:function(e,t){return Dn(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Dn(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Fr.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&In.removeChild(this.domElement);var t=this;Fr.each(this.__folders,function(e){t.removeFolder(e)}),rn.unbind(window,"keydown",Fn._keydownHandler,!1),Pn(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Fn(t);this.__folders[e]=t;e=Un(this,t.domElement);return rn.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Pn(t);var e=this;Fr.each(t.__folders,function(e){t.removeFolder(e)}),Fr.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,r=this.getRoot();r.scrollable&&(e=rn.getOffset(r.__ul).top,t=0,Fr.each(r.__ul.childNodes,function(e){r.autoPlace&&e===r.__save_row||(t+=rn.getHeight(e))}),window.innerHeight-e-20<t?(rn.addClass(r.domElement,Fn.CLASS_TOO_TALL),r.__ul.style.height=window.innerHeight-e-20+"px"):(rn.removeClass(r.domElement,Fn.CLASS_TOO_TALL),r.__ul.style.height="auto")),r.__resize_handle&&Fr.defer(function(){r.__resize_handle.style.height=r.__ul.offsetHeight+"px"}),r.__closeButton&&(r.__closeButton.style.width=r.width+"px")},onResizeDebounced:Fr.debounce(function(){this.onResize()},50),remember:function(){if(Fr.isUndefined(Cn)&&((Cn=new Tn).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Fr.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(r){var e=r.__save_row=document.createElement("li");rn.addClass(r.domElement,"has-save"),r.__ul.insertBefore(e,r.__ul.firstChild),rn.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",rn.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",rn.addClass(n,"button"),rn.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",rn.addClass(i,"button"),rn.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",rn.addClass(o,"button"),rn.addClass(o,"revert");var s=r.__preset_select=document.createElement("select");r.load&&r.load.remembered?Fr.each(r.load.remembered,function(e,t){Vn(r,t,t===r.preset)}):Vn(r,Mn,!1);{var a;rn.bind(s,"change",function(){for(var e=0;e<r.__preset_select.length;e++)r.__preset_select[e].innerHTML=r.__preset_select[e].value;r.preset=this.value}),e.appendChild(s),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(o),On&&(a=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Nn(0,"isLocal"))&&e.setAttribute("checked","checked"),Hn(r,a),rn.bind(e,"change",function(){r.useLocalStorage=!r.useLocalStorage,Hn(r,a)}))}var u=document.getElementById("dg-new-constructor");rn.bind(u,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Cn.hide()}),rn.bind(t,"click",function(){u.innerHTML=JSON.stringify(r.getSaveObject(),void 0,2),Cn.show(),u.focus(),u.select()}),rn.bind(n,"click",function(){r.save()}),rn.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&r.saveAs(e)}),rn.bind(o,"click",function(){r.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&zn(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var r=this.load;return r.closed=this.closed,0<this.__rememberedObjects.length&&(r.preset=this.preset,r.remembered||(r.remembered={}),r.remembered[this.preset]=$n(this)),r.folders={},Fr.each(this.__folders,function(e,t){r.folders[t]=e.getSaveObject()}),r},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=$n(this),Rn(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Mn]=$n(this,!0)),this.load.remembered[e]=$n(this),this.preset=e,Vn(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){Fr.each(this.__controllers,function(e){this.getRoot().load.remembered?jn(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),Fr.each(this.__folders,function(e){e.revert(e)}),t||Rn(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&An.call(window,function(){e(t)});Fr.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){Fr.each(this.__controllers,function(e){e.updateDisplay()}),Fr.each(this.__folders,function(e){e.updateDisplay()})}});var Gn=Fn,Wn="undefined"!=typeof Float32Array?Float32Array:Array;function Yn(){var e=new Wn(16);return Wn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Xn(e,t,r){var n,i,o,s,a,u,c,l,d,h,f,p=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*p+t[4]*m+t[8]*g+t[12],e[13]=t[1]*p+t[5]*m+t[9]*g+t[13],e[14]=t[2]*p+t[6]*m+t[10]*g+t[14],e[15]=t[3]*p+t[7]*m+t[11]*g+t[15]):(n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],h=t[9],f=t[10],r=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=u,e[6]=c,e[7]=l,e[8]=d,e[9]=h,e[10]=f,e[11]=r,e[12]=n*p+a*m+d*g+t[12],e[13]=i*p+u*m+h*g+t[13],e[14]=o*p+c*m+f*g+t[14],e[15]=s*p+l*m+r*g+t[15]),e}function qn(e,t,r){var n=r[0],i=r[1],r=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Kn(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=r+r,a=n+n,u=i+i,c=r*s,l=n*s,t=n*a,r=i*s,n=i*a,i=i*u,s=o*s,a=o*a,u=o*u;return e[0]=1-t-i,e[1]=l+u,e[2]=r-a,e[3]=0,e[4]=l-u,e[5]=1-c-i,e[6]=n+s,e[7]=0,e[8]=r+a,e[9]=n-s,e[10]=1-c-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Qn=function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],b=r[0],v=r[1],w=r[2],t=r[3];return e[0]=b*n+v*a+w*d+t*m,e[1]=b*i+v*u+w*h+t*g,e[2]=b*o+v*c+w*f+t*_,e[3]=b*s+v*l+w*p+t*y,b=r[4],v=r[5],w=r[6],t=r[7],e[4]=b*n+v*a+w*d+t*m,e[5]=b*i+v*u+w*h+t*g,e[6]=b*o+v*c+w*f+t*_,e[7]=b*s+v*l+w*p+t*y,b=r[8],v=r[9],w=r[10],t=r[11],e[8]=b*n+v*a+w*d+t*m,e[9]=b*i+v*u+w*h+t*g,e[10]=b*o+v*c+w*f+t*_,e[11]=b*s+v*l+w*p+t*y,b=r[12],v=r[13],w=r[14],t=r[15],e[12]=b*n+v*a+w*d+t*m,e[13]=b*i+v*u+w*h+t*g,e[14]=b*o+v*c+w*f+t*_,e[15]=b*s+v*l+w*p+t*y,e};function Jn(){var e=new Wn(3);return Wn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Zn(e,t,r){var n=new Wn(3);return n[0]=e,n[1]=t,n[2]=r,n}var ei;function ti(){var e=new Wn(4);return Wn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Jn(),ei=new Wn(4),Wn!=Float32Array&&(ei[0]=0,ei[1]=0,ei[2]=0,ei[3]=0);var ri,ni=function(e,t,r,n){var i=new Wn(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i};Jn(),Zn(1,0,0),Zn(0,1,0),ti(),ti(),ri=new Wn(9),Wn!=Float32Array&&(ri[1]=0,ri[2]=0,ri[3]=0,ri[5]=0,ri[6]=0,ri[7]=0),ri[0]=1,ri[4]=1,ri[8]=1;class ii{constructor(e){this.device=e}get(){return this.buffer}destroy(){this.buffer.destroy()}}class oi extends ii{constructor(e,t){super(e),this.itemsCount=t.length,this.typedArray=t,this.buffer=e.createBuffer({size:8*Math.ceil(t.byteLength/8),usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new(this.typedArray instanceof Uint16Array?Uint16Array:Uint32Array)(this.buffer.getMappedRange()).set(t),this.buffer.unmap()}get isInt16(){return this.typedArray instanceof Uint16Array}bind(e){return e.setIndexBuffer(this.buffer,this.isInt16?"uint16":"uint32"),this}}class si{constructor(e=0,t=3,r="float32x4"){this.offset=0,this.size=3,this.format="float32x4",this.offset=e,this.size=t,this.format=r}}class ai extends ii{constructor(e,t,r,n=4*Float32Array.BYTES_PER_ELEMENT,i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,o="vertex"){super(e),this.attributes=new Map,this.stepMode="vertex",this.bindPointIdx=t,this.typedArray=r,this.arrayStride=n,this.stepMode=o,this.buffer=e.createBuffer({size:r.byteLength,usage:i,mappedAtCreation:!0}),new Float32Array(this.buffer.getMappedRange()).set(r),this.buffer.unmap()}get itemsCount(){return this.typedArray.length/this.arrayStride}getLayout(r){return this.attributes.size,{arrayStride:this.arrayStride,stepMode:this.stepMode,attributes:Array.from(this.attributes).map(([,e],t)=>({offset:e.offset,format:e.format,shaderLocation:r+t}))}}addAttribute(e,t=0,r=3,n="float32x4"){n=new si(t,r,n);return this.attributes.set(e,n),this}bind(e){return e.setVertexBuffer(this.bindPointIdx,this.buffer),this}}class ui extends ii{constructor(e,t,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST){super(e),this.byteLength=t,this.buffer=e.createBuffer({size:t,usage:r})}write(e,t){return this.device.queue.writeBuffer(this.buffer,e,t),this}}class ci{constructor(e){this.source="",this.device=e}static getVertexInputFormat(e){switch(e){case"float32":return"f32";case"float32x2":return"vec2<f32>";case"float32x3":case"float32x4":return"vec4<f32>"}}get shaderModule(){return this.module||(this.module=this.device.createShaderModule({code:this.source})),this.module}addUniformInputs(e,t=1){return this.source+=`
      [[block]] struct UniformsInput {
        ${Object.entries(e).reduce((e,[t,{type:r}])=>e+=`${t}: ${r};`,"")}
      };

      [[group(0), binding(${t})]] var<uniform> inputUBO: UniformsInput;
    `,this}addTextureInputs(e){return this.source+=e.reduce((e,{bindIdx:t,name:r,type:n})=>e+`
          [[group(0), binding(${t})]] var ${r}: ${n};
        `,""),this}addSamplerInputs(e){return this.source+=e.reduce((e,{bindIdx:t,name:r,type:n})=>e+`
          [[group(0), binding(${t})]] var ${r}: ${n};
          `,""),this}addStorages(e){return e.forEach(({bindIdx:e,name:t,attributes:r})=>{this.source+=`
        struct ${t} {
          ${Object.entries(r).map(([e,t])=>`${e}: ${t};`).join("\n")}
        };

        [[block]] struct ${t}Collection {
          ${t.toLowerCase()}s: [[stride(48)]] array<Light>;
        };

        [[group(0), binding(${e})]] var<storage, read_write> ${t.toLowerCase()}Collection: ${t}Collection;
      `}),this}addHeadSnippet(e){return e&&(this.source+=e),this}}ci.ENTRY_FUNCTION="main";class li extends ci{constructor(e){super(e),this.source+=li.TRANSFORM_UBO_SNIPPET}addShaderVars(e,t={}){let n=0,i="",o="";e.forEach(({attributes:e})=>{for(var[t,{format:r}]of e){r=ci.getVertexInputFormat(r);i+=`
          [[location(${n})]] ${t}: ${r};
        `,o+=`
          [[location(${n})]] ${t}: ${r};
        `,n++}});for(var[r,{format:s}]of Object.entries(t)){s=ci.getVertexInputFormat(s);o+=`
        [[location(${n})]] ${r}: ${s};
      `,n++}return this.source+=`
      struct Input {
        ${i}
      };

      struct Output {
        [[builtin(position)]] Position: vec4<f32>;
        ${o}
      };
    `,this}addMainFnSnippet(e){return this.source+=`
      [[stage(vertex)]] fn main (input: Input) -> Output {
        var output: Output;
        ${e}
        return output;
      }
    `,this}}li.TRANSFORM_UBO_SNIPPET=`
    [[block]] struct Transform {
      projectionMatrix: mat4x4<f32>;
      viewMatrix: mat4x4<f32>;
      modelMatrix: mat4x4<f32>;
      normalMatrix: mat4x4<f32>;
    };

    [[group(0), binding(0)]] var<uniform> transform: Transform;
  `;class di extends ci{addShaderVars(e,t={},r={}){let n=0,i=0,o="",s="";e.forEach(({attributes:e})=>{for(var[t,{format:r}]of e){r=ci.getVertexInputFormat(r);o+=`
          [[location(${n})]] ${t}: ${r};
        `,n++}});for(var[a,{format:u}]of Object.entries(t)){u=ci.getVertexInputFormat(u);o+=`
        [[location(${n})]] ${a}: ${u};
      `,n++}for(var[c,{format:l}]of Object.entries(r)){l=ci.getVertexInputFormat(l);s+=`
        [[location(${i+1})]] ${c}: ${l};
      `,i++}return this.source+=`
      struct Input {
        [[builtin(position)]] coords: vec4<f32>;
        ${o}
      };

      struct Output {
        [[location(0)]] Color: vec4<f32>;
        ${s}
      };
    `,this}addMainFnSnippet(e){return this.source+=`
      [[stage(fragment)]] fn main (input: Input) -> Output {
        var output: Output;
        ${e}
        return output;
      }
    `,this}}class hi{constructor(e,t=0){this.samplers=[],this.textures=[],this.uniformBlocks=[],this.storageBuffers=[],this.device=e,this.bindingIndex=t}bind(e){return e.setBindGroup(this.bindingIndex,this.bindGroup),this}addSampler(e){return this.samplers.push(e),this}addTexture(e){return this.textures.push(e),this}addStorage(e){return this.storageBuffers.push(e),this}addUBO(e){e=new ui(this.device,e);return this.uniformBlocks.push(e),this}writeToUBO(e,t,r){const n=this.uniformBlocks[e];return n&&n.write(t,r),this}getLayout(){const t=[];let r=0;return this.uniformBlocks.forEach(()=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,binding:r,buffer:{type:"uniform"}}),r++}),this.samplers.forEach(e=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,binding:r,sampler:{type:e.bindingType}}),r++}),this.textures.forEach(e=>{t.push({visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,binding:r,texture:{sampleType:e.sampleType}}),r++}),this.storageBuffers.forEach(()=>{t.push({visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,binding:r,buffer:{type:"storage"}}),r++}),this.device.createBindGroupLayout({entries:t})}attachToPipeline(e){const r=[];let n=0;return this.uniformBlocks.forEach(e=>{r.push({binding:n,resource:{buffer:e.get(),offset:0,size:e.byteLength}}),n++}),this.samplers.forEach(e=>{r.push({binding:n,resource:e.get()}),n++}),this.textures.forEach((e,t)=>{r.push({binding:n,resource:e.get().createView()}),n++}),this.storageBuffers.forEach((e,t)=>{r.push({binding:n,resource:{buffer:e.get(),offset:0,size:e.byteLength}}),n++}),this.bindGroup=this.device.createBindGroup({layout:e.getBindGroupLayout(this.bindingIndex),entries:r}),this}destroy(){this.uniformBlocks.forEach(e=>e.destroy()),this.textures.forEach(e=>e.destroy()),this.samplers.forEach(e=>e.destroy()),this.storageBuffers.forEach(e=>e.destroy())}}class fi{constructor(e,t,r="filtering",n="sampler",i=null){this.device=e,this.name=t,this.bindingType=r,this.wglslSamplerType=n,this.sampler=e.createSampler(i)}static parseGLFilterMode(e){return"repeat"}static parseGLWrapMode(e){return"repeat"}get(){return this.sampler}destroy(){}}class pi{constructor(e,t,r="float",n="2d",i="texture_2d<f32>"){this.device=e,this.name=t,this.sampleType=r,this.viewDimension=n,this.wglslTextureType=i}get(){return this.texture}fromImageBitmap(e,t="rgba8unorm",r=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT){return this.texture=this.device.createTexture({size:[e.width,e.height,1],format:t,usage:r}),this.device.queue.copyExternalImageToTexture({source:e},{texture:this.texture},[e.width,e.height]),this}fromDefinition(e){return this.texture=this.device.createTexture(e),this}copyFromTexture(e,t,r){return e.copyTextureToTexture(t,{texture:this.texture},r),this}destroy(){this.texture.destroy()}}const mi="triangle-list",gi=new Map([["mat4x4<f32>",[16,Float32Array.BYTES_PER_ELEMENT]],["mat3x3<f32>",[12,Float32Array.BYTES_PER_ELEMENT]],["vec4<f32>",[4,Float32Array.BYTES_PER_ELEMENT]],["vec3<f32>",[3,Float32Array.BYTES_PER_ELEMENT]],["vec2<f32>",[2,Float32Array.BYTES_PER_ELEMENT]],["f32",[1,Float32Array.BYTES_PER_ELEMENT]],["i32",[4,Int32Array.BYTES_PER_ELEMENT]],["u32",[4,Uint32Array.BYTES_PER_ELEMENT]],["i16",[1,Int16Array.BYTES_PER_ELEMENT]],["u16",[1,Uint16Array.BYTES_PER_ELEMENT]]]);class _i{constructor(e){this.vertexCount=0,this.instanceCount=1,this.vertexBuffers=[],this.primitiveType=mi,this.device=e}get hasIndex(){return!!this.indexBuffer}get stripIndexFormat(){var e;let t=void 0;return"line-strip"!==this.primitiveType&&"triangle-strip"!==this.primitiveType||(t=null!==(e=this.indexBuffer)&&void 0!==e&&e.isInt16?"uint16":"uint32"),t}addIndexBuffer(e){return this.vertexCount=e.itemsCount,this.indexBuffer=e,this}addVertexBuffer(e){return e.attributes.get("position")&&!this.vertexCount&&(this.vertexCount=e.itemsCount),this.vertexBuffers.push(e),this}getVertexBuffersLayout(){const e=[];let t=0;for(const r of this.vertexBuffers.values())e.push(r.getLayout(t)),t+=r.attributes.size;return e}draw(t){this.vertexBuffers.forEach(e=>e.bind(t)),this.indexBuffer?(this.indexBuffer.bind(t),t.drawIndexed(this.vertexCount,this.instanceCount)):t.draw(this.vertexCount,this.instanceCount)}destroy(){var e;null!==(e=this.indexBuffer)&&void 0!==e&&e.destroy(),this.vertexBuffers.forEach(e=>e.destroy())}}var yi="undefined"!=typeof Float32Array?Float32Array:Array;function bi(){var e=new yi(16);return yi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function vi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function wi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xi(e,t,r,n){var i,o=t[0],s=t[1],a=t[2],u=n[0],c=n[1],l=n[2],d=r[0],h=r[1],f=r[2];return Math.abs(o-d)<1e-6&&Math.abs(s-h)<1e-6&&Math.abs(a-f)<1e-6?wi(e):(i=o-d,t=s-h,n=a-f,d=c*(n*=r=1/Math.hypot(i,t,n))-l*(t*=r),h=l*(i*=r)-u*n,f=u*t-c*i,(r=Math.hypot(d,h,f))?(d*=r=1/r,h*=r,f*=r):f=h=d=0,l=t*f-n*h,u=n*d-i*f,c=i*h-t*d,(r=Math.hypot(l,u,c))?(l*=r=1/r,u*=r,c*=r):c=u=l=0,e[0]=d,e[1]=l,e[2]=i,e[3]=0,e[4]=h,e[5]=u,e[6]=t,e[7]=0,e[8]=f,e[9]=c,e[10]=n,e[11]=0,e[12]=-(d*o+h*s+f*a),e[13]=-(l*o+u*s+c*a),e[14]=-(i*o+t*s+n*a),e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Ei=function(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],g=t[13],_=t[14],y=t[15],b=r[0],v=r[1],w=r[2],t=r[3];return e[0]=b*n+v*a+w*d+t*m,e[1]=b*i+v*u+w*h+t*g,e[2]=b*o+v*c+w*f+t*_,e[3]=b*s+v*l+w*p+t*y,b=r[4],v=r[5],w=r[6],t=r[7],e[4]=b*n+v*a+w*d+t*m,e[5]=b*i+v*u+w*h+t*g,e[6]=b*o+v*c+w*f+t*_,e[7]=b*s+v*l+w*p+t*y,b=r[8],v=r[9],w=r[10],t=r[11],e[8]=b*n+v*a+w*d+t*m,e[9]=b*i+v*u+w*h+t*g,e[10]=b*o+v*c+w*f+t*_,e[11]=b*s+v*l+w*p+t*y,b=r[12],v=r[13],w=r[14],t=r[15],e[12]=b*n+v*a+w*d+t*m,e[13]=b*i+v*u+w*h+t*g,e[14]=b*o+v*c+w*f+t*_,e[15]=b*s+v*l+w*p+t*y,e};function Ai(){var e=new yi(3);return yi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ti(e,t,r){var n=new yi(3);return n[0]=e,n[1]=t,n[2]=r,n}function Si(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Mi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Oi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Ci(e,t){var r=t[0],n=t[1],i=t[2],i=r*r+n*n+i*i;return 0<i&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function ki(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],t=r[1],r=r[2];return e[0]=i*r-o*t,e[1]=o*s-n*r,e[2]=n*t-i*s,e}var Ii=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e};function Bi(){var e=new yi(2);return yi!=Float32Array&&(e[0]=0,e[1]=0),e}Ai(),Bi();class Li{constructor(){this.position=Ti(0,0,0),this.rotation=Ti(0,0,0),this.scale=Ti(1,1,1),this.modelMatrix=bi(),this.shouldUpdate=!0}copyFromMatrix(e){return vi(this.modelMatrix,e),this.shouldUpdate=!1,this}setPosition(e){var{x:t=this.position[0],y:r=this.position[1],z:e=this.position[2]}=e;return Si(this.position,t,r,e),this.shouldUpdate=!0,this}setScale(e){var{x:t=this.scale[0],y:r=this.scale[1],z:e=this.scale[2]}=e;return Si(this.scale,t,r,e),this.shouldUpdate=!0,this}setRotation(e){var{x:t=this.rotation[0],y:r=this.rotation[1],z:e=this.rotation[2]}=e;return Si(this.rotation,t,r,e),this.shouldUpdate=!0,this}updateModelMatrix(){var e,t,r,n,i,o,s,a,u,c,l,d,h,f,p,m,g;return wi(this.modelMatrix),f=this.modelMatrix,o=this.modelMatrix,h=this.position,d=h[0],p=h[1],c=h[2],o===f?(f[12]=o[0]*d+o[4]*p+o[8]*c+o[12],f[13]=o[1]*d+o[5]*p+o[9]*c+o[13],f[14]=o[2]*d+o[6]*p+o[10]*c+o[14],f[15]=o[3]*d+o[7]*p+o[11]*c+o[15]):(e=o[0],t=o[1],u=o[2],l=o[3],r=o[4],n=o[5],m=o[6],g=o[7],i=o[8],s=o[9],a=o[10],h=o[11],f[0]=e,f[1]=t,f[2]=u,f[3]=l,f[4]=r,f[5]=n,f[6]=m,f[7]=g,f[8]=i,f[9]=s,f[10]=a,f[11]=h,f[12]=e*d+r*p+i*c+o[12],f[13]=t*d+n*p+s*c+o[13],f[14]=u*d+m*p+a*c+o[14],f[15]=l*d+g*p+h*c+o[15]),s=this.modelMatrix,u=this.modelMatrix,m=this.rotation[0],a=Math.sin(m),f=Math.cos(m),l=u[4],d=u[5],g=u[6],p=u[7],h=u[8],c=u[9],o=u[10],m=u[11],u!==s&&(s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[4]=l*f+h*a,s[5]=d*f+c*a,s[6]=g*f+o*a,s[7]=p*f+m*a,s[8]=h*f-l*a,s[9]=c*f-d*a,s[10]=o*f-g*a,s[11]=m*f-p*a,u=this.modelMatrix,h=this.modelMatrix,l=this.rotation[1],c=Math.sin(l),d=Math.cos(l),o=h[0],g=h[1],s=h[2],m=h[3],f=h[8],p=h[9],a=h[10],l=h[11],h!==u&&(u[4]=h[4],u[5]=h[5],u[6]=h[6],u[7]=h[7],u[12]=h[12],u[13]=h[13],u[14]=h[14],u[15]=h[15]),u[0]=o*d-f*c,u[1]=g*d-p*c,u[2]=s*d-a*c,u[3]=m*d-l*c,u[8]=o*c+f*d,u[9]=g*c+p*d,u[10]=s*c+a*d,u[11]=m*c+l*d,h=this.modelMatrix,o=this.modelMatrix,f=this.rotation[2],g=Math.sin(f),p=Math.cos(f),s=o[0],a=o[1],u=o[2],m=o[3],c=o[4],l=o[5],d=o[6],f=o[7],o!==h&&(h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=s*p+c*g,h[1]=a*p+l*g,h[2]=u*p+d*g,h[3]=m*p+f*g,h[4]=c*p-s*g,h[5]=l*p-a*g,h[6]=d*p-u*g,h[7]=f*p-m*g,h=this.modelMatrix,f=this.modelMatrix,p=this.scale,m=p[0],g=p[1],p=p[2],h[0]=f[0]*m,h[1]=f[1]*m,h[2]=f[2]*m,h[3]=f[3]*m,h[4]=f[4]*g,h[5]=f[5]*g,h[6]=f[6]*g,h[7]=f[7]*g,h[8]=f[8]*p,h[9]=f[9]*p,h[10]=f[10]*p,h[11]=f[11]*p,h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15],this.shouldUpdate=!1,this}}class Fi extends Li{constructor(){super(...arguments),this.renderable=!1,this.parentNode=null,this.children=[],this.worldMatrix=bi(),this.normalMatrix=bi(),this.setParent=(e=null)=>{var t;return!this.parentNode||0<=(t=this.parentNode.children.indexOf(this))&&this.parentNode.children.splice(t,1),e&&e.children.push(this),this.parentNode=e,this},this.updateWorldMatrix=(e=null)=>{var t,r,n,i,o,s,a,u,c,l,d,h,f,p,m,g,_,y,b,v,w,x,E,A,T,S,M,O,C;return this.shouldUpdate&&this.updateModelMatrix(),e?Ei(this.worldMatrix,e,this.modelMatrix):vi(this.worldMatrix,this.modelMatrix),x=this.normalMatrix,C=this.worldMatrix,t=C[0],r=C[1],n=C[2],i=C[3],o=C[4],s=C[5],a=C[6],u=C[7],E=C[8],T=C[9],M=C[10],c=C[11],l=C[12],d=C[13],h=C[14],f=C[15],(C=(O=t*s-r*o)*(w=M*f-c*h)-(S=t*a-n*o)*(v=T*f-c*d)+(p=t*u-i*o)*(b=T*h-M*d)+(A=r*a-n*s)*(y=E*f-c*l)-(m=r*u-i*s)*(_=E*h-M*l)+(g=n*u-i*a)*(e=E*d-T*l))&&(x[0]=(s*w-a*v+u*b)*(C=1/C),x[1]=(n*v-r*w-i*b)*C,x[2]=(d*g-h*m+f*A)*C,x[3]=(M*m-T*g-c*A)*C,x[4]=(a*y-o*w-u*_)*C,x[5]=(t*w-n*y+i*_)*C,x[6]=(h*p-l*g-f*S)*C,x[7]=(E*g-M*p+c*S)*C,x[8]=(o*v-s*y+u*e)*C,x[9]=(r*y-t*v-i*e)*C,x[10]=(l*m-d*p+f*O)*C,x[11]=(T*p-E*m-c*O)*C,x[12]=(s*_-o*b-a*e)*C,x[13]=(t*b-r*_+n*e)*C,x[14]=(d*S-l*A-h*O)*C,x[15]=(E*A-T*S+M*O)*C),x=this.normalMatrix,E=this.normalMatrix,x===E?(A=E[1],T=E[2],S=E[3],M=E[6],O=E[7],C=E[11],x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=A,x[6]=E[9],x[7]=E[13],x[8]=T,x[9]=M,x[11]=E[14],x[12]=S,x[13]=O,x[14]=C):(x[0]=E[0],x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=E[1],x[5]=E[5],x[6]=E[9],x[7]=E[13],x[8]=E[2],x[9]=E[6],x[10]=E[10],x[11]=E[14],x[12]=E[3],x[13]=E[7],x[14]=E[11],x[15]=E[15]),this.children.forEach(e=>{e.updateWorldMatrix(this.worldMatrix)}),this},this.traverseGraph=(t,e=this)=>(t(e),this.children.forEach(e=>e.traverseGraph(t)),this)}}const Ui=(e,t,r)=>Math.min(Math.max(e,t),r),Pi=(e,t,r)=>(r-e)/(t-e),Ri=e=>(e-=2*Math.floor(.5*e),e=Math.min(Math.max(e,0),2),1-Math.abs(e-1));class ji{constructor(){this.value=0,this.damping=.5}addForce(e){this.value+=e}update(){return 1e-6<this.value*this.value?this.value*=this.damping:this.stop(),this.value}stop(){this.value=0}}class Di{constructor(e,t=document.body,r=!1,n=1){this.target=Ai(),this.minDistance=0,this.maxDistance=1/0,this.isEnabled=!0,this.targetXDampedAction=new ji,this.targetYDampedAction=new ji,this.targetZDampedAction=new ji,this.targetThetaDampedAction=new ji,this.targetPhiDampedAction=new ji,this.targetRadiusDampedAction=new ji,this._isShiftDown=!1,this._rotateStart={x:9999,y:9999},this._rotateEnd={x:9999,y:9999},this._roatteDelta={x:9999,y:9999},this._zoomDistanceEnd=0,this._zoomDistance=0,this.state="",this.loopId=0,this._panStart={x:0,y:0},this._panDelta={x:0,y:0},this._panEnd={x:0,y:0},this._paused=!1,this._isDebug=!1,this.mouseWheelForce=1,this.mouseWheelForce=n,this.camera=e,this.domElement=t,this.isDamping=!1,this.dampingFactor=.25,this.isZoom=!0,this.zoomSpeed=1,this.isRotate=!0,this.rotateSpeed=1,this.isPan=!0,this.keyPanSpeed=7,this.enableKeys=!0,this.keys={LEFT:"37",UP:"38",RIGHT:"39",BOTTOM:"40",SHIFT:"16"},this.originTarget=Ai(),this.originPosition=Ai(),this.originPosition[0]=e.position[0],this.originPosition[1]=e.position[0],this.originPosition[2]=e.position[0];n=this.camera.position[0],t=this.camera.position[1],e=this.camera.position[2],n=Math.sqrt(n*n+t*t+e*e),t=Math.atan2(this.camera.position[0],this.camera.position[2]),e=Math.acos(Ui(this.camera.position[1]/n,-1,1));this._spherical={radius:n,theta:t,phi:e},this._bindEvens(),this.setEventHandler(),this.startTick(),(this._isDebug=r)&&(this._outputEl=document.createElement("div"),this._outputEl.setAttribute("style",`
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 999;
      font-family: monospace;
      font-size: 14px;
      user-select: none;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 3px 6px;
    `),document.body.appendChild(this._outputEl))}lookAt([e,t,r]){return Si(this.target,e,t,r),this}setEventHandler(){this.domElement.addEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.addEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.addEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.addEventListener("touchstart",this._touchStartHandler,!1),this.domElement.addEventListener("touchmove",this._touchMoveHandler,!1),window.addEventListener("keydown",this._onKeyDownHandler,!1),window.addEventListener("keyup",this._onKeyUpHandler,!1)}removeEventHandler(){this.domElement.removeEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.removeEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.removeEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1),this.domElement.removeEventListener("touchstart",this._touchStartHandler,!1),this.domElement.removeEventListener("touchmove",this._touchMoveHandler,!1),window.removeEventListener("keydown",this._onKeyDownHandler,!1),window.removeEventListener("keydown",this._onKeyUpHandler,!1)}startTick(){this.loopId=requestAnimationFrame(this.tick)}pause(){this._paused=!0}start(){this._paused=!1}tick(){var e,t,r;this._paused||(this.updateDampedAction(),this.updateCamera(),this._isDebug&&(e=Math.round(100*this.camera.position[0])/100,t=Math.round(100*this.camera.position[1])/100,r=Math.round(100*this.camera.position[2])/100,this._outputEl.textContent=`x: ${e} y: ${t} z: ${r}`)),this.loopId=requestAnimationFrame(this.tick)}updateDampedAction(){this.target[0]+=this.targetXDampedAction.update(),this.target[1]+=this.targetYDampedAction.update(),this.target[2]+=this.targetZDampedAction.update(),this._spherical.theta+=this.targetThetaDampedAction.update(),this._spherical.phi+=this.targetPhiDampedAction.update(),this._spherical.radius+=this.targetRadiusDampedAction.update()}updateCamera(){var e=this._spherical,t=Math.sin(e.phi)*e.radius;this.camera.position[0]=t*Math.sin(e.theta)+this.target[0],this.camera.position[1]=Math.cos(e.phi)*e.radius+this.target[1],this.camera.position[2]=t*Math.cos(e.theta)+this.target[2],this.camera.lookAtPosition[0]=this.target[0],this.camera.lookAtPosition[1]=this.target[1],this.camera.lookAtPosition[2]=this.target[2],this.camera.updateViewMatrix()}_bindEvens(){this.tick=this.tick.bind(this),this._contextMenuHandler=this._contextMenuHandler.bind(this),this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._touchStartHandler=this._touchStartHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._onKeyDownHandler=this._onKeyDownHandler.bind(this),this._onKeyUpHandler=this._onKeyUpHandler.bind(this)}_contextMenuHandler(e){this.isEnabled&&e.preventDefault()}_mouseDownHandler(e){this.isEnabled&&(0===e.button?(this.state="rotate",this._rotateStart={x:e.clientX,y:e.clientY}):(this.state="pan",this._panStart={x:e.clientX,y:e.clientY}),this.domElement.addEventListener("mousemove",this._mouseMoveHandler,!1),window.addEventListener("mouseup",this._mouseUpHandler,!1))}_mouseUpHandler(){this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1)}_mouseMoveHandler(e){this.isEnabled&&("rotate"===this.state?(this._rotateEnd={x:e.clientX,y:e.clientY},this._roatteDelta={x:this._rotateEnd.x-this._rotateStart.x,y:this._rotateEnd.y-this._rotateStart.y},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y}):"pan"===this.state&&(this._panEnd={x:e.clientX,y:e.clientY},this._panDelta={x:-.5*(this._panEnd.x-this._panStart.x),y:.5*(this._panEnd.y-this._panStart.y)},this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}))}_mouseWheelHandler(e){var t=this.mouseWheelForce;0<e.deltaY?this.targetRadiusDampedAction.addForce(t):this.targetRadiusDampedAction.addForce(-t)}_touchStartHandler(e){var t,r;switch(e.touches.length){case 1:this.state="rotate",this._rotateStart={x:e.touches[0].clientX,y:e.touches[0].clientY};break;case 2:this.state="zoom",t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistance=Math.sqrt(t*t+r*r);break;case 3:this.state="pan",this._panStart={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3}}}_touchMoveHandler(e){var t;switch(e.preventDefault(),e.touches.length){case 1:if("rotate"!==this.state)return;this._rotateEnd={x:e.touches[0].clientX,y:e.touches[0].clientY},this._roatteDelta={x:.5*(this._rotateEnd.x-this._rotateStart.x),y:.5*(this._rotateEnd.y-this._rotateStart.y)},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y};break;case 2:if("zoom"!==this.state)return;t=e.touches[1].clientX-e.touches[0].clientX,r=e.touches[1].clientY-e.touches[0].clientY,this._zoomDistanceEnd=Math.sqrt(t*t+r*r);var r=this._zoomDistanceEnd-this._zoomDistance,r=this._spherical.radius-(r*=1.5),r=Ui(r,this.minDistance,this.maxDistance);this._zoomDistance=this._zoomDistanceEnd,this._spherical.radius=r;break;case 3:this._panEnd={x:(e.touches[0].clientX+e.touches[1].clientX+e.touches[2].clientX)/3,y:(e.touches[0].clientY+e.touches[1].clientY+e.touches[2].clientY)/3},this._panDelta={x:this._panEnd.x-this._panStart.x,y:this._panEnd.y-this._panStart.y},this._panDelta.x*=-1,this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}}}_onKeyDownHandler(e){let t=0,r=0;switch(e.key){case this.keys.SHIFT:this._isShiftDown=!0;break;case this.keys.LEFT:t=-10;break;case this.keys.RIGHT:t=10;break;case this.keys.UP:r=10;break;case this.keys.BOTTOM:r=-10}this._isShiftDown?(this._roatteDelta={x:-t,y:r},this._updateRotateHandler()):(this._panDelta={x:t,y:r},this._updatePanHandler())}_onKeyUpHandler(e){e.key===this.keys.SHIFT&&(this._isShiftDown=!1)}_updatePanHandler(){var e=Ai(),t=Ai();const r=Ai();r[0]=this.target[0]-this.camera.position[0],r[1]=this.target[1]-this.camera.position[1],r[2]=this.target[2]-this.camera.position[2],Ci(r,r),ki(e,r,[0,1,0]),ki(t,e,r);var n=Math.max(this._spherical.radius/2e3,.001);this.targetXDampedAction.addForce((e[0]*this._panDelta.x+t[0]*this._panDelta.y)*n),this.targetYDampedAction.addForce((e[1]*this._panDelta.x+t[1]*this._panDelta.y)*n),this.targetZDampedAction.addForce((e[2]*this._panDelta.x+t[2]*this._panDelta.y)*n)}_updateRotateHandler(){this.targetThetaDampedAction.addForce(-this._roatteDelta.x/this.domElement.clientWidth),this.targetPhiDampedAction.addForce(-this._roatteDelta.y/this.domElement.clientHeight)}}class Ni{constructor(e,t,r,n){this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=bi(),this.viewMatrix=bi(),this.zoom=1,this.fieldOfView=e,this.aspect=t,this.near=r,this.far=n,this.updateProjectionMatrix()}setPosition({x:e=this.position[0],y:t=this.position[1],z:r=this.position[2]}){return this.position=[e,t,r],this}updateViewMatrix(){return xi(this.viewMatrix,this.position,this.lookAtPosition,Ni.UP_VECTOR),this}updateProjectionMatrix(){var e,t,r,n,i;return e=this.projectionMatrix,t=this.fieldOfView,r=this.aspect,n=this.near,i=this.far,t=1/Math.tan(t/2),e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(t=1/(n-i)),e[14]=2*i*n*t):(e[10]=-1,e[14]=-2*n),this}lookAt(e){return this.lookAtPosition=e,this.updateViewMatrix(),this}}Ni.UP_VECTOR=[0,1,0];class Vi{constructor(e,t,r,n,i,o){this.left=-1,this.right=1,this.top=1,this.bottom=-1,this.near=.1,this.far=2e3,this.zoom=1,this.position=[0,0,0],this.lookAtPosition=[0,0,0],this.projectionMatrix=bi(),this.viewMatrix=bi(),this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=o,this.updateProjectionMatrix()}setPosition({x:e=this.position[0],y:t=this.position[1],z:r=this.position[2]}){return this.position=[e,t,r],this}updateViewMatrix(){return xi(this.viewMatrix,this.position,this.lookAtPosition,Vi.UP_VECTOR),this}updateProjectionMatrix(){var e,t,r,n,i,o,s,a,u,c;return e=this.projectionMatrix,t=this.left,r=this.right,n=this.bottom,i=this.top,o=this.near,s=this.far,a=1/(t-r),u=1/(n-i),c=1/(o-s),e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*u,e[14]=(s+o)*c,e[15]=1,this}lookAt(e){return this.lookAtPosition=e,this.updateViewMatrix(),this}}function Hi(r,n,i,o,s,e,a,u,c,l=0,d=1,h=2,f=1,p=-1,m=0,g=0){var _=m,y=s/u,b=e/c;for(let t=0;t<=c;t++){var v=t*b-e/2;for(let e=0;e<=u;e++,m++){var w,x,E,A=e*y-s/2;r[3*m+l]=A*f,r[3*m+d]=v*p,r[3*m+h]=a/2,n[3*m+l]=0,n[3*m+d]=0,n[3*m+h]=0<=a?1:-1,i[2*m]=e/u,i[2*m+1]=1-t/c,t!==c&&e!==u&&(w=_+e+t*(u+1),x=_+e+(t+1)*(u+1),E=_+e+(t+1)*(u+1)+1,A=_+e+t*(u+1)+1,o[6*g]=w,o[6*g+1]=x,o[6*g+2]=A,o[6*g+3]=x,o[6*g+4]=E,o[6*g+5]=A,g++)}}}function zi(e={}){var{width:t=1,height:r=1,depth:n=1,widthSegments:i=1,heightSegments:o=1,depthSegments:s=1}=e,a=i,u=o,c=s,l=(a+1)*(u+1)*2+(a+1)*(c+1)*2+(u+1)*(c+1)*2,d=6*(a*u*2+a*c*2+u*c*2),e=new Float32Array(3*l),i=new Float32Array(3*l),o=new Float32Array(2*l),s=new(65536<l?Uint32Array:Uint16Array)(d),l=0,d=0;return Hi(e,i,o,s,n,r,t,c,u,2,1,0,-1,-1,0,0),Hi(e,i,o,s,n,r,-t,c,u,2,1,0,1,-1,l+=(c+1)*(u+1),d+=c*u),Hi(e,i,o,s,t,n,r,c,u,0,2,1,1,1,l+=(c+1)*(u+1),d+=c*u),Hi(e,i,o,s,t,n,-r,c,u,0,2,1,1,-1,l+=(a+1)*(c+1),d+=a*c),Hi(e,i,o,s,t,r,-n,a,u,0,1,2,-1,-1,l+=(a+1)*(c+1),d+=a*c),Hi(e,i,o,s,t,r,n,a,u,0,1,2,1,-1,l+=(a+1)*(u+1),d+=a*u),{vertices:e,normal:i,uv:o,indices:s}}function $i(e={}){var{width:t=1,height:r=1,depth:n=1,widthSegments:i=1,heightSegments:o=1,depthSegments:s=1}=e,a=i,u=o,c=s;const l=[];var d=(c+1)*(u+1),e=c*u*6,i=new Float32Array(3*d),o=new Float32Array(3*d),s=new Float32Array(2*d),d=new(65536<d?Uint32Array:Uint16Array)(e);Hi(i,o,s,d,n,r,t,c,u,2,1,0,-1,-1,0,0),l.push({orientation:"right",vertices:i,normal:o,uv:s,indices:d});e=(c+1)*(u+1),i=c*u*6,o=new Float32Array(3*e),s=new Float32Array(3*e),d=new Float32Array(2*e),e=new(65536<e?Uint32Array:Uint16Array)(i);Hi(o,s,d,e,n,r,-t,c,u,2,1,0,1,-1,0,0),l.push({orientation:"left",vertices:o,normal:s,uv:d,indices:e});i=(c+1)*(u+1),o=c*u*6,s=new Float32Array(3*i),d=new Float32Array(3*i),e=new Float32Array(2*i),i=new(65536<i?Uint32Array:Uint16Array)(o);Hi(s,d,e,i,t,n,r,c,u,0,2,1,1,1,0,0),l.push({orientation:"top",vertices:s,normal:d,uv:e,indices:i});o=(c+1)*(u+1),s=c*u*6,d=new Float32Array(3*o),e=new Float32Array(3*o),i=new Float32Array(2*o),s=new(65536<o?Uint32Array:Uint16Array)(s);Hi(d,e,i,s,t,n,-r,c,u,0,2,1,1,-1,0,0),l.push({orientation:"bottom",vertices:d,normal:e,uv:i,indices:s});d=(a+1)*(c+1),e=a*c*6,i=new Float32Array(3*d),s=new Float32Array(3*d),c=new Float32Array(2*d),d=new(65536<d?Uint32Array:Uint16Array)(e);Hi(i,s,c,d,t,r,-n,a,u,0,1,2,-1,-1,0,0),l.push({orientation:"back",vertices:i,normal:s,uv:c,indices:d});e=(a+1)*(u+1),i=a*u*6,s=new Float32Array(3*e),c=new Float32Array(3*e),d=new Float32Array(2*e),i=new(65536<e?Uint32Array:Uint16Array)(i);return Hi(s,c,d,i,t,r,n,a,u,0,1,2,1,-1,0,0),l.push({orientation:"front",vertices:s,normal:c,uv:d,indices:i}),l}Vi.UP_VECTOR=[0,1,0];class Gi{static xp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=r,t[1]=-e,t[2]=n,t}static xn(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=r,t[1]=e,t[2]=-n,t}static yp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=-e,t[1]=n,t[2]=r,t}static yn(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=e,t[1]=n,t[2]=-r,t}static zp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=n,t[1]=-r,t[2]=e,t}static zn(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=-n,t[1]=r,t[2]=e,t}static xp_yn(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=-n,t[1]=-e,t[2]=r,t}static xp_yp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=n,t[1]=-e,t[2]=-r,t}static xp_yp_yp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=-r,t[1]=-e,t[2]=-n,t}static xp_xp(e,t){var r=e[0],n=e[1],e=e[2];return t[0]=r,t[1]=-n,t[2]=-e,t}}o=({width:e=1,height:t=1,depth:r=1,radius:n=.5,div:i=4})=>{n=function(e=2,t=2,r=2,o=.5,s=4){const a=e/2,n=t/2,u=r/2,c=2*s,l=[],d=[],h=[],f=Ai();let i,p,m,g,_,y,b,v;b=n;const w=[Ti(o-a,n-o,o-u),Ti(a-o,n-o,o-u),Ti(o-a,n-o,u-o),Ti(a-o,n-o,u-o)],x=(e,t)=>{var r,n,i=Pi(-u,u,e);for(m=0;m<=c;m++)n=m<=s?0:1,r=Ri(m/s),_=m<=s?-1:1,y=a*_+o*r*-_,Si(f,y,b,e),Ii(f,f,w[n|t]),Ci(f,f),h.push(f[0],f[1],f[2]),Oi(f,f,o),Mi(f,f,w[n|t]),l.push(f[0],f[1],f[2]),d.push(Pi(-a,a,y),i),1==r&&(Si(f,a-o,b,e),Ii(f,f,w[1|t]),Ci(f,f),h.push(f[0],f[1],f[2]),Oi(f,f,o),Mi(f,f,w[1|t]),l.push(f[0],f[1],f[2]),d.push(Pi(-a,a,a-o),i))};for(p=0;p<=c;p++)i=p<=s?0:2,g=Ri(p/s),_=p<=s?-1:1,v=u*_+o*g*-_,x(v,i),1==g&&x(u-o,2);return{verts:l,uv:d,norm:h,indices:function(e,t){let r=[],n=e+1,i,o,s,a,u,c;for(o=0;o<t;o++)for(i=0;i<e;i++)s=o*n+i,a=s+n,u=a+1,c=s+1,r.push(s,a,u,u,c,s);return r}(1+c,1+c)}}(e,t,r,n,i),i={verts:[],indices:[],uv:[],norm:[]};return Wi(i,n,(e,t)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t)),Wi(i,n,Gi.xp),Wi(i,n,Gi.xp_yp),Wi(i,n,Gi.xp_yp_yp),Wi(i,n,Gi.xp_yn),Wi(i,n,Gi.xp_xp),{vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}};function Wi(t,r,n){var e=t.verts.length/3,i=r.verts.length;const o=Ai(),s=Ai();for(let e=0;e<i;e+=3)Si(o,r.verts[e],r.verts[e+1],r.verts[e+2]),n(o,s),t.verts.push(s[0],s[1],s[2]),Si(o,r.norm[e],r.norm[e+1],r.norm[e+2]),n(o,s),t.norm.push(s[0],s[1],s[2]);for(const o of r.uv)t.uv.push(o);for(const o of r.indices)t.indices.push(e+o)}i=({width:e=1,height:t=1,depth:r=1,radius:n=.5,div:i=4})=>{n=function(e=2,t=2,r=2,o=.5,s=4){const a=e/2,n=t/2,u=r/2,c=2*s,l=[],d=[],h=[],f=Ai();let i,p,m,g,_,y,b,v;b=n;const w=[Ti(o-a,n-o,o-u),Ti(a-o,n-o,o-u),Ti(o-a,n-o,u-o),Ti(a-o,n-o,u-o)],x=(e,t)=>{var r,n,i=Pi(-u,u,e);for(m=0;m<=c;m++)n=m<=s?0:1,r=Ri(m/s),_=m<=s?-1:1,y=a*_+o*r*-_,Si(f,y,b,e),Ii(f,f,w[n|t]),Ci(f,f),h.push(f[0],f[1],f[2]),Oi(f,f,o),Mi(f,f,w[n|t]),l.push(f[0],f[1],f[2]),d.push(Pi(-a,a,y),i),1==r&&(Si(f,a-o,b,e),Ii(f,f,w[1|t]),Ci(f,f),h.push(f[0],f[1],f[2]),Oi(f,f,o),Mi(f,f,w[1|t]),l.push(f[0],f[1],f[2]),d.push(Pi(-a,a,a-o),i))};for(p=0;p<=c;p++)i=p<=s?0:2,g=Ri(p/s),_=p<=s?-1:1,v=u*_+o*g*-_,x(v,i),1==g&&x(u-o,2);return{verts:l,uv:d,norm:h,indices:function(e,t){let r=[],n=e+1,i,o,s,a,u,c;for(o=0;o<t;o++)for(i=0;i<e;i++)s=o*n+i,a=s+n,u=a+1,c=s+1,r.push(s,a,u,u,c,s);return r}(1+c,1+c)}}(e,t,r,n,i);const o=[];i={verts:[],indices:[],uv:[],norm:[]};return Yi(i,n,(e,t)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t)),o.push({orientation:"top",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),Yi(i={verts:[],indices:[],uv:[],norm:[]},n,Gi.xp),o.push({orientation:"front",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),Yi(i={verts:[],indices:[],uv:[],norm:[]},n,Gi.xp_yp),o.push({orientation:"left",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),Yi(i={verts:[],indices:[],uv:[],norm:[]},n,Gi.xp_yp_yp),o.push({orientation:"back",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),Yi(i={verts:[],indices:[],uv:[],norm:[]},n,Gi.xp_yn),o.push({orientation:"right",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),Yi(i={verts:[],indices:[],uv:[],norm:[]},n,Gi.xp_xp),o.push({orientation:"bottom",vertices:new Float32Array(i.verts),normal:new Float32Array(i.norm),uv:new Float32Array(i.uv),indices:new Uint16Array(i.indices)}),o};function Yi(t,r,n){var e=t.verts.length/3,i=r.verts.length;const o=Ai(),s=Ai();for(let e=0;e<i;e+=3)Si(o,r.verts[e],r.verts[e+1],r.verts[e+2]),n(o,s),t.verts.push(s[0],s[1],s[2]),Si(o,r.norm[e],r.norm[e+1],r.norm[e+2]),n(o,s),t.norm.push(s[0],s[1],s[2]);for(const o of r.uv)t.uv.push(o);for(const o of r.indices)t.indices.push(e+o)}function Xi(e={}){var{radius:r=1,segments:n=8,thetaStart:i=0,thetaLength:o=2*Math.PI}=e;const t=[],s=[],a=[],u=[],c=Ai(),l=Bi();s.push(0,0,0),a.push(0,0,1),u.push(.5,.5);for(let e=0,t=3;e<=n;e++,t+=3){var d=i+e/n*o;c[0]=r*Math.cos(d),c[1]=r*Math.sin(d),s.push(...c),a.push(0,0,1),l[0]=(s[t]/r+1)/2,l[1]=(s[t+1]/r+1)/2,u.push(l[0],l[1])}for(let e=1;e<=n;e++)t.push(e,e+1,0);return{indices:new(65536<n?Uint32Array:Uint16Array)(t),vertices:new Float32Array(s),normal:new Float32Array(a),uv:new Float32Array(u)}}function qi(e={}){var{width:t=1,height:r=1,widthSegments:n=1,heightSegments:i=1}=e,o=n,s=i,a=(o+1)*(s+1),u=o*s*6,e=new Float32Array(3*a),n=new Float32Array(3*a),i=new Float32Array(2*a),u=new(65536<a?Uint32Array:Uint16Array)(u);return Hi(e,n,i,u,t,r,0,o,s),{vertices:e,normal:n,uv:i,indices:u}}function Ki(e={}){var{radius:t=.5,widthSegments:r=16,heightSegments:n=Math.ceil(.5*r),phiStart:i=0,phiLength:o=2*Math.PI,thetaStart:s=0,thetaLength:e=Math.PI}=e,a=r,u=n,c=i,l=o,d=s,h=e,s=(a+1)*(u+1),e=a*u*6;const f=new Float32Array(3*s),p=new Float32Array(3*s),m=new Float32Array(2*s),g=new(65536<s?Uint32Array:Uint16Array)(e);let _=0,y=0,b=0;var v=d+h;const w=[];var x=Ai();for(let e=0;e<=u;e++){const B=[];var E=e/u;for(let e=0;e<=a;e++,_++){var A=e/a,T=-t*Math.cos(c+A*l)*Math.sin(d+E*h),S=t*Math.cos(d+E*h),M=t*Math.sin(c+A*l)*Math.sin(d+E*h);Si(x,f[3*_]=T,f[3*_+1]=S,f[3*_+2]=M),Ci(x,x),p[3*_]=x[0],p[3*_+1]=x[1],p[3*_+2]=x[2],m[2*_]=A,m[2*_+1]=1-E,B.push(y++)}w.push(B)}for(let t=0;t<u;t++)for(let e=0;e<a;e++){var O=w[t][e+1],C=w[t][e],k=w[t+1][e],I=w[t+1][e+1];(0!==t||0<d)&&(g[3*b]=O,g[3*b+1]=C,g[3*b+2]=I,b++),(t!==u-1||v<Math.PI)&&(g[3*b]=C,g[3*b+1]=k,g[3*b+2]=I,b++)}return{vertices:f,normal:p,uv:m,indices:g}}function Qi(e={}){var{radius:r=.5,tube:n=.35,arc:i=2*Math.PI,radialSegments:t=8,tubularSegments:e=6}=e,o=Math.floor(t),s=Math.floor(e);const a=[],u=[],c=[],l=[],d=Ai(),h=Ai();var f=Ai();for(let t=0;t<=o;t++)for(let e=0;e<=s;e++){var p=e/s*i,m=t/o*Math.PI*2;h[0]=(r+n*Math.cos(m))*Math.cos(p),h[1]=(r+n*Math.cos(m))*Math.sin(p),h[2]=n*Math.sin(m),u.push(h[0],h[1],h[2]),d[0]=r*Math.cos(p),d[1]=r*Math.sin(p),Ii(f,h,d),Ci(f,f),c.push(f[0],f[1],f[0]),l.push(e/s,t/o)}for(let t=1;t<=o;t++)for(let e=1;e<=s;e++){var g=(s+1)*t+e-1,_=(s+1)*(t-1)+e-1,y=(s+1)*(t-1)+e,b=(s+1)*t+e;a.push(g,_,b),a.push(_,y,b)}return{indices:new(65536<(o+1)*(s+1)?Uint32Array:Uint16Array)(a),vertices:new Float32Array(u),normal:new Float32Array(c),uv:new Float32Array(l)}}var Ji=Object.freeze({__proto__:null,createBox:zi,createBoxSeparateFace:$i,createRoundedBoxSeparateFace:i,createRoundedBox:o,createCircle:Xi,createPlane:qi,createSphere:Ki,createTorus:Qi,GeometryUtils:{createBox:zi,createBoxSeparateFace:$i,createRoundedBoxSeparateFace:i,createRoundedBox:o,createCircle:Xi,createPlane:qi,createSphere:Ki,createTorus:Qi}});class Zi extends Fi{constructor(e,{geometry:t,uniforms:r={},storages:n=[],textures:i=[],samplers:o=[],vertexShaderSource:s,fragmentShaderSource:a,multisample:u={},depthStencil:c={format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"},targets:l=[{format:"bgra8unorm"}],primitiveType:d=mi}){super(),this.renderable=!0,this.uniforms={},t.primitiveType=d,this.device=e,this.geometry=t;let h=0;for(var[f,p]of Object.entries(r)){this.uniforms[f]=Object.assign({byteOffset:h},p);f=gi.get(p.type);if(!f)throw new Error("cant find uniform mapping");var[p,f]=f;h+=p*f}const m=h?2:1,g=new li(e),_=new di(e);h&&g.addUniformInputs(r),g.addShaderVars(t.vertexBuffers,s.outputs).addSamplerInputs(o.map(({name:e,wglslSamplerType:t},r)=>({bindIdx:m+r,name:e,type:t}))).addTextureInputs(i.map(({name:e,wglslTextureType:t},r)=>({bindIdx:m+o.length+r,name:e,type:`${t}`}))).addStorages(n.map(({dataStride:e,structDefinition:t,name:r},n)=>({bindIdx:m+o.length+i.length+n,name:r,attributes:t,dataStride:e}))).addHeadSnippet(s.head).addMainFnSnippet(s.main),h&&_.addUniformInputs(r),_.addShaderVars(t.vertexBuffers,a.inputs,a.outputs).addSamplerInputs(o.map(({name:e,wglslSamplerType:t},r)=>({bindIdx:m+r,name:e,type:t}))).addTextureInputs(i.map(({name:e,wglslTextureType:t},r)=>({bindIdx:m+o.length+r,name:e,type:`${t}`}))).addStorages(n.map(({name:e,dataStride:t,structDefinition:r},n)=>({dataStride:t,bindIdx:m+o.length+i.length+n,name:e,attributes:r}))).addHeadSnippet(a.head).addMainFnSnippet(a.main),this.uboBindGroup=new hi(e,0);var y,b;this.uboBindGroup.addUBO(64*Float32Array.BYTES_PER_ELEMENT),h&&this.uboBindGroup.addUBO(h);for({value:y,byteOffset:b}of Object.values(this.uniforms))this.uboBindGroup.writeToUBO(1,b,y);o.forEach(e=>this.uboBindGroup.addSampler(e)),i.map(e=>this.uboBindGroup.addTexture(e)),n.forEach(e=>this.uboBindGroup.addStorage(e));const v={layout:this.device.createPipelineLayout({bindGroupLayouts:[this.uboBindGroup.getLayout()]}),vertex:{module:g.shaderModule,entryPoint:ci.ENTRY_FUNCTION,buffers:t.getVertexBuffersLayout()},fragment:{module:_.shaderModule,entryPoint:ci.ENTRY_FUNCTION,targets:l},primitive:{topology:d,stripIndexFormat:t.stripIndexFormat},multisample:u};c&&(v.depthStencil=c),this.pipeline=e.createRenderPipeline(v),this.uboBindGroup.attachToPipeline(this.pipeline)}setUniform(e,t){e=this.uniforms[e];if(!e)throw new Error("Uniform does not belong to UBO");return this.uboBindGroup.writeToUBO(1,e.byteOffset,t),this}render(e,t){var r;this.updateWorldMatrix(null===(r=this.parentNode)||void 0===r?void 0:r.worldMatrix),this.uboBindGroup.writeToUBO(0,32*Float32Array.BYTES_PER_ELEMENT,this.worldMatrix).writeToUBO(0,48*Float32Array.BYTES_PER_ELEMENT,this.normalMatrix),this.uboBindGroup.writeToUBO(0,0,t.projectionMatrix).writeToUBO(0,16*Float32Array.BYTES_PER_ELEMENT,t.viewMatrix),this.uboBindGroup.bind(e),e.setPipeline(this.pipeline),this.geometry.draw(e)}destroy(){this.uboBindGroup.destroy()}}const eo=`
  let N: vec3<f32> = normalize(input.normal.rgb);
  let L: vec3<f32> = normalize(inputUBO.lightPosition.xyz - input.position.xyz);

  // Lambert's cosine law
  let lambertian = max(dot(N, L), 0.0);

  var specular = 0.0;
  if (lambertian > 0.0) {
    let R: vec3<f32> = reflect(-L, N);
    let V: vec3<f32> = normalize(inputUBO.cameraPosition.xyz - input.position.xyz);
    
    // Compute the specular term
    let specAngle = max(dot(R, V), 0.0);
    
    let lightShininess = 10.0;
    specular = pow(specAngle, lightShininess);
  }

  // Calculate projected UVs from light point of view
  var shadowPos: vec3<f32> = input.shadowPos.xyz / input.shadowPos.w;
  shadowPos = shadowPos * vec3<f32>(0.5, -0.5, 1.0) + vec3<f32>(0.5, 0.5, 0.0);

  // Percentage close filtering
  var visibility : f32 = 0.0;
  for (var y : i32 = -1 ; y <= 1 ; y = y + 1) {
    for (var x : i32 = -1 ; x <= 1 ; x = x + 1) {
      let offset : vec2<f32> = vec2<f32>(
        f32(x) * 0.0009765625,
        f32(y) * 0.0009765625
      );

      visibility = visibility + textureSampleCompare(
        my_depth_texture,
        my_depth_sampler,
        shadowPos.xy + offset,
        shadowPos.z - 0.0055
      );
    }
  }
  visibility = visibility / 9.0;
  
  // Apply shadow visibility to phong lighting
  var finalLight = vec3<f32>(
    vec3<f32>(0.1, 0.1, 0.1) +
    visibility * lambertian * inputUBO.diffuseColor.rgb +
    visibility * specular * inputUBO.specularColor.rgb
  );  

  // Final color
  output.Color = vec4<f32>(inputUBO.baseColor.rgb * finalLight, 1.0);
`,to="output.Color = vec4<f32>(1.0);",ro=({useNormal:e=!0,useUV:t=!0,usePosition:r=!0,useLightUv:n=!1})=>`
  let worldPosition: vec4<f32> = transform.modelMatrix * input.position;
  
  output.Position = transform.projectionMatrix *
                    transform.viewMatrix *
                    worldPosition;

  ${n?`
        let posFromLight: vec4<f32> = inputUBO.lightCamProjectionMatrix *
                                      inputUBO.lightCamViewMatrix *
                                      worldPosition;

        output.shadowPos = posFromLight;
  `:""}
  
  ${e?"output.normal = transform.normalMatrix * input.normal;":""}
  ${t?"output.uv = input.uv;":""}
  ${r?"output.position = worldPosition;":""}
`,no=e=>e.map(e=>e/255),io={lightX:0,lightY:30,lightZ:10,timeScaleFactor:.4,animateLight:!0,showDebug:!0};e(void 0,void 0,void 0,function*(){var e=yield null===(e=navigator.gpu)||void 0===e?void 0:e.requestAdapter();const t=`
    <div id="no-webgpu-wrapper">
      <div id="no-webgpu">
        WebGPU is not supported on this browser. Please try modern Google Chrome (Canary) or Firefox Nightly.
      </div>
    </div>
  `;window.addEventListener("unhandledrejection",e=>{document.body.innerHTML+=t}),window.addEventListener("error",e=>{document.body.innerHTML+=t}),e||(document.body.innerHTML+=t)}),e(void 0,void 0,void 0,function*(){var e=yield async function(e,t,r){Array.isArray(t)||Oe(t)||(r=t,t=void 0);const n=Te(r);let i=e;return"string"==typeof e&&(i=await n(e)),z(e)&&(i=await n(e)),Ge(i,t,r)}(`${window.ASSETS_BASE_URL}/2CylinderEngine.gltf`,Sr);const t=document.getElementById("gpu-c");t.width=innerWidth*devicePixelRatio,t.height=innerHeight*devicePixelRatio,t.style.setProperty("width",`${innerWidth}px`),t.style.setProperty("height",`${innerHeight}px`);const r=yield null===(S=navigator.gpu)||void 0===S?void 0:S.requestAdapter(),f=yield null===r||void 0===r?void 0:r.requestDevice(),n=new Gn;n.add(io,"timeScaleFactor").min(.05).max(1).step(.05),n.add(io,"animateLight"),n.add(io,"showDebug");const u=t.getContext("webgpu"),p=u.getPreferredFormat(r);var i=[t.width,t.height];u.configure({device:f,format:p});const m="triangle-list",c=new pi(f,"texture_depth").fromDefinition({size:i,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),g=new pi(f,"my_depth_texture","depth","2d","texture_depth_2d").fromDefinition({size:[2048,2048,1],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,format:"depth32float"});var o=new fi(f,"my_depth_debug_sampler");const _=new fi(f,"my_depth_sampler","comparison","sampler_comparison",{compare:"less"}),l=new Ni(45*Math.PI/180,t.width/t.height,.1,400).setPosition({x:46,y:23,z:132}).lookAt([0,0,0]).updateProjectionMatrix().updateViewMatrix(),d=new Float32Array(l.position),h=new Float32Array([20,20,20,0]),y=new Vi(-50,50,-50,50,-200,200).setPosition({x:h[0],y:h[1],z:h[2]}).lookAt([0,0,0]).updateProjectionMatrix().updateViewMatrix(),b=new Vi(-t.width/2,t.width/2,t.height/2,-t.height/2,.1,3).setPosition({z:2}).lookAt([0,0,0]).updateProjectionMatrix().updateViewMatrix(),s=new Di(l,t,!1);s.lookAt([0,.5,0]);const v={diffuseColor:{type:"vec4<f32>",value:new Float32Array(no(Cr("#aca5cf").values))},specularColor:{type:"vec4<f32>",value:new Float32Array(no(Cr("#be355e").values))},lightPosition:{type:"vec4<f32>",value:h},cameraPosition:{type:"vec4<f32>",value:d},lightCamViewMatrix:{type:"mat4x4<f32>",value:y.viewMatrix},lightCamProjectionMatrix:{type:"mat4x4<f32>",value:y.projectionMatrix}},w=new Fi,x=new Fi,a=new Fi,E=new Fi,A=new Fi;E.setScale({x:.1,y:.1,z:.1}).setRotation({y:Math.PI}).updateModelMatrix().setParent(A),x.setParent(w),a.setScale({x:.1,y:.1,z:.1}).setRotation({y:Math.PI}).updateModelMatrix().setParent(x),function t(l,e=null,r=null){const d=new Fi;const h=new Fi;l.mesh&&l.mesh.primitives.map(e=>{const t=new _i(f);if(e.attributes.POSITION){const a=new ai(f,0,e.attributes.POSITION.value,e.attributes.POSITION.bytesPerElement).addAttribute("position",0,3,"float32x3");t.addVertexBuffer(a)}if(e.attributes.NORMAL){const u=new ai(f,1,e.attributes.NORMAL.value,e.attributes.NORMAL.bytesPerElement).addAttribute("normal",0,3,"float32x3");t.addVertexBuffer(u)}if(e.attributes.TEXCOORD_0){const c=new ai(f,2,e.attributes.TEXCOORD_0.value,e.attributes.TEXCOORD_0.bytesPerElement).addAttribute("uv",0,2,"float32x2");t.addVertexBuffer(c)}const r=new oi(f,e.indices.value);t.addIndexBuffer(r);const{material:{pbrMetallicRoughness:{baseColorFactor:n}}}=l.mesh.primitives[0],i={geometry:t,primitiveType:m},o=new Zi(f,Object.assign(Object.assign({},i),{uniforms:Object.assign(Object.assign({},v),{baseColor:{type:"vec4<f32>",value:new Float32Array(n)}}),vertexShaderSource:{outputs:{shadowPos:{format:"float32x3"}},main:ro({useUV:!1,useLightUv:!0})},samplers:[_],textures:[g],fragmentShaderSource:{inputs:{shadowPos:{format:"float32x3"}},main:eo},targets:[{format:p}]}));o.setParent(d);const s=new Zi(f,Object.assign(Object.assign({},i),{vertexShaderSource:{main:ro({useUV:!1,useNormal:!1,usePosition:!1})},fragmentShaderSource:{main:to},targets:[],depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}}));s.setParent(h)});if(l.matrix)d.copyFromMatrix(l.matrix),h.copyFromMatrix(l.matrix);else{const i=Yn();if(l.translation&&Xn(i,i,l.translation),l.rotation){const o=ni(l.rotation[0],l.rotation[1],l.rotation[2],1),s=Yn();Kn(s,o),Qn(i,i,s)}l.scale&&qn(i,i,l.scale),d.copyFromMatrix(i),h.copyFromMatrix(i)}e&&d.setParent(e);r&&h.setParent(r);const n=l.nodes||l.children;n&&n.length&&n.forEach(e=>{t(e,d,h)})}(e.scene,a,E);const T=new _i(f);var{vertices:S,indices:i,normal:e}=Ji.createPlane({width:150,height:150}),i=new oi(f,i),S=new ai(f,0,S,3*Float32Array.BYTES_PER_ELEMENT).addAttribute("position",0,3,"float32x3"),e=new ai(f,1,e,3*Float32Array.BYTES_PER_ELEMENT).addAttribute("normal",0,3,"float32x3");T.addIndexBuffer(i).addVertexBuffer(S).addVertexBuffer(e);const M=new Zi(f,{geometry:T,uniforms:Object.assign({baseColor:{type:"vec4<f32>",value:new Float32Array([.8,.8,.8])}},v),samplers:[_],textures:[g],vertexShaderSource:{outputs:{shadowPos:{format:"float32x3"}},main:ro({useLightUv:!0,useUV:!1})},fragmentShaderSource:{inputs:{shadowPos:{format:"float32x3"}},main:eo}});M.setRotation({x:-Math.PI/2}).setPosition({y:-23}),M.setParent(x);const O=new Zi(f,{geometry:T,vertexShaderSource:{main:ro({useNormal:!0,useUV:!1})},fragmentShaderSource:{main:to},targets:[],depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}});O.setRotation({x:-Math.PI/2}).setPosition({y:-23}),O.setParent(A);const C=new _i(f);var{vertices:i,uv:S,indices:e}=Ji.createSphere(),e=new oi(f,e),i=new ai(f,0,i,3*Float32Array.BYTES_PER_ELEMENT).addAttribute("position",0,3,"float32x3"),S=new ai(f,1,S,2*Float32Array.BYTES_PER_ELEMENT).addAttribute("uv",0,2,"float32x2");C.addIndexBuffer(e),C.addVertexBuffer(i),C.addVertexBuffer(S);const k=new Zi(f,{geometry:C,uniforms:{},vertexShaderSource:{main:ro({useNormal:!1,useUV:!1})},fragmentShaderSource:{main:to}});k.setPosition({x:h[0],y:h[1],z:h[2]}).setParent(w),w.updateWorldMatrix(),A.updateWorldMatrix();const I=new _i(f);var{vertices:e,uv:i,indices:S}=Ji.createPlane({width:204.8,height:204.8}),S=new oi(f,S),e=new ai(f,0,e,3*Float32Array.BYTES_PER_ELEMENT).addAttribute("position",0,3,"float32x3"),i=new ai(f,1,i,2*Float32Array.BYTES_PER_ELEMENT).addAttribute("uv",0,2,"float32x2");I.addIndexBuffer(S).addVertexBuffer(e).addVertexBuffer(i);const B=new Zi(f,{geometry:I,vertexShaderSource:{main:ro({useNormal:!1,useUV:!0})},textures:[g],samplers:[o],fragmentShaderSource:{main:`
        let depth: f32 = textureSample(
          my_depth_texture,
          my_depth_debug_sampler,
          vec2<f32>(input.uv.x, 1.0 - input.uv.y)
        );
        output.Color = vec4<f32>(vec3<f32>(depth), 1.0);
      `},targets:[{format:p}]}).setPosition({x:-t.width/2+102.4+24,y:-t.height/2+102.4+24}).setRotation({x:Math.PI}).updateModelMatrix();requestAnimationFrame(function e(t){t/=1e3;requestAnimationFrame(e);io.animateLight&&(h[0]=40*Math.cos(t*io.timeScaleFactor),h[2]=40*Math.sin(t*io.timeScaleFactor));k.setPosition({x:h[0],y:h[1],z:h[2]});y.setPosition({x:h[0],y:h[1],z:h[2]}).updateViewMatrix().updateProjectionMatrix();d[0]=l.position[0];d[1]=l.position[1];d[2]=l.position[2];const r=u.getCurrentTexture();const n=f.createCommandEncoder();{const i={colorAttachments:[],depthStencilAttachment:{view:g.get().createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}},o=n.beginRenderPass(i);A.traverseGraph(e=>{e.renderable&&e.render(o,y)}),o.endPass()}{const s={colorAttachments:[{view:r.createView(),loadValue:[.1,.1,.1,1],storeOp:"store"}],depthStencilAttachment:{view:c.get().createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}},a=n.beginRenderPass(s);w.traverseGraph(e=>{e.renderable&&e.render(a,l)}),x.traverseGraph(e=>{e.renderable&&e.setUniform("lightPosition",h).setUniform("cameraPosition",d).setUniform("lightCamViewMatrix",y.viewMatrix).setUniform("lightCamProjectionMatrix",y.projectionMatrix)}),io.showDebug&&B.render(a,b),a.endPass()}f.queue.submit([n.finish()])})})}();
